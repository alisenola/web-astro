---
import ProjectsButton from '../components/core/ProjectsButton.astro';
import MainLayout from '../layouts/MainLayout.astro';
import { extractYml } from '../javascripts/utilities';

function getRandomInt(min, max)
{
	return Math.floor(Math.random() * (max - min + 1) + min);
}

// Get model settings
const modelSettings = extractYml(await Astro.glob('../data/model-settings.yml'));

// Set model path
const modelNumber = getRandomInt(1, Object.keys(modelSettings).length);
const modelPath = 'models/' + modelNumber + '.glb';

// Set FOV
const minFov = modelSettings[modelNumber].fov + 'deg';

---
<MainLayout>
	<div class="homepage">
		<h1 class="homepage-title">Jan Bl√°ha</h1>
		<div class="model-viewer-container">
			<model-viewer
				src={modelPath}
				environment-image="/assets/env.hdr"
				exposure="1.1"
				autoplay
				auto-rotate
				auto-rotate-delay="0"
				rotation-per-second="-5deg"
				min-camera-orbit="auto 80deg auto"
				max-camera-orbit="auto 80deg auto"
				min-field-of-view={minFov}
				camera-controls
				interaction-prompt="none"
				disable-zoom
				shadow-intensity="1"
				shadow-softness="0.3">
			</model-viewer>
		</div>
		<div class="homepage-info-panel">
			<div class="typewriter-container">
				<div id="typewriter-history"></div>
				<div id="typewriter">_</div>
			</div>
			<div class="projects-button-wrapper">
			<ProjectsButton text="View projects" />
			</div>
		</div>
	</div>
</MainLayout>

<script is:inline src="/src/javascripts/typewriter.js"></script>
<script is:inline type="module" src="/src/javascripts/model-viewer.min.js"></script>



<style>
	.homepage {
		position: relative;
		min-height: 420px;
		margin: auto;
		height: calc(100vh - 227px);
		display: flex;
		flex-direction: column;
		justify-content: center;
	}

	.homepage-title {
		z-index: 10;
		font-size: 60px;
		text-align: center;
		pointer-events: none;
	}

	.model-viewer-container {
		position: absolute;
		left: -260px;
		top: 0;
		width: calc(100% + 260px);
		height: calc(100% + 161px);
	}

	model-viewer {
		width: 100%;
		height: 100%;
		--progress-bar-height: 0px;
	}

	.homepage-info-panel {
		height: 100%;
		margin-left: 52%;
		display: flex;
		flex-direction: column;
		justify-content: center;
	}
</style>

<style is:global>
	.typewriter-container {
		z-index: 10;
		pointer-events: none;
		user-select: none;
	}

	#typewriter-history div,
	#typewriter {
		z-index: 10;
		font-size: 30px;
		white-space: nowrap;
	}

	#typewriter-history {
		height: 0px;
		display: flex;
		flex-direction: column;
		justify-content: flex-end;
	}
</style>