/*!
 * Sketchbook 0.1 (https://github.com/swift502/Sketchbook)
 * Built on three.js (https://github.com/mrdoob/three.js) and cannon.js (https://github.com/schteppe/cannon.js)
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("THREE"),require("CANNON")):"function"==typeof define&&define.amd?define(["THREE","CANNON"],t):"object"==typeof exports?exports.Sketchbook=t(require("THREE"),require("CANNON")):e.Sketchbook=t(e.THREE,e.CANNON)}(window,function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){(function(e,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var a,o=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",l="__lodash_hash_undefined__",c=500,f="__lodash_placeholder__",h=1,d=2,p=4,m=1,_=2,v=1,g=2,y=4,A=8,x=16,b=32,w=64,F=128,S=256,T=512,E=30,P="...",L=800,I=16,N=1,C=2,O=1/0,k=9007199254740991,M=1.7976931348623157e308,R=NaN,U=4294967295,X=U-1,D=U>>>1,B=[["ary",F],["bind",v],["bindKey",g],["curry",A],["curryRight",x],["flip",T],["partial",b],["partialRight",w],["rearg",S]],j="[object Arguments]",Y="[object Array]",Q="[object AsyncFunction]",V="[object Boolean]",z="[object Date]",G="[object DOMException]",H="[object Error]",W="[object Function]",q="[object GeneratorFunction]",K="[object Map]",J="[object Number]",Z="[object Null]",$="[object Object]",ee="[object Proxy]",te="[object RegExp]",ne="[object Set]",re="[object String]",ie="[object Symbol]",ae="[object Undefined]",oe="[object WeakMap]",se="[object WeakSet]",ue="[object ArrayBuffer]",le="[object DataView]",ce="[object Float32Array]",fe="[object Float64Array]",he="[object Int8Array]",de="[object Int16Array]",pe="[object Int32Array]",me="[object Uint8Array]",_e="[object Uint8ClampedArray]",ve="[object Uint16Array]",ge="[object Uint32Array]",ye=/\b__p \+= '';/g,Ae=/\b(__p \+=) '' \+/g,xe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,be=/&(?:amp|lt|gt|quot|#39);/g,we=/[&<>"']/g,Fe=RegExp(be.source),Se=RegExp(we.source),Te=/<%-([\s\S]+?)%>/g,Ee=/<%([\s\S]+?)%>/g,Pe=/<%=([\s\S]+?)%>/g,Le=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ie=/^\w*$/,Ne=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ce=/[\\^$.*+?()[\]{}|]/g,Oe=RegExp(Ce.source),ke=/^\s+|\s+$/g,Me=/^\s+/,Re=/\s+$/,Ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Xe=/\{\n\/\* \[wrapped with (.+)\] \*/,De=/,? & /,Be=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,je=/\\(\\)?/g,Ye=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Qe=/\w*$/,Ve=/^[-+]0x[0-9a-f]+$/i,ze=/^0b[01]+$/i,Ge=/^\[object .+?Constructor\]$/,He=/^0o[0-7]+$/i,We=/^(?:0|[1-9]\d*)$/,qe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ke=/($^)/,Je=/['\n\r\u2028\u2029\\]/g,Ze="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",$e="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",et="[\\ud800-\\udfff]",tt="["+$e+"]",nt="["+Ze+"]",rt="\\d+",it="[\\u2700-\\u27bf]",at="[a-z\\xdf-\\xf6\\xf8-\\xff]",ot="[^\\ud800-\\udfff"+$e+rt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",st="\\ud83c[\\udffb-\\udfff]",ut="[^\\ud800-\\udfff]",lt="(?:\\ud83c[\\udde6-\\uddff]){2}",ct="[\\ud800-\\udbff][\\udc00-\\udfff]",ft="[A-Z\\xc0-\\xd6\\xd8-\\xde]",ht="(?:"+at+"|"+ot+")",dt="(?:"+ft+"|"+ot+")",pt="(?:"+nt+"|"+st+")"+"?",mt="[\\ufe0e\\ufe0f]?"+pt+("(?:\\u200d(?:"+[ut,lt,ct].join("|")+")[\\ufe0e\\ufe0f]?"+pt+")*"),_t="(?:"+[it,lt,ct].join("|")+")"+mt,vt="(?:"+[ut+nt+"?",nt,lt,ct,et].join("|")+")",gt=RegExp("['’]","g"),yt=RegExp(nt,"g"),At=RegExp(st+"(?="+st+")|"+vt+mt,"g"),xt=RegExp([ft+"?"+at+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[tt,ft,"$"].join("|")+")",dt+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[tt,ft+ht,"$"].join("|")+")",ft+"?"+ht+"+(?:['’](?:d|ll|m|re|s|t|ve))?",ft+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",rt,_t].join("|"),"g"),bt=RegExp("[\\u200d\\ud800-\\udfff"+Ze+"\\ufe0e\\ufe0f]"),wt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ft=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],St=-1,Tt={};Tt[ce]=Tt[fe]=Tt[he]=Tt[de]=Tt[pe]=Tt[me]=Tt[_e]=Tt[ve]=Tt[ge]=!0,Tt[j]=Tt[Y]=Tt[ue]=Tt[V]=Tt[le]=Tt[z]=Tt[H]=Tt[W]=Tt[K]=Tt[J]=Tt[$]=Tt[te]=Tt[ne]=Tt[re]=Tt[oe]=!1;var Et={};Et[j]=Et[Y]=Et[ue]=Et[le]=Et[V]=Et[z]=Et[ce]=Et[fe]=Et[he]=Et[de]=Et[pe]=Et[K]=Et[J]=Et[$]=Et[te]=Et[ne]=Et[re]=Et[ie]=Et[me]=Et[_e]=Et[ve]=Et[ge]=!0,Et[H]=Et[W]=Et[oe]=!1;var Pt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Lt=parseFloat,It=parseInt,Nt="object"==typeof e&&e&&e.Object===Object&&e,Ct="object"==typeof self&&self&&self.Object===Object&&self,Ot=Nt||Ct||Function("return this")(),kt="object"==typeof t&&t&&!t.nodeType&&t,Mt=kt&&"object"==typeof r&&r&&!r.nodeType&&r,Rt=Mt&&Mt.exports===kt,Ut=Rt&&Nt.process,Xt=function(){try{var e=Mt&&Mt.require&&Mt.require("util").types;return e||Ut&&Ut.binding&&Ut.binding("util")}catch(e){}}(),Dt=Xt&&Xt.isArrayBuffer,Bt=Xt&&Xt.isDate,jt=Xt&&Xt.isMap,Yt=Xt&&Xt.isRegExp,Qt=Xt&&Xt.isSet,Vt=Xt&&Xt.isTypedArray;function zt(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Gt(e,t,n,r){for(var i=-1,a=null==e?0:e.length;++i<a;){var o=e[i];t(r,o,n(o),e)}return r}function Ht(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function Wt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function qt(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function Kt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}function Jt(e,t){return!!(null==e?0:e.length)&&un(e,t,0)>-1}function Zt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function $t(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function en(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function tn(e,t,n,r){var i=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}function nn(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function rn(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var an=hn("length");function on(e,t,n){var r;return n(e,function(e,n,i){if(t(e,n,i))return r=n,!1}),r}function sn(e,t,n,r){for(var i=e.length,a=n+(r?1:-1);r?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function un(e,t,n){return t==t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):sn(e,cn,n)}function ln(e,t,n,r){for(var i=n-1,a=e.length;++i<a;)if(r(e[i],t))return i;return-1}function cn(e){return e!=e}function fn(e,t){var n=null==e?0:e.length;return n?mn(e,t)/n:R}function hn(e){return function(t){return null==t?a:t[e]}}function dn(e){return function(t){return null==e?a:e[t]}}function pn(e,t,n,r,i){return i(e,function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)}),n}function mn(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);o!==a&&(n=n===a?o:n+o)}return n}function _n(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function vn(e){return function(t){return e(t)}}function gn(e,t){return $t(t,function(t){return e[t]})}function yn(e,t){return e.has(t)}function An(e,t){for(var n=-1,r=e.length;++n<r&&un(t,e[n],0)>-1;);return n}function xn(e,t){for(var n=e.length;n--&&un(t,e[n],0)>-1;);return n}var bn=dn({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),wn=dn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Fn(e){return"\\"+Pt[e]}function Sn(e){return bt.test(e)}function Tn(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function En(e,t){return function(n){return e(t(n))}}function Pn(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var o=e[n];o!==t&&o!==f||(e[n]=f,a[i++]=n)}return a}function Ln(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function In(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function Nn(e){return Sn(e)?function(e){var t=At.lastIndex=0;for(;At.test(e);)++t;return t}(e):an(e)}function Cn(e){return Sn(e)?function(e){return e.match(At)||[]}(e):function(e){return e.split("")}(e)}var On=dn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var kn=function e(t){var n=(t=null==t?Ot:kn.defaults(Ot.Object(),t,kn.pick(Ot,Ft))).Array,r=t.Date,i=t.Error,Ze=t.Function,$e=t.Math,et=t.Object,tt=t.RegExp,nt=t.String,rt=t.TypeError,it=n.prototype,at=Ze.prototype,ot=et.prototype,st=t["__core-js_shared__"],ut=at.toString,lt=ot.hasOwnProperty,ct=0,ft=function(){var e=/[^.]+$/.exec(st&&st.keys&&st.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ht=ot.toString,dt=ut.call(et),pt=Ot._,mt=tt("^"+ut.call(lt).replace(Ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=Rt?t.Buffer:a,vt=t.Symbol,At=t.Uint8Array,bt=_t?_t.allocUnsafe:a,Pt=En(et.getPrototypeOf,et),Nt=et.create,Ct=ot.propertyIsEnumerable,kt=it.splice,Mt=vt?vt.isConcatSpreadable:a,Ut=vt?vt.iterator:a,Xt=vt?vt.toStringTag:a,an=function(){try{var e=Ua(et,"defineProperty");return e({},"",{}),e}catch(e){}}(),dn=t.clearTimeout!==Ot.clearTimeout&&t.clearTimeout,Mn=r&&r.now!==Ot.Date.now&&r.now,Rn=t.setTimeout!==Ot.setTimeout&&t.setTimeout,Un=$e.ceil,Xn=$e.floor,Dn=et.getOwnPropertySymbols,Bn=_t?_t.isBuffer:a,jn=t.isFinite,Yn=it.join,Qn=En(et.keys,et),Vn=$e.max,zn=$e.min,Gn=r.now,Hn=t.parseInt,Wn=$e.random,qn=it.reverse,Kn=Ua(t,"DataView"),Jn=Ua(t,"Map"),Zn=Ua(t,"Promise"),$n=Ua(t,"Set"),er=Ua(t,"WeakMap"),tr=Ua(et,"create"),nr=er&&new er,rr={},ir=lo(Kn),ar=lo(Jn),or=lo(Zn),sr=lo($n),ur=lo(er),lr=vt?vt.prototype:a,cr=lr?lr.valueOf:a,fr=lr?lr.toString:a;function hr(e){if(Es(e)&&!_s(e)&&!(e instanceof _r)){if(e instanceof mr)return e;if(lt.call(e,"__wrapped__"))return co(e)}return new mr(e)}var dr=function(){function e(){}return function(t){if(!Ts(t))return{};if(Nt)return Nt(t);e.prototype=t;var n=new e;return e.prototype=a,n}}();function pr(){}function mr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=a}function _r(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=U,this.__views__=[]}function vr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function gr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function yr(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ar(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new yr;++t<n;)this.add(e[t])}function xr(e){var t=this.__data__=new gr(e);this.size=t.size}function br(e,t){var n=_s(e),r=!n&&ms(e),i=!n&&!r&&As(e),a=!n&&!r&&!i&&Ms(e),o=n||r||i||a,s=o?_n(e.length,nt):[],u=s.length;for(var l in e)!t&&!lt.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||a&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Va(l,u))||s.push(l);return s}function wr(e){var t=e.length;return t?e[Ai(0,t-1)]:a}function Fr(e,t){return oo(ta(e),Or(t,0,e.length))}function Sr(e){return oo(ta(e))}function Tr(e,t,n){(n===a||hs(e[t],n))&&(n!==a||t in e)||Nr(e,t,n)}function Er(e,t,n){var r=e[t];lt.call(e,t)&&hs(r,n)&&(n!==a||t in e)||Nr(e,t,n)}function Pr(e,t){for(var n=e.length;n--;)if(hs(e[n][0],t))return n;return-1}function Lr(e,t,n,r){return Xr(e,function(e,i,a){t(r,e,n(e),a)}),r}function Ir(e,t){return e&&na(t,ru(t),e)}function Nr(e,t,n){"__proto__"==t&&an?an(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Cr(e,t){for(var r=-1,i=t.length,o=n(i),s=null==e;++r<i;)o[r]=s?a:Zs(e,t[r]);return o}function Or(e,t,n){return e==e&&(n!==a&&(e=e<=n?e:n),t!==a&&(e=e>=t?e:t)),e}function kr(e,t,n,r,i,o){var s,u=t&h,l=t&d,c=t&p;if(n&&(s=i?n(e,r,i,o):n(e)),s!==a)return s;if(!Ts(e))return e;var f=_s(e);if(f){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&lt.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!u)return ta(e,s)}else{var m=Ba(e),_=m==W||m==q;if(As(e))return qi(e,u);if(m==$||m==j||_&&!i){if(s=l||_?{}:Ya(e),!u)return l?function(e,t){return na(e,Da(e),t)}(e,function(e,t){return e&&na(t,iu(t),e)}(s,e)):function(e,t){return na(e,Xa(e),t)}(e,Ir(s,e))}else{if(!Et[m])return i?e:{};s=function(e,t,n){var r=e.constructor;switch(t){case ue:return Ki(e);case V:case z:return new r(+e);case le:return function(e,t){var n=t?Ki(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case ce:case fe:case he:case de:case pe:case me:case _e:case ve:case ge:return Ji(e,n);case K:return new r;case J:case re:return new r(e);case te:return function(e){var t=new e.constructor(e.source,Qe.exec(e));return t.lastIndex=e.lastIndex,t}(e);case ne:return new r;case ie:return function(e){return cr?et(cr.call(e)):{}}(e)}}(e,m,u)}}o||(o=new xr);var v=o.get(e);if(v)return v;if(o.set(e,s),Cs(e))return e.forEach(function(r){s.add(kr(r,t,n,r,e,o))}),s;if(Ps(e))return e.forEach(function(r,i){s.set(i,kr(r,t,n,i,e,o))}),s;var g=f?a:(c?l?Ia:La:l?iu:ru)(e);return Ht(g||e,function(r,i){g&&(r=e[i=r]),Er(s,i,kr(r,t,n,i,e,o))}),s}function Mr(e,t,n){var r=n.length;if(null==e)return!r;for(e=et(e);r--;){var i=n[r],o=t[i],s=e[i];if(s===a&&!(i in e)||!o(s))return!1}return!0}function Rr(e,t,n){if("function"!=typeof e)throw new rt(u);return no(function(){e.apply(a,n)},t)}function Ur(e,t,n,r){var i=-1,a=Jt,s=!0,u=e.length,l=[],c=t.length;if(!u)return l;n&&(t=$t(t,vn(n))),r?(a=Zt,s=!1):t.length>=o&&(a=yn,s=!1,t=new Ar(t));e:for(;++i<u;){var f=e[i],h=null==n?f:n(f);if(f=r||0!==f?f:0,s&&h==h){for(var d=c;d--;)if(t[d]===h)continue e;l.push(f)}else a(t,h,r)||l.push(f)}return l}hr.templateSettings={escape:Te,evaluate:Ee,interpolate:Pe,variable:"",imports:{_:hr}},hr.prototype=pr.prototype,hr.prototype.constructor=hr,mr.prototype=dr(pr.prototype),mr.prototype.constructor=mr,_r.prototype=dr(pr.prototype),_r.prototype.constructor=_r,vr.prototype.clear=function(){this.__data__=tr?tr(null):{},this.size=0},vr.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},vr.prototype.get=function(e){var t=this.__data__;if(tr){var n=t[e];return n===l?a:n}return lt.call(t,e)?t[e]:a},vr.prototype.has=function(e){var t=this.__data__;return tr?t[e]!==a:lt.call(t,e)},vr.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=tr&&t===a?l:t,this},gr.prototype.clear=function(){this.__data__=[],this.size=0},gr.prototype.delete=function(e){var t=this.__data__,n=Pr(t,e);return!(n<0||(n==t.length-1?t.pop():kt.call(t,n,1),--this.size,0))},gr.prototype.get=function(e){var t=this.__data__,n=Pr(t,e);return n<0?a:t[n][1]},gr.prototype.has=function(e){return Pr(this.__data__,e)>-1},gr.prototype.set=function(e,t){var n=this.__data__,r=Pr(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},yr.prototype.clear=function(){this.size=0,this.__data__={hash:new vr,map:new(Jn||gr),string:new vr}},yr.prototype.delete=function(e){var t=Ma(this,e).delete(e);return this.size-=t?1:0,t},yr.prototype.get=function(e){return Ma(this,e).get(e)},yr.prototype.has=function(e){return Ma(this,e).has(e)},yr.prototype.set=function(e,t){var n=Ma(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Ar.prototype.add=Ar.prototype.push=function(e){return this.__data__.set(e,l),this},Ar.prototype.has=function(e){return this.__data__.has(e)},xr.prototype.clear=function(){this.__data__=new gr,this.size=0},xr.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},xr.prototype.get=function(e){return this.__data__.get(e)},xr.prototype.has=function(e){return this.__data__.has(e)},xr.prototype.set=function(e,t){var n=this.__data__;if(n instanceof gr){var r=n.__data__;if(!Jn||r.length<o-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new yr(r)}return n.set(e,t),this.size=n.size,this};var Xr=aa(Gr),Dr=aa(Hr,!0);function Br(e,t){var n=!0;return Xr(e,function(e,r,i){return n=!!t(e,r,i)}),n}function jr(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],s=t(o);if(null!=s&&(u===a?s==s&&!ks(s):n(s,u)))var u=s,l=o}return l}function Yr(e,t){var n=[];return Xr(e,function(e,r,i){t(e,r,i)&&n.push(e)}),n}function Qr(e,t,n,r,i){var a=-1,o=e.length;for(n||(n=Qa),i||(i=[]);++a<o;){var s=e[a];t>0&&n(s)?t>1?Qr(s,t-1,n,r,i):en(i,s):r||(i[i.length]=s)}return i}var Vr=oa(),zr=oa(!0);function Gr(e,t){return e&&Vr(e,t,ru)}function Hr(e,t){return e&&zr(e,t,ru)}function Wr(e,t){return Kt(t,function(t){return ws(e[t])})}function qr(e,t){for(var n=0,r=(t=zi(t,e)).length;null!=e&&n<r;)e=e[uo(t[n++])];return n&&n==r?e:a}function Kr(e,t,n){var r=t(e);return _s(e)?r:en(r,n(e))}function Jr(e){return null==e?e===a?ae:Z:Xt&&Xt in et(e)?function(e){var t=lt.call(e,Xt),n=e[Xt];try{e[Xt]=a;var r=!0}catch(e){}var i=ht.call(e);return r&&(t?e[Xt]=n:delete e[Xt]),i}(e):function(e){return ht.call(e)}(e)}function Zr(e,t){return e>t}function $r(e,t){return null!=e&&lt.call(e,t)}function ei(e,t){return null!=e&&t in et(e)}function ti(e,t,r){for(var i=r?Zt:Jt,o=e[0].length,s=e.length,u=s,l=n(s),c=1/0,f=[];u--;){var h=e[u];u&&t&&(h=$t(h,vn(t))),c=zn(h.length,c),l[u]=!r&&(t||o>=120&&h.length>=120)?new Ar(u&&h):a}h=e[0];var d=-1,p=l[0];e:for(;++d<o&&f.length<c;){var m=h[d],_=t?t(m):m;if(m=r||0!==m?m:0,!(p?yn(p,_):i(f,_,r))){for(u=s;--u;){var v=l[u];if(!(v?yn(v,_):i(e[u],_,r)))continue e}p&&p.push(_),f.push(m)}}return f}function ni(e,t,n){var r=null==(e=$a(e,t=zi(t,e)))?e:e[uo(bo(t))];return null==r?a:zt(r,e,n)}function ri(e){return Es(e)&&Jr(e)==j}function ii(e,t,n,r,i){return e===t||(null==e||null==t||!Es(e)&&!Es(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var s=_s(e),u=_s(t),l=s?Y:Ba(e),c=u?Y:Ba(t),f=(l=l==j?$:l)==$,h=(c=c==j?$:c)==$,d=l==c;if(d&&As(e)){if(!As(t))return!1;s=!0,f=!1}if(d&&!f)return o||(o=new xr),s||Ms(e)?Ea(e,t,n,r,i,o):function(e,t,n,r,i,a,o){switch(n){case le:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ue:return!(e.byteLength!=t.byteLength||!a(new At(e),new At(t)));case V:case z:case J:return hs(+e,+t);case H:return e.name==t.name&&e.message==t.message;case te:case re:return e==t+"";case K:var s=Tn;case ne:var u=r&m;if(s||(s=Ln),e.size!=t.size&&!u)return!1;var l=o.get(e);if(l)return l==t;r|=_,o.set(e,t);var c=Ea(s(e),s(t),r,i,a,o);return o.delete(e),c;case ie:if(cr)return cr.call(e)==cr.call(t)}return!1}(e,t,l,n,r,i,o);if(!(n&m)){var p=f&&lt.call(e,"__wrapped__"),v=h&&lt.call(t,"__wrapped__");if(p||v){var g=p?e.value():e,y=v?t.value():t;return o||(o=new xr),i(g,y,n,r,o)}}return!!d&&(o||(o=new xr),function(e,t,n,r,i,o){var s=n&m,u=La(e),l=u.length,c=La(t).length;if(l!=c&&!s)return!1;for(var f=l;f--;){var h=u[f];if(!(s?h in t:lt.call(t,h)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var p=!0;o.set(e,t),o.set(t,e);for(var _=s;++f<l;){h=u[f];var v=e[h],g=t[h];if(r)var y=s?r(g,v,h,t,e,o):r(v,g,h,e,t,o);if(!(y===a?v===g||i(v,g,n,r,o):y)){p=!1;break}_||(_="constructor"==h)}if(p&&!_){var A=e.constructor,x=t.constructor;A!=x&&"constructor"in e&&"constructor"in t&&!("function"==typeof A&&A instanceof A&&"function"==typeof x&&x instanceof x)&&(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))}(e,t,n,r,ii,i))}function ai(e,t,n,r){var i=n.length,o=i,s=!r;if(null==e)return!o;for(e=et(e);i--;){var u=n[i];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<o;){var l=(u=n[i])[0],c=e[l],f=u[1];if(s&&u[2]){if(c===a&&!(l in e))return!1}else{var h=new xr;if(r)var d=r(c,f,l,e,t,h);if(!(d===a?ii(f,c,m|_,r,h):d))return!1}}return!0}function oi(e){return!(!Ts(e)||function(e){return!!ft&&ft in e}(e))&&(ws(e)?mt:Ge).test(lo(e))}function si(e){return"function"==typeof e?e:null==e?Lu:"object"==typeof e?_s(e)?di(e[0],e[1]):hi(e):Xu(e)}function ui(e){if(!qa(e))return Qn(e);var t=[];for(var n in et(e))lt.call(e,n)&&"constructor"!=n&&t.push(n);return t}function li(e){if(!Ts(e))return function(e){var t=[];if(null!=e)for(var n in et(e))t.push(n);return t}(e);var t=qa(e),n=[];for(var r in e)("constructor"!=r||!t&&lt.call(e,r))&&n.push(r);return n}function ci(e,t){return e<t}function fi(e,t){var r=-1,i=gs(e)?n(e.length):[];return Xr(e,function(e,n,a){i[++r]=t(e,n,a)}),i}function hi(e){var t=Ra(e);return 1==t.length&&t[0][2]?Ja(t[0][0],t[0][1]):function(n){return n===e||ai(n,e,t)}}function di(e,t){return Ga(e)&&Ka(t)?Ja(uo(e),t):function(n){var r=Zs(n,e);return r===a&&r===t?$s(n,e):ii(t,r,m|_)}}function pi(e,t,n,r,i){e!==t&&Vr(t,function(o,s){if(Ts(o))i||(i=new xr),function(e,t,n,r,i,o,s){var u=eo(e,n),l=eo(t,n),c=s.get(l);if(c)Tr(e,n,c);else{var f=o?o(u,l,n+"",e,t,s):a,h=f===a;if(h){var d=_s(l),p=!d&&As(l),m=!d&&!p&&Ms(l);f=l,d||p||m?_s(u)?f=u:ys(u)?f=ta(u):p?(h=!1,f=qi(l,!0)):m?(h=!1,f=Ji(l,!0)):f=[]:Is(l)||ms(l)?(f=u,ms(u)?f=Qs(u):Ts(u)&&!ws(u)||(f=Ya(l))):h=!1}h&&(s.set(l,f),i(f,l,r,o,s),s.delete(l)),Tr(e,n,f)}}(e,t,s,n,pi,r,i);else{var u=r?r(eo(e,s),o,s+"",e,t,i):a;u===a&&(u=o),Tr(e,s,u)}},iu)}function mi(e,t){var n=e.length;if(n)return Va(t+=t<0?n:0,n)?e[t]:a}function _i(e,t,n){var r=-1;return t=$t(t.length?t:[Lu],vn(ka())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(fi(e,function(e,n,i){return{criteria:$t(t,function(t){return t(e)}),index:++r,value:e}}),function(e,t){return function(e,t,n){for(var r=-1,i=e.criteria,a=t.criteria,o=i.length,s=n.length;++r<o;){var u=Zi(i[r],a[r]);if(u){if(r>=s)return u;var l=n[r];return u*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)})}function vi(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var o=t[r],s=qr(e,o);n(s,o)&&Si(a,zi(o,e),s)}return a}function gi(e,t,n,r){var i=r?ln:un,a=-1,o=t.length,s=e;for(e===t&&(t=ta(t)),n&&(s=$t(e,vn(n)));++a<o;)for(var u=0,l=t[a],c=n?n(l):l;(u=i(s,c,u,r))>-1;)s!==e&&kt.call(s,u,1),kt.call(e,u,1);return e}function yi(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==a){var a=i;Va(i)?kt.call(e,i,1):Ui(e,i)}}return e}function Ai(e,t){return e+Xn(Wn()*(t-e+1))}function xi(e,t){var n="";if(!e||t<1||t>k)return n;do{t%2&&(n+=e),(t=Xn(t/2))&&(e+=e)}while(t);return n}function bi(e,t){return ro(Za(e,t,Lu),e+"")}function wi(e){return wr(hu(e))}function Fi(e,t){var n=hu(e);return oo(n,Or(t,0,n.length))}function Si(e,t,n,r){if(!Ts(e))return e;for(var i=-1,o=(t=zi(t,e)).length,s=o-1,u=e;null!=u&&++i<o;){var l=uo(t[i]),c=n;if(i!=s){var f=u[l];(c=r?r(f,l,u):a)===a&&(c=Ts(f)?f:Va(t[i+1])?[]:{})}Er(u,l,c),u=u[l]}return e}var Ti=nr?function(e,t){return nr.set(e,t),e}:Lu,Ei=an?function(e,t){return an(e,"toString",{configurable:!0,enumerable:!1,value:Tu(t),writable:!0})}:Lu;function Pi(e){return oo(hu(e))}function Li(e,t,r){var i=-1,a=e.length;t<0&&(t=-t>a?0:a+t),(r=r>a?a:r)<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var o=n(a);++i<a;)o[i]=e[i+t];return o}function Ii(e,t){var n;return Xr(e,function(e,r,i){return!(n=t(e,r,i))}),!!n}function Ni(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=D){for(;r<i;){var a=r+i>>>1,o=e[a];null!==o&&!ks(o)&&(n?o<=t:o<t)?r=a+1:i=a}return i}return Ci(e,t,Lu,n)}function Ci(e,t,n,r){t=n(t);for(var i=0,o=null==e?0:e.length,s=t!=t,u=null===t,l=ks(t),c=t===a;i<o;){var f=Xn((i+o)/2),h=n(e[f]),d=h!==a,p=null===h,m=h==h,_=ks(h);if(s)var v=r||m;else v=c?m&&(r||d):u?m&&d&&(r||!p):l?m&&d&&!p&&(r||!_):!p&&!_&&(r?h<=t:h<t);v?i=f+1:o=f}return zn(o,X)}function Oi(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var o=e[n],s=t?t(o):o;if(!n||!hs(s,u)){var u=s;a[i++]=0===o?0:o}}return a}function ki(e){return"number"==typeof e?e:ks(e)?R:+e}function Mi(e){if("string"==typeof e)return e;if(_s(e))return $t(e,Mi)+"";if(ks(e))return fr?fr.call(e):"";var t=e+"";return"0"==t&&1/e==-O?"-0":t}function Ri(e,t,n){var r=-1,i=Jt,a=e.length,s=!0,u=[],l=u;if(n)s=!1,i=Zt;else if(a>=o){var c=t?null:xa(e);if(c)return Ln(c);s=!1,i=yn,l=new Ar}else l=t?[]:u;e:for(;++r<a;){var f=e[r],h=t?t(f):f;if(f=n||0!==f?f:0,s&&h==h){for(var d=l.length;d--;)if(l[d]===h)continue e;t&&l.push(h),u.push(f)}else i(l,h,n)||(l!==u&&l.push(h),u.push(f))}return u}function Ui(e,t){return null==(e=$a(e,t=zi(t,e)))||delete e[uo(bo(t))]}function Xi(e,t,n,r){return Si(e,t,n(qr(e,t)),r)}function Di(e,t,n,r){for(var i=e.length,a=r?i:-1;(r?a--:++a<i)&&t(e[a],a,e););return n?Li(e,r?0:a,r?a+1:i):Li(e,r?a+1:0,r?i:a)}function Bi(e,t){var n=e;return n instanceof _r&&(n=n.value()),tn(t,function(e,t){return t.func.apply(t.thisArg,en([e],t.args))},n)}function ji(e,t,r){var i=e.length;if(i<2)return i?Ri(e[0]):[];for(var a=-1,o=n(i);++a<i;)for(var s=e[a],u=-1;++u<i;)u!=a&&(o[a]=Ur(o[a]||s,e[u],t,r));return Ri(Qr(o,1),t,r)}function Yi(e,t,n){for(var r=-1,i=e.length,o=t.length,s={};++r<i;){var u=r<o?t[r]:a;n(s,e[r],u)}return s}function Qi(e){return ys(e)?e:[]}function Vi(e){return"function"==typeof e?e:Lu}function zi(e,t){return _s(e)?e:Ga(e,t)?[e]:so(Vs(e))}var Gi=bi;function Hi(e,t,n){var r=e.length;return n=n===a?r:n,!t&&n>=r?e:Li(e,t,n)}var Wi=dn||function(e){return Ot.clearTimeout(e)};function qi(e,t){if(t)return e.slice();var n=e.length,r=bt?bt(n):new e.constructor(n);return e.copy(r),r}function Ki(e){var t=new e.constructor(e.byteLength);return new At(t).set(new At(e)),t}function Ji(e,t){var n=t?Ki(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Zi(e,t){if(e!==t){var n=e!==a,r=null===e,i=e==e,o=ks(e),s=t!==a,u=null===t,l=t==t,c=ks(t);if(!u&&!c&&!o&&e>t||o&&s&&l&&!u&&!c||r&&s&&l||!n&&l||!i)return 1;if(!r&&!o&&!c&&e<t||c&&n&&i&&!r&&!o||u&&n&&i||!s&&i||!l)return-1}return 0}function $i(e,t,r,i){for(var a=-1,o=e.length,s=r.length,u=-1,l=t.length,c=Vn(o-s,0),f=n(l+c),h=!i;++u<l;)f[u]=t[u];for(;++a<s;)(h||a<o)&&(f[r[a]]=e[a]);for(;c--;)f[u++]=e[a++];return f}function ea(e,t,r,i){for(var a=-1,o=e.length,s=-1,u=r.length,l=-1,c=t.length,f=Vn(o-u,0),h=n(f+c),d=!i;++a<f;)h[a]=e[a];for(var p=a;++l<c;)h[p+l]=t[l];for(;++s<u;)(d||a<o)&&(h[p+r[s]]=e[a++]);return h}function ta(e,t){var r=-1,i=e.length;for(t||(t=n(i));++r<i;)t[r]=e[r];return t}function na(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var u=t[o],l=r?r(n[u],e[u],u,n,e):a;l===a&&(l=e[u]),i?Nr(n,u,l):Er(n,u,l)}return n}function ra(e,t){return function(n,r){var i=_s(n)?Gt:Lr,a=t?t():{};return i(n,e,ka(r,2),a)}}function ia(e){return bi(function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:a,s=i>2?n[2]:a;for(o=e.length>3&&"function"==typeof o?(i--,o):a,s&&za(n[0],n[1],s)&&(o=i<3?a:o,i=1),t=et(t);++r<i;){var u=n[r];u&&e(t,u,r,o)}return t})}function aa(e,t){return function(n,r){if(null==n)return n;if(!gs(n))return e(n,r);for(var i=n.length,a=t?i:-1,o=et(n);(t?a--:++a<i)&&!1!==r(o[a],a,o););return n}}function oa(e){return function(t,n,r){for(var i=-1,a=et(t),o=r(t),s=o.length;s--;){var u=o[e?s:++i];if(!1===n(a[u],u,a))break}return t}}function sa(e){return function(t){var n=Sn(t=Vs(t))?Cn(t):a,r=n?n[0]:t.charAt(0),i=n?Hi(n,1).join(""):t.slice(1);return r[e]()+i}}function ua(e){return function(t){return tn(wu(mu(t).replace(gt,"")),e,"")}}function la(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=dr(e.prototype),r=e.apply(n,t);return Ts(r)?r:n}}function ca(e){return function(t,n,r){var i=et(t);if(!gs(t)){var o=ka(n,3);t=ru(t),n=function(e){return o(i[e],e,i)}}var s=e(t,n,r);return s>-1?i[o?t[s]:s]:a}}function fa(e){return Pa(function(t){var n=t.length,r=n,i=mr.prototype.thru;for(e&&t.reverse();r--;){var o=t[r];if("function"!=typeof o)throw new rt(u);if(i&&!s&&"wrapper"==Ca(o))var s=new mr([],!0)}for(r=s?r:n;++r<n;){var l=Ca(o=t[r]),c="wrapper"==l?Na(o):a;s=c&&Ha(c[0])&&c[1]==(F|A|b|S)&&!c[4].length&&1==c[9]?s[Ca(c[0])].apply(s,c[3]):1==o.length&&Ha(o)?s[l]():s.thru(o)}return function(){var e=arguments,r=e[0];if(s&&1==e.length&&_s(r))return s.plant(r).value();for(var i=0,a=n?t[i].apply(this,e):r;++i<n;)a=t[i].call(this,a);return a}})}function ha(e,t,r,i,o,s,u,l,c,f){var h=t&F,d=t&v,p=t&g,m=t&(A|x),_=t&T,y=p?a:la(e);return function v(){for(var g=arguments.length,A=n(g),x=g;x--;)A[x]=arguments[x];if(m)var b=Oa(v),w=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(A,b);if(i&&(A=$i(A,i,o,m)),s&&(A=ea(A,s,u,m)),g-=w,m&&g<f){var F=Pn(A,b);return ya(e,t,ha,v.placeholder,r,A,F,l,c,f-g)}var S=d?r:this,T=p?S[e]:e;return g=A.length,l?A=function(e,t){for(var n=e.length,r=zn(t.length,n),i=ta(e);r--;){var o=t[r];e[r]=Va(o,n)?i[o]:a}return e}(A,l):_&&g>1&&A.reverse(),h&&c<g&&(A.length=c),this&&this!==Ot&&this instanceof v&&(T=y||la(T)),T.apply(S,A)}}function da(e,t){return function(n,r){return function(e,t,n,r){return Gr(e,function(e,i,a){t(r,n(e),i,a)}),r}(n,e,t(r),{})}}function pa(e,t){return function(n,r){var i;if(n===a&&r===a)return t;if(n!==a&&(i=n),r!==a){if(i===a)return r;"string"==typeof n||"string"==typeof r?(n=Mi(n),r=Mi(r)):(n=ki(n),r=ki(r)),i=e(n,r)}return i}}function ma(e){return Pa(function(t){return t=$t(t,vn(ka())),bi(function(n){var r=this;return e(t,function(e){return zt(e,r,n)})})})}function _a(e,t){var n=(t=t===a?" ":Mi(t)).length;if(n<2)return n?xi(t,e):t;var r=xi(t,Un(e/Nn(t)));return Sn(t)?Hi(Cn(r),0,e).join(""):r.slice(0,e)}function va(e){return function(t,r,i){return i&&"number"!=typeof i&&za(t,r,i)&&(r=i=a),t=Ds(t),r===a?(r=t,t=0):r=Ds(r),function(e,t,r,i){for(var a=-1,o=Vn(Un((t-e)/(r||1)),0),s=n(o);o--;)s[i?o:++a]=e,e+=r;return s}(t,r,i=i===a?t<r?1:-1:Ds(i),e)}}function ga(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Ys(t),n=Ys(n)),e(t,n)}}function ya(e,t,n,r,i,o,s,u,l,c){var f=t&A;t|=f?b:w,(t&=~(f?w:b))&y||(t&=~(v|g));var h=[e,t,i,f?o:a,f?s:a,f?a:o,f?a:s,u,l,c],d=n.apply(a,h);return Ha(e)&&to(d,h),d.placeholder=r,io(d,e,t)}function Aa(e){var t=$e[e];return function(e,n){if(e=Ys(e),n=null==n?0:zn(Bs(n),292)){var r=(Vs(e)+"e").split("e");return+((r=(Vs(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var xa=$n&&1/Ln(new $n([,-0]))[1]==O?function(e){return new $n(e)}:ku;function ba(e){return function(t){var n=Ba(t);return n==K?Tn(t):n==ne?In(t):function(e,t){return $t(t,function(t){return[t,e[t]]})}(t,e(t))}}function wa(e,t,r,i,o,s,l,c){var h=t&g;if(!h&&"function"!=typeof e)throw new rt(u);var d=i?i.length:0;if(d||(t&=~(b|w),i=o=a),l=l===a?l:Vn(Bs(l),0),c=c===a?c:Bs(c),d-=o?o.length:0,t&w){var p=i,m=o;i=o=a}var _=h?a:Na(e),T=[e,t,r,i,o,p,m,s,l,c];if(_&&function(e,t){var n=e[1],r=t[1],i=n|r,a=i<(v|g|F),o=r==F&&n==A||r==F&&n==S&&e[7].length<=t[8]||r==(F|S)&&t[7].length<=t[8]&&n==A;if(!a&&!o)return e;r&v&&(e[2]=t[2],i|=n&v?0:y);var s=t[3];if(s){var u=e[3];e[3]=u?$i(u,s,t[4]):s,e[4]=u?Pn(e[3],f):t[4]}(s=t[5])&&(u=e[5],e[5]=u?ea(u,s,t[6]):s,e[6]=u?Pn(e[5],f):t[6]),(s=t[7])&&(e[7]=s),r&F&&(e[8]=null==e[8]?t[8]:zn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i}(T,_),e=T[0],t=T[1],r=T[2],i=T[3],o=T[4],!(c=T[9]=T[9]===a?h?0:e.length:Vn(T[9]-d,0))&&t&(A|x)&&(t&=~(A|x)),t&&t!=v)E=t==A||t==x?function(e,t,r){var i=la(e);return function o(){for(var s=arguments.length,u=n(s),l=s,c=Oa(o);l--;)u[l]=arguments[l];var f=s<3&&u[0]!==c&&u[s-1]!==c?[]:Pn(u,c);return(s-=f.length)<r?ya(e,t,ha,o.placeholder,a,u,f,a,a,r-s):zt(this&&this!==Ot&&this instanceof o?i:e,this,u)}}(e,t,c):t!=b&&t!=(v|b)||o.length?ha.apply(a,T):function(e,t,r,i){var a=t&v,o=la(e);return function t(){for(var s=-1,u=arguments.length,l=-1,c=i.length,f=n(c+u),h=this&&this!==Ot&&this instanceof t?o:e;++l<c;)f[l]=i[l];for(;u--;)f[l++]=arguments[++s];return zt(h,a?r:this,f)}}(e,t,r,i);else var E=function(e,t,n){var r=t&v,i=la(e);return function t(){return(this&&this!==Ot&&this instanceof t?i:e).apply(r?n:this,arguments)}}(e,t,r);return io((_?Ti:to)(E,T),e,t)}function Fa(e,t,n,r){return e===a||hs(e,ot[n])&&!lt.call(r,n)?t:e}function Sa(e,t,n,r,i,o){return Ts(e)&&Ts(t)&&(o.set(t,e),pi(e,t,a,Sa,o),o.delete(t)),e}function Ta(e){return Is(e)?a:e}function Ea(e,t,n,r,i,o){var s=n&m,u=e.length,l=t.length;if(u!=l&&!(s&&l>u))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var f=-1,h=!0,d=n&_?new Ar:a;for(o.set(e,t),o.set(t,e);++f<u;){var p=e[f],v=t[f];if(r)var g=s?r(v,p,f,t,e,o):r(p,v,f,e,t,o);if(g!==a){if(g)continue;h=!1;break}if(d){if(!rn(t,function(e,t){if(!yn(d,t)&&(p===e||i(p,e,n,r,o)))return d.push(t)})){h=!1;break}}else if(p!==v&&!i(p,v,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function Pa(e){return ro(Za(e,a,vo),e+"")}function La(e){return Kr(e,ru,Xa)}function Ia(e){return Kr(e,iu,Da)}var Na=nr?function(e){return nr.get(e)}:ku;function Ca(e){for(var t=e.name+"",n=rr[t],r=lt.call(rr,t)?n.length:0;r--;){var i=n[r],a=i.func;if(null==a||a==e)return i.name}return t}function Oa(e){return(lt.call(hr,"placeholder")?hr:e).placeholder}function ka(){var e=hr.iteratee||Iu;return e=e===Iu?si:e,arguments.length?e(arguments[0],arguments[1]):e}function Ma(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function Ra(e){for(var t=ru(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,Ka(i)]}return t}function Ua(e,t){var n=function(e,t){return null==e?a:e[t]}(e,t);return oi(n)?n:a}var Xa=Dn?function(e){return null==e?[]:(e=et(e),Kt(Dn(e),function(t){return Ct.call(e,t)}))}:ju,Da=Dn?function(e){for(var t=[];e;)en(t,Xa(e)),e=Pt(e);return t}:ju,Ba=Jr;function ja(e,t,n){for(var r=-1,i=(t=zi(t,e)).length,a=!1;++r<i;){var o=uo(t[r]);if(!(a=null!=e&&n(e,o)))break;e=e[o]}return a||++r!=i?a:!!(i=null==e?0:e.length)&&Ss(i)&&Va(o,i)&&(_s(e)||ms(e))}function Ya(e){return"function"!=typeof e.constructor||qa(e)?{}:dr(Pt(e))}function Qa(e){return _s(e)||ms(e)||!!(Mt&&e&&e[Mt])}function Va(e,t){var n=typeof e;return!!(t=null==t?k:t)&&("number"==n||"symbol"!=n&&We.test(e))&&e>-1&&e%1==0&&e<t}function za(e,t,n){if(!Ts(n))return!1;var r=typeof t;return!!("number"==r?gs(n)&&Va(t,n.length):"string"==r&&t in n)&&hs(n[t],e)}function Ga(e,t){if(_s(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ks(e))||Ie.test(e)||!Le.test(e)||null!=t&&e in et(t)}function Ha(e){var t=Ca(e),n=hr[t];if("function"!=typeof n||!(t in _r.prototype))return!1;if(e===n)return!0;var r=Na(n);return!!r&&e===r[0]}(Kn&&Ba(new Kn(new ArrayBuffer(1)))!=le||Jn&&Ba(new Jn)!=K||Zn&&"[object Promise]"!=Ba(Zn.resolve())||$n&&Ba(new $n)!=ne||er&&Ba(new er)!=oe)&&(Ba=function(e){var t=Jr(e),n=t==$?e.constructor:a,r=n?lo(n):"";if(r)switch(r){case ir:return le;case ar:return K;case or:return"[object Promise]";case sr:return ne;case ur:return oe}return t});var Wa=st?ws:Yu;function qa(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||ot)}function Ka(e){return e==e&&!Ts(e)}function Ja(e,t){return function(n){return null!=n&&n[e]===t&&(t!==a||e in et(n))}}function Za(e,t,r){return t=Vn(t===a?e.length-1:t,0),function(){for(var i=arguments,a=-1,o=Vn(i.length-t,0),s=n(o);++a<o;)s[a]=i[t+a];a=-1;for(var u=n(t+1);++a<t;)u[a]=i[a];return u[t]=r(s),zt(e,this,u)}}function $a(e,t){return t.length<2?e:qr(e,Li(t,0,-1))}function eo(e,t){if("__proto__"!=t)return e[t]}var to=ao(Ti),no=Rn||function(e,t){return Ot.setTimeout(e,t)},ro=ao(Ei);function io(e,t,n){var r=t+"";return ro(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(Ue,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return Ht(B,function(n){var r="_."+n[0];t&n[1]&&!Jt(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(Xe);return t?t[1].split(De):[]}(r),n)))}function ao(e){var t=0,n=0;return function(){var r=Gn(),i=I-(r-n);if(n=r,i>0){if(++t>=L)return arguments[0]}else t=0;return e.apply(a,arguments)}}function oo(e,t){var n=-1,r=e.length,i=r-1;for(t=t===a?r:t;++n<t;){var o=Ai(n,i),s=e[o];e[o]=e[n],e[n]=s}return e.length=t,e}var so=function(e){var t=os(e,function(e){return n.size===c&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ne,function(e,n,r,i){t.push(r?i.replace(je,"$1"):n||e)}),t});function uo(e){if("string"==typeof e||ks(e))return e;var t=e+"";return"0"==t&&1/e==-O?"-0":t}function lo(e){if(null!=e){try{return ut.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function co(e){if(e instanceof _r)return e.clone();var t=new mr(e.__wrapped__,e.__chain__);return t.__actions__=ta(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var fo=bi(function(e,t){return ys(e)?Ur(e,Qr(t,1,ys,!0)):[]}),ho=bi(function(e,t){var n=bo(t);return ys(n)&&(n=a),ys(e)?Ur(e,Qr(t,1,ys,!0),ka(n,2)):[]}),po=bi(function(e,t){var n=bo(t);return ys(n)&&(n=a),ys(e)?Ur(e,Qr(t,1,ys,!0),a,n):[]});function mo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Bs(n);return i<0&&(i=Vn(r+i,0)),sn(e,ka(t,3),i)}function _o(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==a&&(i=Bs(n),i=n<0?Vn(r+i,0):zn(i,r-1)),sn(e,ka(t,3),i,!0)}function vo(e){return null!=e&&e.length?Qr(e,1):[]}function go(e){return e&&e.length?e[0]:a}var yo=bi(function(e){var t=$t(e,Qi);return t.length&&t[0]===e[0]?ti(t):[]}),Ao=bi(function(e){var t=bo(e),n=$t(e,Qi);return t===bo(n)?t=a:n.pop(),n.length&&n[0]===e[0]?ti(n,ka(t,2)):[]}),xo=bi(function(e){var t=bo(e),n=$t(e,Qi);return(t="function"==typeof t?t:a)&&n.pop(),n.length&&n[0]===e[0]?ti(n,a,t):[]});function bo(e){var t=null==e?0:e.length;return t?e[t-1]:a}var wo=bi(Fo);function Fo(e,t){return e&&e.length&&t&&t.length?gi(e,t):e}var So=Pa(function(e,t){var n=null==e?0:e.length,r=Cr(e,t);return yi(e,$t(t,function(e){return Va(e,n)?+e:e}).sort(Zi)),r});function To(e){return null==e?e:qn.call(e)}var Eo=bi(function(e){return Ri(Qr(e,1,ys,!0))}),Po=bi(function(e){var t=bo(e);return ys(t)&&(t=a),Ri(Qr(e,1,ys,!0),ka(t,2))}),Lo=bi(function(e){var t=bo(e);return t="function"==typeof t?t:a,Ri(Qr(e,1,ys,!0),a,t)});function Io(e){if(!e||!e.length)return[];var t=0;return e=Kt(e,function(e){if(ys(e))return t=Vn(e.length,t),!0}),_n(t,function(t){return $t(e,hn(t))})}function No(e,t){if(!e||!e.length)return[];var n=Io(e);return null==t?n:$t(n,function(e){return zt(t,a,e)})}var Co=bi(function(e,t){return ys(e)?Ur(e,t):[]}),Oo=bi(function(e){return ji(Kt(e,ys))}),ko=bi(function(e){var t=bo(e);return ys(t)&&(t=a),ji(Kt(e,ys),ka(t,2))}),Mo=bi(function(e){var t=bo(e);return t="function"==typeof t?t:a,ji(Kt(e,ys),a,t)}),Ro=bi(Io);var Uo=bi(function(e){var t=e.length,n=t>1?e[t-1]:a;return No(e,n="function"==typeof n?(e.pop(),n):a)});function Xo(e){var t=hr(e);return t.__chain__=!0,t}function Do(e,t){return t(e)}var Bo=Pa(function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return Cr(t,e)};return!(t>1||this.__actions__.length)&&r instanceof _r&&Va(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:Do,args:[i],thisArg:a}),new mr(r,this.__chain__).thru(function(e){return t&&!e.length&&e.push(a),e})):this.thru(i)});var jo=ra(function(e,t,n){lt.call(e,n)?++e[n]:Nr(e,n,1)});var Yo=ca(mo),Qo=ca(_o);function Vo(e,t){return(_s(e)?Ht:Xr)(e,ka(t,3))}function zo(e,t){return(_s(e)?Wt:Dr)(e,ka(t,3))}var Go=ra(function(e,t,n){lt.call(e,n)?e[n].push(t):Nr(e,n,[t])});var Ho=bi(function(e,t,r){var i=-1,a="function"==typeof t,o=gs(e)?n(e.length):[];return Xr(e,function(e){o[++i]=a?zt(t,e,r):ni(e,t,r)}),o}),Wo=ra(function(e,t,n){Nr(e,n,t)});function qo(e,t){return(_s(e)?$t:fi)(e,ka(t,3))}var Ko=ra(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});var Jo=bi(function(e,t){if(null==e)return[];var n=t.length;return n>1&&za(e,t[0],t[1])?t=[]:n>2&&za(t[0],t[1],t[2])&&(t=[t[0]]),_i(e,Qr(t,1),[])}),Zo=Mn||function(){return Ot.Date.now()};function $o(e,t,n){return t=n?a:t,t=e&&null==t?e.length:t,wa(e,F,a,a,a,a,t)}function es(e,t){var n;if("function"!=typeof t)throw new rt(u);return e=Bs(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=a),n}}var ts=bi(function(e,t,n){var r=v;if(n.length){var i=Pn(n,Oa(ts));r|=b}return wa(e,r,t,n,i)}),ns=bi(function(e,t,n){var r=v|g;if(n.length){var i=Pn(n,Oa(ns));r|=b}return wa(t,r,e,n,i)});function rs(e,t,n){var r,i,o,s,l,c,f=0,h=!1,d=!1,p=!0;if("function"!=typeof e)throw new rt(u);function m(t){var n=r,o=i;return r=i=a,f=t,s=e.apply(o,n)}function _(e){var n=e-c;return c===a||n>=t||n<0||d&&e-f>=o}function v(){var e=Zo();if(_(e))return g(e);l=no(v,function(e){var n=t-(e-c);return d?zn(n,o-(e-f)):n}(e))}function g(e){return l=a,p&&r?m(e):(r=i=a,s)}function y(){var e=Zo(),n=_(e);if(r=arguments,i=this,c=e,n){if(l===a)return function(e){return f=e,l=no(v,t),h?m(e):s}(c);if(d)return l=no(v,t),m(c)}return l===a&&(l=no(v,t)),s}return t=Ys(t)||0,Ts(n)&&(h=!!n.leading,o=(d="maxWait"in n)?Vn(Ys(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p),y.cancel=function(){l!==a&&Wi(l),f=0,r=c=i=l=a},y.flush=function(){return l===a?s:g(Zo())},y}var is=bi(function(e,t){return Rr(e,1,t)}),as=bi(function(e,t,n){return Rr(e,Ys(t)||0,n)});function os(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new rt(u);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;if(a.has(i))return a.get(i);var o=e.apply(this,r);return n.cache=a.set(i,o)||a,o};return n.cache=new(os.Cache||yr),n}function ss(e){if("function"!=typeof e)throw new rt(u);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}os.Cache=yr;var us=Gi(function(e,t){var n=(t=1==t.length&&_s(t[0])?$t(t[0],vn(ka())):$t(Qr(t,1),vn(ka()))).length;return bi(function(r){for(var i=-1,a=zn(r.length,n);++i<a;)r[i]=t[i].call(this,r[i]);return zt(e,this,r)})}),ls=bi(function(e,t){var n=Pn(t,Oa(ls));return wa(e,b,a,t,n)}),cs=bi(function(e,t){var n=Pn(t,Oa(cs));return wa(e,w,a,t,n)}),fs=Pa(function(e,t){return wa(e,S,a,a,a,t)});function hs(e,t){return e===t||e!=e&&t!=t}var ds=ga(Zr),ps=ga(function(e,t){return e>=t}),ms=ri(function(){return arguments}())?ri:function(e){return Es(e)&&lt.call(e,"callee")&&!Ct.call(e,"callee")},_s=n.isArray,vs=Dt?vn(Dt):function(e){return Es(e)&&Jr(e)==ue};function gs(e){return null!=e&&Ss(e.length)&&!ws(e)}function ys(e){return Es(e)&&gs(e)}var As=Bn||Yu,xs=Bt?vn(Bt):function(e){return Es(e)&&Jr(e)==z};function bs(e){if(!Es(e))return!1;var t=Jr(e);return t==H||t==G||"string"==typeof e.message&&"string"==typeof e.name&&!Is(e)}function ws(e){if(!Ts(e))return!1;var t=Jr(e);return t==W||t==q||t==Q||t==ee}function Fs(e){return"number"==typeof e&&e==Bs(e)}function Ss(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}function Ts(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Es(e){return null!=e&&"object"==typeof e}var Ps=jt?vn(jt):function(e){return Es(e)&&Ba(e)==K};function Ls(e){return"number"==typeof e||Es(e)&&Jr(e)==J}function Is(e){if(!Es(e)||Jr(e)!=$)return!1;var t=Pt(e);if(null===t)return!0;var n=lt.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ut.call(n)==dt}var Ns=Yt?vn(Yt):function(e){return Es(e)&&Jr(e)==te};var Cs=Qt?vn(Qt):function(e){return Es(e)&&Ba(e)==ne};function Os(e){return"string"==typeof e||!_s(e)&&Es(e)&&Jr(e)==re}function ks(e){return"symbol"==typeof e||Es(e)&&Jr(e)==ie}var Ms=Vt?vn(Vt):function(e){return Es(e)&&Ss(e.length)&&!!Tt[Jr(e)]};var Rs=ga(ci),Us=ga(function(e,t){return e<=t});function Xs(e){if(!e)return[];if(gs(e))return Os(e)?Cn(e):ta(e);if(Ut&&e[Ut])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Ut]());var t=Ba(e);return(t==K?Tn:t==ne?Ln:hu)(e)}function Ds(e){return e?(e=Ys(e))===O||e===-O?(e<0?-1:1)*M:e==e?e:0:0===e?e:0}function Bs(e){var t=Ds(e),n=t%1;return t==t?n?t-n:t:0}function js(e){return e?Or(Bs(e),0,U):0}function Ys(e){if("number"==typeof e)return e;if(ks(e))return R;if(Ts(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Ts(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(ke,"");var n=ze.test(e);return n||He.test(e)?It(e.slice(2),n?2:8):Ve.test(e)?R:+e}function Qs(e){return na(e,iu(e))}function Vs(e){return null==e?"":Mi(e)}var zs=ia(function(e,t){if(qa(t)||gs(t))na(t,ru(t),e);else for(var n in t)lt.call(t,n)&&Er(e,n,t[n])}),Gs=ia(function(e,t){na(t,iu(t),e)}),Hs=ia(function(e,t,n,r){na(t,iu(t),e,r)}),Ws=ia(function(e,t,n,r){na(t,ru(t),e,r)}),qs=Pa(Cr);var Ks=bi(function(e,t){e=et(e);var n=-1,r=t.length,i=r>2?t[2]:a;for(i&&za(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],s=iu(o),u=-1,l=s.length;++u<l;){var c=s[u],f=e[c];(f===a||hs(f,ot[c])&&!lt.call(e,c))&&(e[c]=o[c])}return e}),Js=bi(function(e){return e.push(a,Sa),zt(ou,a,e)});function Zs(e,t,n){var r=null==e?a:qr(e,t);return r===a?n:r}function $s(e,t){return null!=e&&ja(e,t,ei)}var eu=da(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),e[t]=n},Tu(Lu)),tu=da(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ht.call(t)),lt.call(e,t)?e[t].push(n):e[t]=[n]},ka),nu=bi(ni);function ru(e){return gs(e)?br(e):ui(e)}function iu(e){return gs(e)?br(e,!0):li(e)}var au=ia(function(e,t,n){pi(e,t,n)}),ou=ia(function(e,t,n,r){pi(e,t,n,r)}),su=Pa(function(e,t){var n={};if(null==e)return n;var r=!1;t=$t(t,function(t){return t=zi(t,e),r||(r=t.length>1),t}),na(e,Ia(e),n),r&&(n=kr(n,h|d|p,Ta));for(var i=t.length;i--;)Ui(n,t[i]);return n});var uu=Pa(function(e,t){return null==e?{}:function(e,t){return vi(e,t,function(t,n){return $s(e,n)})}(e,t)});function lu(e,t){if(null==e)return{};var n=$t(Ia(e),function(e){return[e]});return t=ka(t),vi(e,n,function(e,n){return t(e,n[0])})}var cu=ba(ru),fu=ba(iu);function hu(e){return null==e?[]:gn(e,ru(e))}var du=ua(function(e,t,n){return t=t.toLowerCase(),e+(n?pu(t):t)});function pu(e){return bu(Vs(e).toLowerCase())}function mu(e){return(e=Vs(e))&&e.replace(qe,bn).replace(yt,"")}var _u=ua(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),vu=ua(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),gu=sa("toLowerCase");var yu=ua(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});var Au=ua(function(e,t,n){return e+(n?" ":"")+bu(t)});var xu=ua(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),bu=sa("toUpperCase");function wu(e,t,n){return e=Vs(e),(t=n?a:t)===a?function(e){return wt.test(e)}(e)?function(e){return e.match(xt)||[]}(e):function(e){return e.match(Be)||[]}(e):e.match(t)||[]}var Fu=bi(function(e,t){try{return zt(e,a,t)}catch(e){return bs(e)?e:new i(e)}}),Su=Pa(function(e,t){return Ht(t,function(t){t=uo(t),Nr(e,t,ts(e[t],e))}),e});function Tu(e){return function(){return e}}var Eu=fa(),Pu=fa(!0);function Lu(e){return e}function Iu(e){return si("function"==typeof e?e:kr(e,h))}var Nu=bi(function(e,t){return function(n){return ni(n,e,t)}}),Cu=bi(function(e,t){return function(n){return ni(e,n,t)}});function Ou(e,t,n){var r=ru(t),i=Wr(t,r);null!=n||Ts(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=Wr(t,ru(t)));var a=!(Ts(n)&&"chain"in n&&!n.chain),o=ws(e);return Ht(i,function(n){var r=t[n];e[n]=r,o&&(e.prototype[n]=function(){var t=this.__chain__;if(a||t){var n=e(this.__wrapped__);return(n.__actions__=ta(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,en([this.value()],arguments))})}),e}function ku(){}var Mu=ma($t),Ru=ma(qt),Uu=ma(rn);function Xu(e){return Ga(e)?hn(uo(e)):function(e){return function(t){return qr(t,e)}}(e)}var Du=va(),Bu=va(!0);function ju(){return[]}function Yu(){return!1}var Qu=pa(function(e,t){return e+t},0),Vu=Aa("ceil"),zu=pa(function(e,t){return e/t},1),Gu=Aa("floor");var Hu=pa(function(e,t){return e*t},1),Wu=Aa("round"),qu=pa(function(e,t){return e-t},0);return hr.after=function(e,t){if("function"!=typeof t)throw new rt(u);return e=Bs(e),function(){if(--e<1)return t.apply(this,arguments)}},hr.ary=$o,hr.assign=zs,hr.assignIn=Gs,hr.assignInWith=Hs,hr.assignWith=Ws,hr.at=qs,hr.before=es,hr.bind=ts,hr.bindAll=Su,hr.bindKey=ns,hr.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return _s(e)?e:[e]},hr.chain=Xo,hr.chunk=function(e,t,r){t=(r?za(e,t,r):t===a)?1:Vn(Bs(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var o=0,s=0,u=n(Un(i/t));o<i;)u[s++]=Li(e,o,o+=t);return u},hr.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var a=e[t];a&&(i[r++]=a)}return i},hr.concat=function(){var e=arguments.length;if(!e)return[];for(var t=n(e-1),r=arguments[0],i=e;i--;)t[i-1]=arguments[i];return en(_s(r)?ta(r):[r],Qr(t,1))},hr.cond=function(e){var t=null==e?0:e.length,n=ka();return e=t?$t(e,function(e){if("function"!=typeof e[1])throw new rt(u);return[n(e[0]),e[1]]}):[],bi(function(n){for(var r=-1;++r<t;){var i=e[r];if(zt(i[0],this,n))return zt(i[1],this,n)}})},hr.conforms=function(e){return function(e){var t=ru(e);return function(n){return Mr(n,e,t)}}(kr(e,h))},hr.constant=Tu,hr.countBy=jo,hr.create=function(e,t){var n=dr(e);return null==t?n:Ir(n,t)},hr.curry=function e(t,n,r){var i=wa(t,A,a,a,a,a,a,n=r?a:n);return i.placeholder=e.placeholder,i},hr.curryRight=function e(t,n,r){var i=wa(t,x,a,a,a,a,a,n=r?a:n);return i.placeholder=e.placeholder,i},hr.debounce=rs,hr.defaults=Ks,hr.defaultsDeep=Js,hr.defer=is,hr.delay=as,hr.difference=fo,hr.differenceBy=ho,hr.differenceWith=po,hr.drop=function(e,t,n){var r=null==e?0:e.length;return r?Li(e,(t=n||t===a?1:Bs(t))<0?0:t,r):[]},hr.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?Li(e,0,(t=r-(t=n||t===a?1:Bs(t)))<0?0:t):[]},hr.dropRightWhile=function(e,t){return e&&e.length?Di(e,ka(t,3),!0,!0):[]},hr.dropWhile=function(e,t){return e&&e.length?Di(e,ka(t,3),!0):[]},hr.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&za(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=Bs(n))<0&&(n=-n>i?0:i+n),(r=r===a||r>i?i:Bs(r))<0&&(r+=i),r=n>r?0:js(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},hr.filter=function(e,t){return(_s(e)?Kt:Yr)(e,ka(t,3))},hr.flatMap=function(e,t){return Qr(qo(e,t),1)},hr.flatMapDeep=function(e,t){return Qr(qo(e,t),O)},hr.flatMapDepth=function(e,t,n){return n=n===a?1:Bs(n),Qr(qo(e,t),n)},hr.flatten=vo,hr.flattenDeep=function(e){return null!=e&&e.length?Qr(e,O):[]},hr.flattenDepth=function(e,t){return null!=e&&e.length?Qr(e,t=t===a?1:Bs(t)):[]},hr.flip=function(e){return wa(e,T)},hr.flow=Eu,hr.flowRight=Pu,hr.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},hr.functions=function(e){return null==e?[]:Wr(e,ru(e))},hr.functionsIn=function(e){return null==e?[]:Wr(e,iu(e))},hr.groupBy=Go,hr.initial=function(e){return null!=e&&e.length?Li(e,0,-1):[]},hr.intersection=yo,hr.intersectionBy=Ao,hr.intersectionWith=xo,hr.invert=eu,hr.invertBy=tu,hr.invokeMap=Ho,hr.iteratee=Iu,hr.keyBy=Wo,hr.keys=ru,hr.keysIn=iu,hr.map=qo,hr.mapKeys=function(e,t){var n={};return t=ka(t,3),Gr(e,function(e,r,i){Nr(n,t(e,r,i),e)}),n},hr.mapValues=function(e,t){var n={};return t=ka(t,3),Gr(e,function(e,r,i){Nr(n,r,t(e,r,i))}),n},hr.matches=function(e){return hi(kr(e,h))},hr.matchesProperty=function(e,t){return di(e,kr(t,h))},hr.memoize=os,hr.merge=au,hr.mergeWith=ou,hr.method=Nu,hr.methodOf=Cu,hr.mixin=Ou,hr.negate=ss,hr.nthArg=function(e){return e=Bs(e),bi(function(t){return mi(t,e)})},hr.omit=su,hr.omitBy=function(e,t){return lu(e,ss(ka(t)))},hr.once=function(e){return es(2,e)},hr.orderBy=function(e,t,n,r){return null==e?[]:(_s(t)||(t=null==t?[]:[t]),_s(n=r?a:n)||(n=null==n?[]:[n]),_i(e,t,n))},hr.over=Mu,hr.overArgs=us,hr.overEvery=Ru,hr.overSome=Uu,hr.partial=ls,hr.partialRight=cs,hr.partition=Ko,hr.pick=uu,hr.pickBy=lu,hr.property=Xu,hr.propertyOf=function(e){return function(t){return null==e?a:qr(e,t)}},hr.pull=wo,hr.pullAll=Fo,hr.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?gi(e,t,ka(n,2)):e},hr.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?gi(e,t,a,n):e},hr.pullAt=So,hr.range=Du,hr.rangeRight=Bu,hr.rearg=fs,hr.reject=function(e,t){return(_s(e)?Kt:Yr)(e,ss(ka(t,3)))},hr.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],a=e.length;for(t=ka(t,3);++r<a;){var o=e[r];t(o,r,e)&&(n.push(o),i.push(r))}return yi(e,i),n},hr.rest=function(e,t){if("function"!=typeof e)throw new rt(u);return bi(e,t=t===a?t:Bs(t))},hr.reverse=To,hr.sampleSize=function(e,t,n){return t=(n?za(e,t,n):t===a)?1:Bs(t),(_s(e)?Fr:Fi)(e,t)},hr.set=function(e,t,n){return null==e?e:Si(e,t,n)},hr.setWith=function(e,t,n,r){return r="function"==typeof r?r:a,null==e?e:Si(e,t,n,r)},hr.shuffle=function(e){return(_s(e)?Sr:Pi)(e)},hr.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&za(e,t,n)?(t=0,n=r):(t=null==t?0:Bs(t),n=n===a?r:Bs(n)),Li(e,t,n)):[]},hr.sortBy=Jo,hr.sortedUniq=function(e){return e&&e.length?Oi(e):[]},hr.sortedUniqBy=function(e,t){return e&&e.length?Oi(e,ka(t,2)):[]},hr.split=function(e,t,n){return n&&"number"!=typeof n&&za(e,t,n)&&(t=n=a),(n=n===a?U:n>>>0)?(e=Vs(e))&&("string"==typeof t||null!=t&&!Ns(t))&&!(t=Mi(t))&&Sn(e)?Hi(Cn(e),0,n):e.split(t,n):[]},hr.spread=function(e,t){if("function"!=typeof e)throw new rt(u);return t=null==t?0:Vn(Bs(t),0),bi(function(n){var r=n[t],i=Hi(n,0,t);return r&&en(i,r),zt(e,this,i)})},hr.tail=function(e){var t=null==e?0:e.length;return t?Li(e,1,t):[]},hr.take=function(e,t,n){return e&&e.length?Li(e,0,(t=n||t===a?1:Bs(t))<0?0:t):[]},hr.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?Li(e,(t=r-(t=n||t===a?1:Bs(t)))<0?0:t,r):[]},hr.takeRightWhile=function(e,t){return e&&e.length?Di(e,ka(t,3),!1,!0):[]},hr.takeWhile=function(e,t){return e&&e.length?Di(e,ka(t,3)):[]},hr.tap=function(e,t){return t(e),e},hr.throttle=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new rt(u);return Ts(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),rs(e,t,{leading:r,maxWait:t,trailing:i})},hr.thru=Do,hr.toArray=Xs,hr.toPairs=cu,hr.toPairsIn=fu,hr.toPath=function(e){return _s(e)?$t(e,uo):ks(e)?[e]:ta(so(Vs(e)))},hr.toPlainObject=Qs,hr.transform=function(e,t,n){var r=_s(e),i=r||As(e)||Ms(e);if(t=ka(t,4),null==n){var a=e&&e.constructor;n=i?r?new a:[]:Ts(e)&&ws(a)?dr(Pt(e)):{}}return(i?Ht:Gr)(e,function(e,r,i){return t(n,e,r,i)}),n},hr.unary=function(e){return $o(e,1)},hr.union=Eo,hr.unionBy=Po,hr.unionWith=Lo,hr.uniq=function(e){return e&&e.length?Ri(e):[]},hr.uniqBy=function(e,t){return e&&e.length?Ri(e,ka(t,2)):[]},hr.uniqWith=function(e,t){return t="function"==typeof t?t:a,e&&e.length?Ri(e,a,t):[]},hr.unset=function(e,t){return null==e||Ui(e,t)},hr.unzip=Io,hr.unzipWith=No,hr.update=function(e,t,n){return null==e?e:Xi(e,t,Vi(n))},hr.updateWith=function(e,t,n,r){return r="function"==typeof r?r:a,null==e?e:Xi(e,t,Vi(n),r)},hr.values=hu,hr.valuesIn=function(e){return null==e?[]:gn(e,iu(e))},hr.without=Co,hr.words=wu,hr.wrap=function(e,t){return ls(Vi(t),e)},hr.xor=Oo,hr.xorBy=ko,hr.xorWith=Mo,hr.zip=Ro,hr.zipObject=function(e,t){return Yi(e||[],t||[],Er)},hr.zipObjectDeep=function(e,t){return Yi(e||[],t||[],Si)},hr.zipWith=Uo,hr.entries=cu,hr.entriesIn=fu,hr.extend=Gs,hr.extendWith=Hs,Ou(hr,hr),hr.add=Qu,hr.attempt=Fu,hr.camelCase=du,hr.capitalize=pu,hr.ceil=Vu,hr.clamp=function(e,t,n){return n===a&&(n=t,t=a),n!==a&&(n=(n=Ys(n))==n?n:0),t!==a&&(t=(t=Ys(t))==t?t:0),Or(Ys(e),t,n)},hr.clone=function(e){return kr(e,p)},hr.cloneDeep=function(e){return kr(e,h|p)},hr.cloneDeepWith=function(e,t){return kr(e,h|p,t="function"==typeof t?t:a)},hr.cloneWith=function(e,t){return kr(e,p,t="function"==typeof t?t:a)},hr.conformsTo=function(e,t){return null==t||Mr(e,t,ru(t))},hr.deburr=mu,hr.defaultTo=function(e,t){return null==e||e!=e?t:e},hr.divide=zu,hr.endsWith=function(e,t,n){e=Vs(e),t=Mi(t);var r=e.length,i=n=n===a?r:Or(Bs(n),0,r);return(n-=t.length)>=0&&e.slice(n,i)==t},hr.eq=hs,hr.escape=function(e){return(e=Vs(e))&&Se.test(e)?e.replace(we,wn):e},hr.escapeRegExp=function(e){return(e=Vs(e))&&Oe.test(e)?e.replace(Ce,"\\$&"):e},hr.every=function(e,t,n){var r=_s(e)?qt:Br;return n&&za(e,t,n)&&(t=a),r(e,ka(t,3))},hr.find=Yo,hr.findIndex=mo,hr.findKey=function(e,t){return on(e,ka(t,3),Gr)},hr.findLast=Qo,hr.findLastIndex=_o,hr.findLastKey=function(e,t){return on(e,ka(t,3),Hr)},hr.floor=Gu,hr.forEach=Vo,hr.forEachRight=zo,hr.forIn=function(e,t){return null==e?e:Vr(e,ka(t,3),iu)},hr.forInRight=function(e,t){return null==e?e:zr(e,ka(t,3),iu)},hr.forOwn=function(e,t){return e&&Gr(e,ka(t,3))},hr.forOwnRight=function(e,t){return e&&Hr(e,ka(t,3))},hr.get=Zs,hr.gt=ds,hr.gte=ps,hr.has=function(e,t){return null!=e&&ja(e,t,$r)},hr.hasIn=$s,hr.head=go,hr.identity=Lu,hr.includes=function(e,t,n,r){e=gs(e)?e:hu(e),n=n&&!r?Bs(n):0;var i=e.length;return n<0&&(n=Vn(i+n,0)),Os(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&un(e,t,n)>-1},hr.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Bs(n);return i<0&&(i=Vn(r+i,0)),un(e,t,i)},hr.inRange=function(e,t,n){return t=Ds(t),n===a?(n=t,t=0):n=Ds(n),function(e,t,n){return e>=zn(t,n)&&e<Vn(t,n)}(e=Ys(e),t,n)},hr.invoke=nu,hr.isArguments=ms,hr.isArray=_s,hr.isArrayBuffer=vs,hr.isArrayLike=gs,hr.isArrayLikeObject=ys,hr.isBoolean=function(e){return!0===e||!1===e||Es(e)&&Jr(e)==V},hr.isBuffer=As,hr.isDate=xs,hr.isElement=function(e){return Es(e)&&1===e.nodeType&&!Is(e)},hr.isEmpty=function(e){if(null==e)return!0;if(gs(e)&&(_s(e)||"string"==typeof e||"function"==typeof e.splice||As(e)||Ms(e)||ms(e)))return!e.length;var t=Ba(e);if(t==K||t==ne)return!e.size;if(qa(e))return!ui(e).length;for(var n in e)if(lt.call(e,n))return!1;return!0},hr.isEqual=function(e,t){return ii(e,t)},hr.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:a)?n(e,t):a;return r===a?ii(e,t,a,n):!!r},hr.isError=bs,hr.isFinite=function(e){return"number"==typeof e&&jn(e)},hr.isFunction=ws,hr.isInteger=Fs,hr.isLength=Ss,hr.isMap=Ps,hr.isMatch=function(e,t){return e===t||ai(e,t,Ra(t))},hr.isMatchWith=function(e,t,n){return n="function"==typeof n?n:a,ai(e,t,Ra(t),n)},hr.isNaN=function(e){return Ls(e)&&e!=+e},hr.isNative=function(e){if(Wa(e))throw new i(s);return oi(e)},hr.isNil=function(e){return null==e},hr.isNull=function(e){return null===e},hr.isNumber=Ls,hr.isObject=Ts,hr.isObjectLike=Es,hr.isPlainObject=Is,hr.isRegExp=Ns,hr.isSafeInteger=function(e){return Fs(e)&&e>=-k&&e<=k},hr.isSet=Cs,hr.isString=Os,hr.isSymbol=ks,hr.isTypedArray=Ms,hr.isUndefined=function(e){return e===a},hr.isWeakMap=function(e){return Es(e)&&Ba(e)==oe},hr.isWeakSet=function(e){return Es(e)&&Jr(e)==se},hr.join=function(e,t){return null==e?"":Yn.call(e,t)},hr.kebabCase=_u,hr.last=bo,hr.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return n!==a&&(i=(i=Bs(n))<0?Vn(r+i,0):zn(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):sn(e,cn,i,!0)},hr.lowerCase=vu,hr.lowerFirst=gu,hr.lt=Rs,hr.lte=Us,hr.max=function(e){return e&&e.length?jr(e,Lu,Zr):a},hr.maxBy=function(e,t){return e&&e.length?jr(e,ka(t,2),Zr):a},hr.mean=function(e){return fn(e,Lu)},hr.meanBy=function(e,t){return fn(e,ka(t,2))},hr.min=function(e){return e&&e.length?jr(e,Lu,ci):a},hr.minBy=function(e,t){return e&&e.length?jr(e,ka(t,2),ci):a},hr.stubArray=ju,hr.stubFalse=Yu,hr.stubObject=function(){return{}},hr.stubString=function(){return""},hr.stubTrue=function(){return!0},hr.multiply=Hu,hr.nth=function(e,t){return e&&e.length?mi(e,Bs(t)):a},hr.noConflict=function(){return Ot._===this&&(Ot._=pt),this},hr.noop=ku,hr.now=Zo,hr.pad=function(e,t,n){e=Vs(e);var r=(t=Bs(t))?Nn(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return _a(Xn(i),n)+e+_a(Un(i),n)},hr.padEnd=function(e,t,n){e=Vs(e);var r=(t=Bs(t))?Nn(e):0;return t&&r<t?e+_a(t-r,n):e},hr.padStart=function(e,t,n){e=Vs(e);var r=(t=Bs(t))?Nn(e):0;return t&&r<t?_a(t-r,n)+e:e},hr.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Hn(Vs(e).replace(Me,""),t||0)},hr.random=function(e,t,n){if(n&&"boolean"!=typeof n&&za(e,t,n)&&(t=n=a),n===a&&("boolean"==typeof t?(n=t,t=a):"boolean"==typeof e&&(n=e,e=a)),e===a&&t===a?(e=0,t=1):(e=Ds(e),t===a?(t=e,e=0):t=Ds(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=Wn();return zn(e+i*(t-e+Lt("1e-"+((i+"").length-1))),t)}return Ai(e,t)},hr.reduce=function(e,t,n){var r=_s(e)?tn:pn,i=arguments.length<3;return r(e,ka(t,4),n,i,Xr)},hr.reduceRight=function(e,t,n){var r=_s(e)?nn:pn,i=arguments.length<3;return r(e,ka(t,4),n,i,Dr)},hr.repeat=function(e,t,n){return t=(n?za(e,t,n):t===a)?1:Bs(t),xi(Vs(e),t)},hr.replace=function(){var e=arguments,t=Vs(e[0]);return e.length<3?t:t.replace(e[1],e[2])},hr.result=function(e,t,n){var r=-1,i=(t=zi(t,e)).length;for(i||(i=1,e=a);++r<i;){var o=null==e?a:e[uo(t[r])];o===a&&(r=i,o=n),e=ws(o)?o.call(e):o}return e},hr.round=Wu,hr.runInContext=e,hr.sample=function(e){return(_s(e)?wr:wi)(e)},hr.size=function(e){if(null==e)return 0;if(gs(e))return Os(e)?Nn(e):e.length;var t=Ba(e);return t==K||t==ne?e.size:ui(e).length},hr.snakeCase=yu,hr.some=function(e,t,n){var r=_s(e)?rn:Ii;return n&&za(e,t,n)&&(t=a),r(e,ka(t,3))},hr.sortedIndex=function(e,t){return Ni(e,t)},hr.sortedIndexBy=function(e,t,n){return Ci(e,t,ka(n,2))},hr.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=Ni(e,t);if(r<n&&hs(e[r],t))return r}return-1},hr.sortedLastIndex=function(e,t){return Ni(e,t,!0)},hr.sortedLastIndexBy=function(e,t,n){return Ci(e,t,ka(n,2),!0)},hr.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Ni(e,t,!0)-1;if(hs(e[n],t))return n}return-1},hr.startCase=Au,hr.startsWith=function(e,t,n){return e=Vs(e),n=null==n?0:Or(Bs(n),0,e.length),t=Mi(t),e.slice(n,n+t.length)==t},hr.subtract=qu,hr.sum=function(e){return e&&e.length?mn(e,Lu):0},hr.sumBy=function(e,t){return e&&e.length?mn(e,ka(t,2)):0},hr.template=function(e,t,n){var r=hr.templateSettings;n&&za(e,t,n)&&(t=a),e=Vs(e),t=Hs({},t,r,Fa);var i,o,s=Hs({},t.imports,r.imports,Fa),u=ru(s),l=gn(s,u),c=0,f=t.interpolate||Ke,h="__p += '",d=tt((t.escape||Ke).source+"|"+f.source+"|"+(f===Pe?Ye:Ke).source+"|"+(t.evaluate||Ke).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++St+"]")+"\n";e.replace(d,function(t,n,r,a,s,u){return r||(r=a),h+=e.slice(c,u).replace(Je,Fn),n&&(i=!0,h+="' +\n__e("+n+") +\n'"),s&&(o=!0,h+="';\n"+s+";\n__p += '"),r&&(h+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+t.length,t}),h+="';\n";var m=t.variable;m||(h="with (obj) {\n"+h+"\n}\n"),h=(o?h.replace(ye,""):h).replace(Ae,"$1").replace(xe,"$1;"),h="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+h+"return __p\n}";var _=Fu(function(){return Ze(u,p+"return "+h).apply(a,l)});if(_.source=h,bs(_))throw _;return _},hr.times=function(e,t){if((e=Bs(e))<1||e>k)return[];var n=U,r=zn(e,U);t=ka(t),e-=U;for(var i=_n(r,t);++n<e;)t(n);return i},hr.toFinite=Ds,hr.toInteger=Bs,hr.toLength=js,hr.toLower=function(e){return Vs(e).toLowerCase()},hr.toNumber=Ys,hr.toSafeInteger=function(e){return e?Or(Bs(e),-k,k):0===e?e:0},hr.toString=Vs,hr.toUpper=function(e){return Vs(e).toUpperCase()},hr.trim=function(e,t,n){if((e=Vs(e))&&(n||t===a))return e.replace(ke,"");if(!e||!(t=Mi(t)))return e;var r=Cn(e),i=Cn(t);return Hi(r,An(r,i),xn(r,i)+1).join("")},hr.trimEnd=function(e,t,n){if((e=Vs(e))&&(n||t===a))return e.replace(Re,"");if(!e||!(t=Mi(t)))return e;var r=Cn(e);return Hi(r,0,xn(r,Cn(t))+1).join("")},hr.trimStart=function(e,t,n){if((e=Vs(e))&&(n||t===a))return e.replace(Me,"");if(!e||!(t=Mi(t)))return e;var r=Cn(e);return Hi(r,An(r,Cn(t))).join("")},hr.truncate=function(e,t){var n=E,r=P;if(Ts(t)){var i="separator"in t?t.separator:i;n="length"in t?Bs(t.length):n,r="omission"in t?Mi(t.omission):r}var o=(e=Vs(e)).length;if(Sn(e)){var s=Cn(e);o=s.length}if(n>=o)return e;var u=n-Nn(r);if(u<1)return r;var l=s?Hi(s,0,u).join(""):e.slice(0,u);if(i===a)return l+r;if(s&&(u+=l.length-u),Ns(i)){if(e.slice(u).search(i)){var c,f=l;for(i.global||(i=tt(i.source,Vs(Qe.exec(i))+"g")),i.lastIndex=0;c=i.exec(f);)var h=c.index;l=l.slice(0,h===a?u:h)}}else if(e.indexOf(Mi(i),u)!=u){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+r},hr.unescape=function(e){return(e=Vs(e))&&Fe.test(e)?e.replace(be,On):e},hr.uniqueId=function(e){var t=++ct;return Vs(e)+t},hr.upperCase=xu,hr.upperFirst=bu,hr.each=Vo,hr.eachRight=zo,hr.first=go,Ou(hr,function(){var e={};return Gr(hr,function(t,n){lt.call(hr.prototype,n)||(e[n]=t)}),e}(),{chain:!1}),hr.VERSION="4.17.11",Ht(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){hr[e].placeholder=hr}),Ht(["drop","take"],function(e,t){_r.prototype[e]=function(n){n=n===a?1:Vn(Bs(n),0);var r=this.__filtered__&&!t?new _r(this):this.clone();return r.__filtered__?r.__takeCount__=zn(n,r.__takeCount__):r.__views__.push({size:zn(n,U),type:e+(r.__dir__<0?"Right":"")}),r},_r.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Ht(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n==N||3==n;_r.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:ka(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}}),Ht(["head","last"],function(e,t){var n="take"+(t?"Right":"");_r.prototype[e]=function(){return this[n](1).value()[0]}}),Ht(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");_r.prototype[e]=function(){return this.__filtered__?new _r(this):this[n](1)}}),_r.prototype.compact=function(){return this.filter(Lu)},_r.prototype.find=function(e){return this.filter(e).head()},_r.prototype.findLast=function(e){return this.reverse().find(e)},_r.prototype.invokeMap=bi(function(e,t){return"function"==typeof e?new _r(this):this.map(function(n){return ni(n,e,t)})}),_r.prototype.reject=function(e){return this.filter(ss(ka(e)))},_r.prototype.slice=function(e,t){e=Bs(e);var n=this;return n.__filtered__&&(e>0||t<0)?new _r(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==a&&(n=(t=Bs(t))<0?n.dropRight(-t):n.take(t-e)),n)},_r.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},_r.prototype.toArray=function(){return this.take(U)},Gr(_r.prototype,function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=hr[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);i&&(hr.prototype[t]=function(){var t=this.__wrapped__,s=r?[1]:arguments,u=t instanceof _r,l=s[0],c=u||_s(t),f=function(e){var t=i.apply(hr,en([e],s));return r&&h?t[0]:t};c&&n&&"function"==typeof l&&1!=l.length&&(u=c=!1);var h=this.__chain__,d=!!this.__actions__.length,p=o&&!h,m=u&&!d;if(!o&&c){t=m?t:new _r(this);var _=e.apply(t,s);return _.__actions__.push({func:Do,args:[f],thisArg:a}),new mr(_,h)}return p&&m?e.apply(this,s):(_=this.thru(f),p?r?_.value()[0]:_.value():_)})}),Ht(["pop","push","shift","sort","splice","unshift"],function(e){var t=it[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);hr.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(_s(i)?i:[],e)}return this[n](function(n){return t.apply(_s(n)?n:[],e)})}}),Gr(_r.prototype,function(e,t){var n=hr[t];if(n){var r=n.name+"";(rr[r]||(rr[r]=[])).push({name:t,func:n})}}),rr[ha(a,g).name]=[{name:"wrapper",func:a}],_r.prototype.clone=function(){var e=new _r(this.__wrapped__);return e.__actions__=ta(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ta(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ta(this.__views__),e},_r.prototype.reverse=function(){if(this.__filtered__){var e=new _r(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},_r.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=_s(e),r=t<0,i=n?e.length:0,a=function(e,t,n){for(var r=-1,i=n.length;++r<i;){var a=n[r],o=a.size;switch(a.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=zn(t,e+o);break;case"takeRight":e=Vn(e,t-o)}}return{start:e,end:t}}(0,i,this.__views__),o=a.start,s=a.end,u=s-o,l=r?s:o-1,c=this.__iteratees__,f=c.length,h=0,d=zn(u,this.__takeCount__);if(!n||!r&&i==u&&d==u)return Bi(e,this.__actions__);var p=[];e:for(;u--&&h<d;){for(var m=-1,_=e[l+=t];++m<f;){var v=c[m],g=v.iteratee,y=v.type,A=g(_);if(y==C)_=A;else if(!A){if(y==N)continue e;break e}}p[h++]=_}return p},hr.prototype.at=Bo,hr.prototype.chain=function(){return Xo(this)},hr.prototype.commit=function(){return new mr(this.value(),this.__chain__)},hr.prototype.next=function(){this.__values__===a&&(this.__values__=Xs(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?a:this.__values__[this.__index__++]}},hr.prototype.plant=function(e){for(var t,n=this;n instanceof pr;){var r=co(n);r.__index__=0,r.__values__=a,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},hr.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof _r){var t=e;return this.__actions__.length&&(t=new _r(this)),(t=t.reverse()).__actions__.push({func:Do,args:[To],thisArg:a}),new mr(t,this.__chain__)}return this.thru(To)},hr.prototype.toJSON=hr.prototype.valueOf=hr.prototype.value=function(){return Bi(this.__wrapped__,this.__actions__)},hr.prototype.first=hr.prototype.head,Ut&&(hr.prototype[Ut]=function(){return this}),hr}();Ot._=kn,(i=function(){return kn}.call(t,n,t,r))===a||(r.exports=i)}).call(this)}).call(this,n(7),n(8)(e))},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),a=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(a).concat([i]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(r[a]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r={},i=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),a=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=function(e,t){return t?t.querySelector(e):document.querySelector(e)}.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),o=null,s=0,u=[],l=n(11);function c(e,t){for(var n=0;n<e.length;n++){var i=e[n],a=r[i.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](i.parts[o]);for(;o<i.parts.length;o++)a.parts.push(_(i.parts[o],t))}else{var s=[];for(o=0;o<i.parts.length;o++)s.push(_(i.parts[o],t));r[i.id]={id:i.id,refs:1,parts:s}}}}function f(e,t){for(var n=[],r={},i=0;i<e.length;i++){var a=e[i],o=t.base?a[0]+t.base:a[0],s={css:a[1],media:a[2],sourceMap:a[3]};r[o]?r[o].parts.push(s):n.push(r[o]={id:o,parts:[s]})}return n}function h(e,t){var n=a(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=u[u.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=a(e.insertAt.before,n);n.insertBefore(t,i)}}function d(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=u.indexOf(e);t>=0&&u.splice(t,1)}function p(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return m(t,e.attrs),h(e,t),t}function m(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function _(e,t){var n,r,i,a;if(t.transform&&e.css){if(!(a="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=a}if(t.singleton){var u=s++;n=o||(o=p(t)),r=g.bind(null,n,u,!1),i=g.bind(null,n,u,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",m(t,e.attrs),h(e,t),t}(t),r=function(e,t,n){var r=n.css,i=n.sourceMap,a=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||a)&&(r=l(r));i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(o),s&&URL.revokeObjectURL(s)}.bind(null,n,t),i=function(){d(n),n.href&&URL.revokeObjectURL(n.href)}):(n=p(t),r=function(e,t){var n=t.css,r=t.media;r&&e.setAttribute("media",r);if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),i=function(){d(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=i()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=f(e,t);return c(n,t),function(e){for(var i=[],a=0;a<n.length;a++){var o=n[a];(s=r[o.id]).refs--,i.push(s)}e&&c(f(e,t),t);for(a=0;a<i.length;a++){var s;if(0===(s=i[a]).refs){for(var u=0;u<s.parts.length;u++)s.parts[u]();delete r[s.id]}}}};var v=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}();function g(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=v(t,i);else{var a=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(a,o[t]):e.appendChild(a)}}},function(e,t){
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */(function(){"use strict";var e=void 0,t=this;function n(n,r){var i,a=n.split("."),o=t;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(i=a.shift());)a.length||r===e?o=o[i]?o[i]:o[i]={}:o[i]=r}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function i(e){var t,n,i,a,o,s,u,l,c,f,h=e.length,d=0,p=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)e[l]>d&&(d=e[l]),e[l]<p&&(p=e[l]);for(t=1<<d,n=new(r?Uint32Array:Array)(t),i=1,a=0,o=2;i<=d;){for(l=0;l<h;++l)if(e[l]===i){for(s=0,u=a,c=0;c<i;++c)s=s<<1|1&u,u>>=1;for(f=i<<16|l,c=s;c<t;c+=o)n[c]=f;++a}++i,a<<=1,o<<=1}return[n,d,p]}function a(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=r?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case o:this.b=32768,this.c=new(r?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(r?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var o=0,s=1,u={t:o,s:s};a.prototype.k=function(){for(;!this.m;){var t=E(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var n=this.input,a=this.a,u=this.c,l=this.b,c=n.length,f=e,d=u.length,p=e;if(this.d=this.f=0,a+1>=c)throw Error("invalid uncompressed block header: LEN");if(f=n[a++]|n[a++]<<8,a+1>=c)throw Error("invalid uncompressed block header: NLEN");if(f===~(n[a++]|n[a++]<<8))throw Error("invalid uncompressed block header: length verify");if(a+f>n.length)throw Error("input buffer is broken");switch(this.i){case o:for(;l+f>u.length;){if(f-=p=d-l,r)u.set(n.subarray(a,a+p),l),l+=p,a+=p;else for(;p--;)u[l++]=n[a++];this.b=l,u=this.e(),l=this.b}break;case s:for(;l+f>u.length;)u=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(r)u.set(n.subarray(a,a+f),l),l+=f,a+=f;else for(;f--;)u[l++]=n[a++];this.a=a,this.b=l,this.c=u;break;case 1:this.j(F,T);break;case 2:var m,_,v,g,y=E(this,5)+257,A=E(this,5)+1,x=E(this,4)+4,b=new(r?Uint8Array:Array)(h.length),w=e,S=e,L=e,I=e,N=e;for(N=0;N<x;++N)b[h[N]]=E(this,3);if(!r)for(N=x,x=b.length;N<x;++N)b[h[N]]=0;for(m=i(b),w=new(r?Uint8Array:Array)(y+A),N=0,g=y+A;N<g;)switch(S=P(this,m),S){case 16:for(I=3+E(this,2);I--;)w[N++]=L;break;case 17:for(I=3+E(this,3);I--;)w[N++]=0;L=0;break;case 18:for(I=11+E(this,7);I--;)w[N++]=0;L=0;break;default:L=w[N++]=S}_=i(r?w.subarray(0,y):w.slice(0,y)),v=i(r?w.subarray(y):w.slice(y)),this.j(_,v);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var l,c,f=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=r?new Uint16Array(f):f,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],p=r?new Uint16Array(d):d,m=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],_=r?new Uint8Array(m):m,v=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],g=r?new Uint16Array(v):v,y=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=r?new Uint8Array(y):y,x=new(r?Uint8Array:Array)(288);for(l=0,c=x.length;l<c;++l)x[l]=143>=l?8:255>=l?9:279>=l?7:8;var b,w,F=i(x),S=new(r?Uint8Array:Array)(30);for(b=0,w=S.length;b<w;++b)S[b]=5;var T=i(S);function E(e,t){for(var n,r=e.f,i=e.d,a=e.input,o=e.a,s=a.length;i<t;){if(o>=s)throw Error("input buffer is broken");r|=a[o++]<<i,i+=8}return n=r&(1<<t)-1,e.f=r>>>t,e.d=i-t,e.a=o,n}function P(e,t){for(var n,r,i=e.f,a=e.d,o=e.input,s=e.a,u=o.length,l=t[0],c=t[1];a<c&&!(s>=u);)i|=o[s++]<<a,a+=8;if((r=(n=l[i&(1<<c)-1])>>>16)>a)throw Error("invalid code length: "+r);return e.f=i>>r,e.d=a-r,e.a=s,65535&n}function L(e,t){var n,r;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],r=e[this.a++],15&n){case I:this.method=I;break;default:throw Error("unsupported compression method")}if(0!=((n<<8)+r)%31)throw Error("invalid fcheck flag:"+((n<<8)+r)%31);if(32&r)throw Error("fdict flag is not supported");this.q=new a(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}a.prototype.j=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,a,o,s,u=n.length-258;256!==(i=P(this,e));)if(256>i)r>=u&&(this.b=r,n=this.e(),r=this.b),n[r++]=i;else for(s=p[a=i-257],0<_[a]&&(s+=E(this,_[a])),i=P(this,t),o=g[i],0<A[i]&&(o+=E(this,A[i])),r>=u&&(this.b=r,n=this.e(),r=this.b);s--;)n[r]=n[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},a.prototype.w=function(e,t){var n=this.c,r=this.b;this.o=e;for(var i,a,o,s,u=n.length;256!==(i=P(this,e));)if(256>i)r>=u&&(u=(n=this.e()).length),n[r++]=i;else for(s=p[a=i-257],0<_[a]&&(s+=E(this,_[a])),i=P(this,t),o=g[i],0<A[i]&&(o+=E(this,A[i])),r+s>u&&(u=(n=this.e()).length);s--;)n[r]=n[r++-o];for(;8<=this.d;)this.d-=8,this.a--;this.b=r},a.prototype.e=function(){var e,t,n=new(r?Uint8Array:Array)(this.b-32768),i=this.b-32768,a=this.c;if(r)n.set(a.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=a[e+32768];if(this.g.push(n),this.l+=n.length,r)a.set(a.subarray(i,i+32768));else for(e=0;32768>e;++e)a[e]=a[i+e];return this.b=32768,a},a.prototype.z=function(e){var t,n,i,a=this.input.length/this.a+1|0,o=this.input,s=this.c;return e&&("number"==typeof e.p&&(a=e.p),"number"==typeof e.u&&(a+=e.u)),2>a?n=(i=(o.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+i:s.length<<1:n=s.length*a,r?(t=new Uint8Array(n)).set(s):t=s,this.c=t},a.prototype.n=function(){var e,t,n,i,a,o=0,s=this.c,u=this.g,l=new(r?Uint8Array:Array)(this.l+(this.b-32768));if(0===u.length)return r?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=u.length;t<n;++t)for(i=0,a=(e=u[t]).length;i<a;++i)l[o++]=e[i];for(t=32768,n=this.b;t<n;++t)l[o++]=s[t];return this.g=[],this.buffer=l},a.prototype.v=function(){var e,t=this.b;return r?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},L.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var r=e;if("string"==typeof r){var i,a,o=r.split("");for(i=0,a=o.length;i<a;i++)o[i]=(255&o[i].charCodeAt(0))>>>0;r=o}for(var s,u=1,l=0,c=r.length,f=0;0<c;){c-=s=1024<c?1024:c;do{l+=u+=r[f++]}while(--s);u%=65521,l%=65521}if(t!==(l<<16|u)>>>0)throw Error("invalid adler-32 checksum")}return e};var I=8;n("Zlib.Inflate",L),n("Zlib.Inflate.prototype.decompress",L.prototype.k);var N,C,O,k,M={ADAPTIVE:u.s,BLOCK:u.t};if(Object.keys)N=Object.keys(M);else for(C in N=[],O=0,M)N[O++]=C;for(O=0,k=N.length;O<k;++O)n("Zlib.Inflate.BufferType."+(C=N[O]),M[C])}).call(this)},function(e,t,n){e.exports=function(){"use strict";function e(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),i=Math.round(e.g),a=Math.round(e.b),o=e.a,s=Math.round(e.h),u=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+i+","+a+")":"CSS_RGBA"===n?"rgba("+r+","+i+","+a+","+o+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+i+","+a+"]":"RGBA_ARRAY"===n?"["+r+","+i+","+a+","+o+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+i+",b:"+a+",a:"+o+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+o+"}":"unknown format"}var t=Array.prototype.forEach,n=Array.prototype.slice,r={BREAK:{},extend:function(e){return this.each(n.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(n.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=n.call(arguments);return function(){for(var t=n.call(arguments),r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];return t[0]}},each:function(e,n,r){if(e)if(t&&e.forEach&&e.forEach===t)e.forEach(n,r);else if(e.length===e.length+0){var i=void 0,a=void 0;for(i=0,a=e.length;i<a;i++)if(i in e&&n.call(r,e[i],i)===this.BREAK)return}else for(var o in e)if(n.call(r,e[o],o)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var i=this,a=arguments,o=n||!r;clearTimeout(r),r=setTimeout(function(){r=null,n||e.apply(i,a)},t),o&&e.apply(i,a)}},toArray:function(e){return e.toArray?e.toArray():n.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},i=[{litmus:r.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:r.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:r.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:r.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(r.isNumber(e.r)&&r.isNumber(e.g)&&r.isNumber(e.b)&&r.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(r.isNumber(e.r)&&r.isNumber(e.g)&&r.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(r.isNumber(e.h)&&r.isNumber(e.s)&&r.isNumber(e.v)&&r.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(r.isNumber(e.h)&&r.isNumber(e.s)&&r.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],a=void 0,o=void 0,s=function(){o=!1;var e=arguments.length>1?r.toArray(arguments):arguments[0];return r.each(i,function(t){if(t.litmus(e))return r.each(t.conversions,function(t,n){if(a=t.read(e),!1===o&&!1!==a)return o=a,a.conversionName=n,a.conversion=t,r.BREAK}),r.BREAK}),o},u=void 0,l={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),u=[[n,s,a],[o,n,a],[a,n,s],[a,o,n],[s,a,n],[n,a,o]][r];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),i=Math.max(e,t,n),a=i-r,o=void 0;return 0===i?{h:NaN,s:0,v:0}:(o=e===i?(t-n)/a:t===i?2+(n-e)/a:4+(e-t)/a,(o/=6)<0&&(o+=1),{h:360*o,s:a/i,v:i/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),r=this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(u=8*t)|e&~(255<<u)}},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,r)}if("value"in i)return i.value;var o=i.get;return void 0!==o?o.call(r):void 0},p=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},_=function(){function t(){if(f(this,t),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return h(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function v(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(_.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(_.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function g(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(_.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(_.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}_.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=l.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");r.extend(e.__state,l.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},_.recalculateHSV=function(e){var t=l.rgb_to_hsv(e.r,e.g,e.b);r.extend(e.__state,{s:t.s,v:t.v}),r.isNaN(t.h)?r.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},_.COMPONENTS=["r","g","b","h","s","v","hex","a"],v(_.prototype,"r",2),v(_.prototype,"g",1),v(_.prototype,"b",0),g(_.prototype,"h"),g(_.prototype,"s"),g(_.prototype,"v"),Object.defineProperty(_.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(_.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=l.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var y=function(){function e(t,n){f(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return h(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),A={};r.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(e,t){r.each(e,function(e){A[e]=t})});var x=/(\d+(\.\d+)?)px/;function b(e){if("0"===e||r.isUndefined(e))return 0;var t=e.match(x);return r.isNull(t)?0:parseFloat(t[1])}var w={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,a=t;r.isUndefined(a)&&(a=!0),r.isUndefined(i)&&(i=!0),e.style.position="absolute",a&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var a=n||{},o=A[t];if(!o)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(o);switch(o){case"MouseEvents":var u=a.x||a.clientX||0,l=a.y||a.clientY||0;s.initMouseEvent(t,a.bubbles||!1,a.cancelable||!0,window,a.clickCount||1,0,0,u,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;r.defaults(a,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,a.bubbles||!1,a.cancelable,window,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.keyCode,a.charCode);break;default:s.initEvent(t,a.bubbles||!1,a.cancelable||!0)}r.defaults(s,i),e.dispatchEvent(s)},bind:function(e,t,n,r){var i=r||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),w},unbind:function(e,t,n,r){var i=r||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),w},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return w},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return w},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return b(t["border-left-width"])+b(t["border-right-width"])+b(t["padding-left"])+b(t["padding-right"])+b(t.width)},getHeight:function(e){var t=getComputedStyle(e);return b(t["border-top-width"])+b(t["border-bottom-width"])+b(t["padding-top"])+b(t["padding-bottom"])+b(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},F=function(e){function t(e,n){f(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),w.bind(r.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(y),S=function(e){function t(e,n,i){f(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i,s=a;if(a.__select=document.createElement("select"),r.isArray(o)){var u={};r.each(o,function(e){u[e]=e}),o=u}return r.each(o,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)}),a.updateDisplay(),w.bind(a.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e)}),a.domElement.appendChild(a.__select),a}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return w.isActive(this.__select)?this:(this.__select.value=this.getValue(),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(y),T=function(e){function t(e,n){f(this,t);var r=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r;function a(){i.setValue(i.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),w.bind(r.__input,"keyup",a),w.bind(r.__input,"change",a),w.bind(r.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),w.bind(r.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return p(t,e),h(t,[{key:"updateDisplay",value:function(){return w.isActive(this.__input)||(this.__input.value=this.getValue()),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(y);function E(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var P=function(e){function t(e,n,i){f(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i||{};return a.__min=o.min,a.__max=o.max,a.__step=o.step,r.isUndefined(a.__step)?0===a.initialValue?a.__impliedStep=1:a.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(a.initialValue))/Math.LN10))/10:a.__impliedStep=a.__step,a.__precision=E(a.__impliedStep),a}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=E(e),this}}]),t}(y),L=function(e){function t(e,n,i){f(this,t);var a=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));a.__truncationSuspended=!1;var o=a,s=void 0;function u(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())}function l(e){var t=s-e.clientY;o.setValue(o.getValue()+t*o.__impliedStep),s=e.clientY}function c(){w.unbind(window,"mousemove",l),w.unbind(window,"mouseup",c),u()}return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),w.bind(a.__input,"change",function(){var e=parseFloat(o.__input.value);r.isNaN(e)||o.setValue(e)}),w.bind(a.__input,"blur",function(){u()}),w.bind(a.__input,"mousedown",function(e){w.bind(window,"mousemove",l),w.bind(window,"mouseup",c),s=e.clientY}),w.bind(a.__input,"keydown",function(e){13===e.keyCode&&(o.__truncationSuspended=!0,this.blur(),o.__truncationSuspended=!1,u())}),a.updateDisplay(),a.domElement.appendChild(a.__input),a}return p(t,e),h(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}(this.getValue(),this.__precision),d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P);function I(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}var N=function(e){function t(e,n,r,i,a){f(this,t);var o=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:i,step:a})),s=o;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(I(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function l(){w.unbind(window,"mousemove",u),w.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(I(t,n.left,n.right,s.__min,s.__max))}function h(){w.unbind(window,"touchmove",c),w.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),w.bind(o.__background,"mousedown",function(e){document.activeElement.blur(),w.bind(window,"mousemove",u),w.bind(window,"mouseup",l),u(e)}),w.bind(o.__background,"touchstart",function(e){1===e.touches.length&&(w.bind(window,"touchmove",c),w.bind(window,"touchend",h),c(e))}),w.addClass(o.__background,"slider"),w.addClass(o.__foreground,"slider-fg"),o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(P),C=function(e){function t(e,n,r){f(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===r?"Fire":r,w.bind(i.__button,"click",function(e){return e.preventDefault(),a.fire(),!1}),w.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return p(t,e),h(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(y),O=function(e){function t(e,n){f(this,t);var i=m(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));i.__color=new _(i.getValue()),i.__temp=new _(0);var a=i;i.domElement=document.createElement("div"),w.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",w.bind(i.__input,"keydown",function(e){13===e.keyCode&&d.call(this)}),w.bind(i.__input,"blur",d),w.bind(i.__selector,"mousedown",function(){w.addClass(this,"drag").bind(window,"mouseup",function(){w.removeClass(a.__selector,"drag")})}),w.bind(i.__selector,"touchstart",function(){w.addClass(this,"drag").bind(window,"touchend",function(){w.removeClass(a.__selector,"drag")})});var o=document.createElement("div");function u(e){v(e),w.bind(window,"mousemove",v),w.bind(window,"touchmove",v),w.bind(window,"mouseup",c),w.bind(window,"touchend",c)}function l(e){g(e),w.bind(window,"mousemove",g),w.bind(window,"touchmove",g),w.bind(window,"mouseup",h),w.bind(window,"touchend",h)}function c(){w.unbind(window,"mousemove",v),w.unbind(window,"touchmove",v),w.unbind(window,"mouseup",c),w.unbind(window,"touchend",c),p()}function h(){w.unbind(window,"mousemove",g),w.unbind(window,"touchmove",g),w.unbind(window,"mouseup",h),w.unbind(window,"touchend",h),p()}function d(){var e=s(this.value);!1!==e?(a.__color.__state=e,a.setValue(a.__color.toOriginal())):this.value=a.__color.toString()}function p(){a.__onFinishChange&&a.__onFinishChange.call(a,a.__color.toOriginal())}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=a.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,i=n.clientY,o=(r-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),o>1?o=1:o<0&&(o=0),a.__color.v=s,a.__color.s=o,a.setValue(a.__color.toOriginal()),!1}function g(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=a.__hue_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientY,i=1-(r-t.top)/(t.bottom-t.top);return i>1?i=1:i<0&&(i=0),a.__color.h=360*i,a.setValue(a.__color.toOriginal()),!1}return r.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),r.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),r.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),r.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),r.extend(o.style,{width:"100%",height:"100%",background:"none"}),M(o,"top","rgba(0,0,0,0)","#000"),r.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),function(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}(i.__hue_field),r.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),w.bind(i.__saturation_field,"mousedown",u),w.bind(i.__saturation_field,"touchstart",u),w.bind(i.__field_knob,"mousedown",u),w.bind(i.__field_knob,"touchstart",u),w.bind(i.__hue_field,"mousedown",l),w.bind(i.__hue_field,"touchstart",l),i.__saturation_field.appendChild(o),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay(),i}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=s(this.getValue());if(!1!==e){var t=!1;r.each(_.COMPONENTS,function(n){if(!r.isUndefined(e[n])&&!r.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&r.extend(this.__color.__state,e)}r.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;r.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,M(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),r.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(y),k=["-moz-","-o-","-webkit-","-ms-",""];function M(e,t,n,i){e.style.background="",r.each(k,function(r){e.style.cssText+="background: "+r+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}var R=function(e,t){var n=e[t];return r.isArray(arguments[2])||r.isObject(arguments[2])?new S(e,t,arguments[2]):r.isNumber(n)?r.isNumber(arguments[2])&&r.isNumber(arguments[3])?r.isNumber(arguments[4])?new N(e,t,arguments[2],arguments[3],arguments[4]):new N(e,t,arguments[2],arguments[3]):r.isNumber(arguments[4])?new L(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new L(e,t,{min:arguments[2],max:arguments[3]}):r.isString(n)?new T(e,t):r.isFunction(n)?new C(e,t,""):r.isBoolean(n)?new F(e,t):null},U=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},X=function(){function e(){f(this,e),this.backgroundElement=document.createElement("div"),r.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),w.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),r.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;w.bind(this.backgroundElement,"click",function(){t.hide()})}return h(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),r.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",w.unbind(e.domElement,"webkitTransitionEnd",t),w.unbind(e.domElement,"transitionend",t),w.unbind(e.domElement,"oTransitionEnd",t)};w.bind(this.domElement,"webkitTransitionEnd",t),w.bind(this.domElement,"transitionend",t),w.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-w.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-w.getHeight(this.domElement)/2+"px"}}]),e}(),D="Default",B=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),j=void 0,Y=!0,Q=void 0,V=!1,z=[],G=function e(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),w.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=r.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=r.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),r.isUndefined(i.load)?i.load={preset:D}:i.preset&&(i.load.preset=i.preset),r.isUndefined(i.parent)&&i.hideable&&z.push(this),i.resizable=r.isUndefined(i.parent)&&i.resizable,i.autoPlace&&r.isUndefined(i.scrollable)&&(i.scrollable=!0);var a=B&&"true"===localStorage.getItem(Z(0,"isLocal")),o=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(e){n.parent?n.getRoot().preset=e:i.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,ne(n,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,titleRowName&&(titleRowName.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?w.addClass(n.__ul,e.CLASS_CLOSED):w.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return a},set:function(e){B&&(a=e,e?w.bind(window,"unload",o):w.unbind(window,"unload",o),localStorage.setItem(Z(0,"isLocal"),e))}}}),r.isUndefined(i.parent)){if(i.closed=!1,w.addClass(this.domElement,e.CLASS_MAIN),w.makeSelectable(this.domElement,!1),B&&a){n.useLocalStorage=!0;var s=localStorage.getItem(Z(0,"gui"));s&&(i.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,w.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(w.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(w.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),w.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);w.addClass(u,"controller-name");var l=H(n,u);w.addClass(this.__ul,e.CLASS_CLOSED),w.addClass(l,"title"),w.bind(l,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1}),i.closed||(this.closed=!1)}i.autoPlace&&(r.isUndefined(i.parent)&&(Y&&(Q=document.createElement("div"),w.addClass(Q,"dg"),w.addClass(Q,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Q),Y=!1),Q.appendChild(this.domElement),w.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ne(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},w.bind(window,"resize",this.__resizeHandler),w.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),w.bind(this.__ul,"transitionend",this.__resizeHandler),w.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&te(this),o=function(){B&&"true"===localStorage.getItem(Z(0,"isLocal"))&&localStorage.setItem(Z(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=o,i.parent||function(){var e=n.getRoot();e.width+=1,r.defer(function(){e.width-=1})}()};function H(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function W(e){w.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&w.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function q(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function K(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var i=n.__rememberedObjectIndecesToControllers[r];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[r]=i),i[t.property]=t,n.load&&n.load.remembered){var a=n.load.remembered,o=void 0;if(a[e.preset])o=a[e.preset];else{if(!a[D])return;o=a[D]}if(o[r]&&void 0!==o[r][t.property]){var s=o[r][t.property];t.initialValue=s,t.setValue(s)}}}}function J(e,t,n,i){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var a=void 0;if(i.color)a=new O(t,n);else{var o=[t,n].concat(i.factoryArgs);a=R.apply(e,o)}i.before instanceof y&&(i.before=i.before.__li),K(e,a),w.addClass(a.domElement,"c");var s=document.createElement("span");w.addClass(s,"property-name"),s.innerHTML=a.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(a.domElement);var l=H(e,u,i.before);return w.addClass(l,G.CLASS_CONTROLLER_ROW),a instanceof O?w.addClass(l,"color"):w.addClass(l,c(a.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,r.extend(n,{options:function(t){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),J(e,n.object,n.property,{before:i,factoryArgs:[r.toArray(arguments)]})}if(r.isArray(t)||r.isObject(t)){var a=n.__li.nextElementSibling;return n.remove(),J(e,n.object,n.property,{before:a,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof N){var i=new L(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});r.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],r=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return r.apply(i,e),t.apply(n,e)}}),w.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof L){var a=function(t){if(r.isNumber(n.__min)&&r.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,a=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=J(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(i),a&&o.listen(),o}return t};n.min=r.compose(a,n.min),n.max=r.compose(a,n.max)}else n instanceof F?(w.bind(t,"click",function(){w.fakeEvent(n.__checkbox,"click")}),w.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof C?(w.bind(t,"click",function(){w.fakeEvent(n.__button,"click")}),w.bind(t,"mouseover",function(){w.addClass(n.__button,"hover")}),w.bind(t,"mouseout",function(){w.removeClass(n.__button,"hover")})):n instanceof O&&(w.addClass(t,"color"),n.updateDisplay=r.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=r.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&q(e.getRoot(),!0),t},n.setValue)}(e,l,a),e.__controllers.push(a),a}function Z(e,t){return document.location.href+"."+t}function $(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ee(e,t){t.style.display=e.useLocalStorage?"block":"none"}function te(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function i(){w.removeClass(e.__closeButton,G.CLASS_DRAG),w.unbind(window,"mousemove",n),w.unbind(window,"mouseup",i)}function a(r){return r.preventDefault(),t=r.clientX,w.addClass(e.__closeButton,G.CLASS_DRAG),w.bind(window,"mousemove",n),w.bind(window,"mouseup",i),!1}e.__resize_handle=document.createElement("div"),r.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),w.bind(e.__resize_handle,"mousedown",a),w.bind(e.__closeButton,"mousedown",a),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ne(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function re(e,t){var n={};return r.each(e.__rememberedObjects,function(i,a){var o={},s=e.__rememberedObjectIndecesToControllers[a];r.each(s,function(e,n){o[n]=t?e.initialValue:e.getValue()}),n[a]=o}),n}return G.toggleHide=function(){V=!V,r.each(z,function(e){e.domElement.style.display=V?"none":""})},G.CLASS_AUTO_PLACE="a",G.CLASS_AUTO_PLACE_CONTAINER="ac",G.CLASS_MAIN="main",G.CLASS_CONTROLLER_ROW="cr",G.CLASS_TOO_TALL="taller-than-window",G.CLASS_CLOSED="closed",G.CLASS_CLOSE_BUTTON="close-button",G.CLASS_CLOSE_TOP="close-top",G.CLASS_CLOSE_BOTTOM="close-bottom",G.CLASS_DRAG="drag",G.DEFAULT_WIDTH=245,G.TEXT_CLOSED="Close Controls",G.TEXT_OPEN="Open Controls",G._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||G.toggleHide()},w.bind(window,"keydown",G._keydownHandler,!1),r.extend(G.prototype,{add:function(e,t){return J(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return J(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;r.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Q.removeChild(this.domElement);var e=this;r.each(this.__folders,function(t){e.removeFolder(t)}),w.unbind(window,"keydown",G._keydownHandler,!1),W(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new G(t);this.__folders[e]=n;var r=H(this,n.domElement);return w.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],W(e);var t=this;r.each(e.__folders,function(t){e.removeFolder(t)}),r.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=w.getOffset(e.__ul).top,n=0;r.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=w.getHeight(t))}),window.innerHeight-t-20<n?(w.addClass(e.domElement,G.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(w.removeClass(e.domElement,G.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&r.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:r.debounce(function(){this.onResize()},50),remember:function(){if(r.isUndefined(j)&&((j=new X).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;r.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");w.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),w.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",w.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",w.addClass(i,"button"),w.addClass(i,"save");var a=document.createElement("span");a.innerHTML="New",w.addClass(a,"button"),w.addClass(a,"save-as");var o=document.createElement("span");o.innerHTML="Revert",w.addClass(o,"button"),w.addClass(o,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?r.each(e.load.remembered,function(t,n){$(e,n,n===e.preset)}):$(e,D,!1),w.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(s),t.appendChild(n),t.appendChild(i),t.appendChild(a),t.appendChild(o),B){var u=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage"),c=document.getElementById("dg-save-locally");c.style.display="block","true"===localStorage.getItem(Z(0,"isLocal"))&&l.setAttribute("checked","checked"),ee(e,u),w.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,ee(e,u)})}var f=document.getElementById("dg-new-constructor");w.bind(f,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||j.hide()}),w.bind(n,"click",function(){f.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),j.show(),f.focus(),f.select()}),w.bind(i,"click",function(){e.save()}),w.bind(a,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),w.bind(o,"click",function(){e.revert()})}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&ne(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=re(this)),e.folders={},r.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=re(this),q(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[D]=re(this,!0)),this.load.remembered[e]=re(this),this.preset=e,$(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){r.each(this.__controllers,function(t){this.getRoot().load.remembered?K(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),r.each(this.__folders,function(e){e.revert(e)}),e||q(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&function e(t){0!==t.length&&U.call(window,function(){e(t)}),r.each(t,function(e){e.updateDisplay()})}(this.__listening)},updateDisplay:function(){r.each(this.__controllers,function(e){e.updateDisplay()}),r.each(this.__folders,function(e){e.updateDisplay()})}}),{color:{Color:_,math:l,interpret:s},controllers:{Controller:y,BooleanController:F,OptionController:S,StringController:T,NumberController:P,NumberControllerBox:L,NumberControllerSlider:N,FunctionController:C,ColorController:O},dom:{dom:w},gui:{GUI:G},GUI:G}}()},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(10);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(4)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,".dg ul {\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    clear: both\r\n}\r\n\r\n.dg.ac {\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    height: 0;\r\n    z-index: 0\r\n}\r\n\r\n.dg:not(.ac) .main {\r\n    overflow: hidden\r\n}\r\n\r\n.dg.main {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear\r\n}\r\n\r\n.dg.main.taller-than-window {\r\n    overflow-y: auto\r\n}\r\n\r\n.dg.main.taller-than-window .close-button {\r\n    opacity: 1;\r\n    margin-top: -1px;\r\n    border-top: 1px solid #2c2c2c\r\n}\r\n\r\n.dg.main ul.closed .close-button {\r\n    opacity: 1 !important\r\n}\r\n\r\n.dg.main:hover .close-button,\r\n.dg.main .close-button.drag {\r\n    opacity: 1\r\n}\r\n\r\n.dg.main .close-button {\r\n    -webkit-transition: opacity .1s linear;\r\n    -o-transition: opacity .1s linear;\r\n    -moz-transition: opacity .1s linear;\r\n    transition: opacity .1s linear;\r\n    border: 0;\r\n    line-height: 19px;\r\n    height: 20px;\r\n    cursor: pointer;\r\n    text-align: center;\r\n    background-color: #000\r\n}\r\n\r\n.dg.main .close-button.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.main .close-button.close-bottom {\r\n    position: absolute\r\n}\r\n\r\n.dg.main .close-button:hover {\r\n    background-color: #111\r\n}\r\n\r\n.dg.a {\r\n    float: right;\r\n    margin-top: 15px;\r\n    margin-right: 15px;\r\n    overflow-y: visible\r\n}\r\n\r\n.dg.a.has-save>ul.close-top {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a.has-save>ul.close-bottom {\r\n    margin-top: 27px\r\n}\r\n\r\n.dg.a.has-save>ul.closed {\r\n    margin-top: 0\r\n}\r\n\r\n.dg.a .save-row {\r\n    top: 0;\r\n    z-index: 1002\r\n}\r\n\r\n.dg.a .save-row.close-top {\r\n    position: relative\r\n}\r\n\r\n.dg.a .save-row.close-bottom {\r\n    position: fixed\r\n}\r\n\r\n.dg li {\r\n    -webkit-transition: height .1s ease-out;\r\n    -o-transition: height .1s ease-out;\r\n    -moz-transition: height .1s ease-out;\r\n    transition: height .1s ease-out;\r\n    -webkit-transition: overflow .1s linear;\r\n    -o-transition: overflow .1s linear;\r\n    -moz-transition: overflow .1s linear;\r\n    transition: overflow .1s linear\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    cursor: auto;\r\n    height: 27px;\r\n    line-height: 27px;\r\n    padding: 0 4px 0 5px\r\n}\r\n\r\n.dg li.folder {\r\n    padding: 0;\r\n    border-left: 4px solid transparent\r\n}\r\n\r\n.dg li.title {\r\n    cursor: pointer;\r\n    margin-left: -4px\r\n}\r\n\r\n.dg .closed li:not(.title),\r\n.dg .closed ul li,\r\n.dg .closed ul li>* {\r\n    height: 0;\r\n    overflow: hidden;\r\n    border: 0\r\n}\r\n\r\n.dg .cr {\r\n    clear: both;\r\n    padding-left: 3px;\r\n    height: 27px;\r\n    overflow: hidden\r\n}\r\n\r\n.dg .property-name {\r\n    cursor: default;\r\n    float: left;\r\n    clear: left;\r\n    width: 40%;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis\r\n}\r\n\r\n.dg .c {\r\n    float: left;\r\n    width: 60%;\r\n    position: relative\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    border: 0;\r\n    margin-top: 4px;\r\n    padding: 3px;\r\n    width: 100%;\r\n    float: right\r\n}\r\n\r\n.dg .has-slider input[type=text] {\r\n    width: 30%;\r\n    margin-left: 0\r\n}\r\n\r\n.dg .slider {\r\n    float: left;\r\n    width: 66%;\r\n    margin-left: -5px;\r\n    margin-right: 0;\r\n    height: 19px;\r\n    margin-top: 4px\r\n}\r\n\r\n.dg .slider-fg {\r\n    height: 100%\r\n}\r\n\r\n.dg .c input[type=checkbox] {\r\n    margin-top: 7px\r\n}\r\n\r\n.dg .c select {\r\n    margin-top: 5px\r\n}\r\n\r\n.dg .cr.function,\r\n.dg .cr.function .property-name,\r\n.dg .cr.function *,\r\n.dg .cr.boolean,\r\n.dg .cr.boolean * {\r\n    cursor: pointer\r\n}\r\n\r\n.dg .cr.color {\r\n    overflow: visible\r\n}\r\n\r\n.dg .selector {\r\n    display: none;\r\n    position: absolute;\r\n    margin-left: -9px;\r\n    margin-top: 23px;\r\n    z-index: 10\r\n}\r\n\r\n.dg .c:hover .selector,\r\n.dg .selector.drag {\r\n    display: block\r\n}\r\n\r\n.dg li.save-row {\r\n    padding: 0\r\n}\r\n\r\n.dg li.save-row .button {\r\n    display: inline-block;\r\n    padding: 0px 6px\r\n}\r\n\r\n.dg.dialogue {\r\n    background-color: #222;\r\n    width: 460px;\r\n    padding: 15px;\r\n    font-size: 13px;\r\n    line-height: 15px\r\n}\r\n\r\n#dg-new-constructor {\r\n    padding: 10px;\r\n    color: #222;\r\n    font-family: Monaco, monospace;\r\n    font-size: 10px;\r\n    border: 0;\r\n    resize: none;\r\n    box-shadow: inset 1px 1px 1px #888;\r\n    word-wrap: break-word;\r\n    margin: 12px 0;\r\n    display: block;\r\n    width: 440px;\r\n    overflow-y: scroll;\r\n    height: 100px;\r\n    position: relative\r\n}\r\n\r\n#dg-local-explain {\r\n    display: none;\r\n    font-size: 11px;\r\n    line-height: 17px;\r\n    border-radius: 3px;\r\n    background-color: #333;\r\n    padding: 8px;\r\n    margin-top: 10px\r\n}\r\n\r\n#dg-local-explain code {\r\n    font-size: 10px\r\n}\r\n\r\n#dat-gui-save-locally {\r\n    display: none\r\n}\r\n\r\n.dg {\r\n    color: #eee;\r\n    font: 11px 'Lucida Grande', sans-serif;\r\n    text-shadow: 0 -1px 0 #111\r\n}\r\n\r\n.dg.main::-webkit-scrollbar {\r\n    width: 5px;\r\n    background: #1a1a1a\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-corner {\r\n    height: 0;\r\n    display: none\r\n}\r\n\r\n.dg.main::-webkit-scrollbar-thumb {\r\n    border-radius: 5px;\r\n    background: #676767\r\n}\r\n\r\n.dg li:not(.folder) {\r\n    background: #1a1a1a;\r\n    border-bottom: 1px solid #2c2c2c\r\n}\r\n\r\n.dg li.save-row {\r\n    line-height: 25px;\r\n    background: #dad5cb;\r\n    border: 0\r\n}\r\n\r\n.dg li.save-row select {\r\n    margin-left: 5px;\r\n    width: 108px\r\n}\r\n\r\n.dg li.save-row .button {\r\n    margin-left: 5px;\r\n    margin-top: 1px;\r\n    border-radius: 2px;\r\n    font-size: 9px;\r\n    line-height: 7px;\r\n    padding: 4px 4px 5px 4px;\r\n    background: #c5bdad;\r\n    color: #fff;\r\n    text-shadow: 0 1px 0 #b0a58f;\r\n    box-shadow: 0 -1px 0 #b0a58f;\r\n    cursor: pointer\r\n}\r\n\r\n.dg li.save-row .button.gears {\r\n    background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\r\n    height: 7px;\r\n    width: 8px\r\n}\r\n\r\n.dg li.save-row .button:hover {\r\n    background-color: #bab19e;\r\n    box-shadow: 0 -1px 0 #b0a58f\r\n}\r\n\r\n.dg li.folder {\r\n    border-bottom: 0\r\n}\r\n\r\n.dg li.title {\r\n    padding-left: 16px;\r\n    background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\r\n    cursor: pointer;\r\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2)\r\n}\r\n\r\n.dg .closed li.title {\r\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)\r\n}\r\n\r\n.dg .cr.boolean {\r\n    border-left: 3px solid #806787\r\n}\r\n\r\n.dg .cr.color {\r\n    border-left: 3px solid\r\n}\r\n\r\n.dg .cr.function {\r\n    border-left: 3px solid #e61d5f\r\n}\r\n\r\n.dg .cr.number {\r\n    border-left: 3px solid #2FA1D6\r\n}\r\n\r\n.dg .cr.number input[type=text] {\r\n    color: #2FA1D6\r\n}\r\n\r\n.dg .cr.string {\r\n    border-left: 3px solid #1ed36f\r\n}\r\n\r\n.dg .cr.string input[type=text] {\r\n    color: #1ed36f\r\n}\r\n\r\n.dg .cr.function:hover,\r\n.dg .cr.boolean:hover {\r\n    background: #111\r\n}\r\n\r\n.dg .c input[type=text] {\r\n    background: #303030;\r\n    outline: none\r\n}\r\n\r\n.dg .c input[type=text]:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c input[type=text]:focus {\r\n    background: #494949;\r\n    color: #fff\r\n}\r\n\r\n.dg .c .slider {\r\n    background: #303030;\r\n    cursor: ew-resize\r\n}\r\n\r\n.dg .c .slider-fg {\r\n    background: #2FA1D6;\r\n    max-width: 100%\r\n}\r\n\r\n.dg .c .slider:hover {\r\n    background: #3c3c3c\r\n}\r\n\r\n.dg .c .slider:hover .slider-fg {\r\n    background: #44abda\r\n}",""])},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var i,a=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(a)?e:(i=0===a.indexOf("//")?a:0===a.indexOf("/")?n+a:r+a.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")})}},function(e,t,n){var r=n(13);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(4)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,"body {\r\n    margin: 0;\r\n    overflow: hidden;\r\n}\r\n\r\ncanvas {\r\n    width: 100%;\r\n    height: 100%;\r\n}\r\n\r\n.statsBox {\r\n    position: fixed;\r\n    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);\r\n    top: 0;\r\n    left: 0;\r\n    margin: 10px;\r\n    cursor: pointer;\r\n    opacity: 0.9;\r\n    z-index: 10000\r\n}",""])},function(e,t,n){"use strict";n.r(t);var r=n(0);class i{constructor(e){this.camera=e,this.target=new r.Vector3,this.radius=3,this.theta=0,this.phi=0,this.onMouseDownPosition=new r.Vector2,this.onMouseDownTheta=this.theta,this.onMouseDownPhi=this.phi,this.boundOnMouseDown=(e=>this.onMouseDown(e)),this.boundOnMouseMove=(e=>this.onMouseMove(e)),this.boundOnMouseUp=(e=>this.onMouseUp(e)),document.addEventListener("mousedown",this.boundOnMouseDown,!1)}onMouseDown(e){this.onMouseDownPosition=new r.Vector2(e.clientX,e.clientY),this.onMouseDownTheta=this.theta,this.onMouseDownPhi=this.phi,document.addEventListener("mousemove",this.boundOnMouseMove,!1),document.addEventListener("mouseup",this.boundOnMouseUp,!1)}onMouseMove(e){this.theta=-.5*(e.clientX-this.onMouseDownPosition.x)+this.onMouseDownTheta,this.phi=.5*(e.clientY-this.onMouseDownPosition.y)+this.onMouseDownPhi,this.phi=Math.min(179,Math.max(-179,this.phi))}onMouseUp(e){document.removeEventListener("mousemove",this.boundOnMouseMove,!1),document.removeEventListener("mouseup",this.boundOnMouseUp,!1)}setRadius(e){this.radius=Math.max(.001,e)}update(){this.camera.position.x=this.target.x+this.radius*Math.sin(this.theta*Math.PI/360)*Math.cos(this.phi*Math.PI/360),this.camera.position.y=this.target.y+this.radius*Math.sin(this.phi*Math.PI/360),this.camera.position.z=this.target.z+this.radius*Math.cos(this.theta*Math.PI/360)*Math.cos(this.phi*Math.PI/360),this.camera.updateMatrix(),this.camera.lookAt(this.target)}}var a=n(1),o=n(2),s=n.n(o);class u{static createCapsuleGeometry(e=1,t=2,n=32){const i=new r.Geometry,a=2*Math.PI,o=1.5707963267948966,s=[];for(let u=0;u<=n/4;u++)for(let l=0;l<=n;l++){let c=l*a/n,f=-o+Math.PI*u/(n/2),h=new r.Vector3,d=new r.Vector3;h.x=e*Math.cos(f)*Math.cos(c),h.y=e*Math.cos(f)*Math.sin(c),h.z=e*Math.sin(f),h.z-=t/2,d.x=h.x,d.y=h.y,d.z=h.z,i.vertices.push(h),s.push(d)}for(let u=n/4;u<=n/2;u++)for(let l=0;l<=n;l++){let c=l*a/n,f=-o+Math.PI*u/(n/2),h=new r.Vector3,d=new r.Vector3;h.x=e*Math.cos(f)*Math.cos(c),h.y=e*Math.cos(f)*Math.sin(c),h.z=e*Math.sin(f),h.z+=t/2,d.x=h.x,d.y=h.y,d.z=h.z,i.vertices.push(h),s.push(d)}for(let e=0;e<=n/2;e++)for(let t=0;t<n;t++){let a=new r.Vector4(e*(n+1)+t,e*(n+1)+(t+1),(e+1)*(n+1)+(t+1),(e+1)*(n+1)+t);if(e==n/4){let e=new r.Face3(a.x,a.y,a.z,[s[a.x],s[a.y],s[a.z]]),t=new r.Face3(a.x,a.z,a.w,[s[a.x],s[a.z],s[a.w]]);i.faces.push(t),i.faces.push(e)}else{let e=new r.Face3(a.x,a.y,a.z,[s[a.x],s[a.y],s[a.z]]),t=new r.Face3(a.x,a.z,a.w,[s[a.x],s[a.z],s[a.w]]);i.faces.push(e),i.faces.push(t)}}return i.rotateX(Math.PI/2),i.computeVertexNormals(),i.computeFaceNormals(),i}static appplyVectorMatrixXZ(e,t){return new r.Vector3((e.x*t.z+e.z*t.x)/2,0,(e.z*t.z+-e.x*t.x)/2)}static getAngleBetweenVectors(e,t,n=new r.Vector3(0,1,0),i=5e-4){let a,o=e.dot(t);if(o>1-i)a=0;else{a=o<-1+i?Math.PI/2:Math.acos(o);let s=(new r.Vector3).crossVectors(e,t);n.dot(s)<0&&(a=-a)}return a}static createArray(e){let t=new Array(e||0),n=e;if(arguments.length>1){let r=Array.prototype.slice.call(arguments,1);for(;n--;)t[e-1-n]=this.createArray.apply(this,r)}return t}static setDefaults(e,t){return s.a.defaults({},s.a.clone(e),t)}static getGlobalProperties(e=""){let t=[],n=window;for(let r in n)0==r.indexOf(e)&&t.push(r);return t}}class l{constructor(e){this.frameTime=1/e,this.offset=0,this.cache=[]}setFPS(e){this.frameTime=1/e}lastFrame(){return this.cache[this.cache.length-1]}generateFrames(e){let t=this.offset+e,n=Math.floor(t/this.frameTime);if(this.offset=t%this.frameTime,n>0){for(let e=0;e<n;e++)this.cache.push(this.getFrame(e+1==n));this.cache=this.cache.slice(-2)}}}function c(e,t,n,r,i){let a=t-e;return n+=a/=r,{position:e+=n*=i,velocity:n}}let f={SpringSimulator:class extends l{constructor(e,t,n,r=0,i=0){super(e),this.position=0,this.velocity=0,this.target=0,this.mass=t,this.damping=n;for(let e=0;e<2;e++)this.cache.push({position:r,velocity:i})}simulate(e){void 0==e&&console.log("Pass the timeStep!"),this.generateFrames(e),this.position=r.Math.lerp(this.cache[0].position,this.cache[1].position,this.offset/this.frameTime),this.velocity=r.Math.lerp(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){return c(this.lastFrame().position,this.target,this.lastFrame().velocity,this.mass,this.damping)}},VectorSpringSimulator:class extends l{constructor(e,t,n,i=new r.Vector3,a=new r.Vector3){super(e),this.position=new r.Vector3,this.velocity=new r.Vector3,this.target=new r.Vector3,this.mass=t,this.damping=n;for(let e=0;e<2;e++)this.cache.push({position:i,velocity:a})}simulate(e){void 0==e&&console.log("Pass the timeStep!"),this.generateFrames(e),this.position.lerpVectors(this.cache[0].position,this.cache[1].position,this.offset/this.frameTime),this.velocity.lerpVectors(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){let t={position:this.lastFrame().position.clone(),velocity:this.lastFrame().velocity.clone()};return function(e,t,n,i,a){let o=(new r.Vector3).subVectors(t,e);o.divideScalar(i),n.add(o),n.multiplyScalar(a),e.add(n)}(t.position,this.target,t.velocity,this.mass,this.damping),t}},RelativeSpringSimulator:class extends l{constructor(e,t,n,r=0,i=0){super(e),this.position=0,this.velocity=0,this.target=0,this.mass=t,this.damping=n,this.lastLerp=0;for(let e=0;e<2;e++)this.cache.push({position:r,velocity:i})}simulate(e){void 0==e&&console.log("Pass the timeStep!"),this.generateFrames(e);let t=r.Math.lerp(0,this.cache[1].position,this.offset/this.frameTime);this.position=t-this.lastLerp,this.lastLerp=t,this.velocity=r.Math.lerp(this.cache[0].velocity,this.cache[1].velocity,this.offset/this.frameTime)}getFrame(e){let t=Object.assign({},this.lastFrame());return e&&(t.position=0,this.lastLerp=this.lastLerp-this.lastFrame().position),c(t.position,this.target,t.velocity,this.mass,this.damping)}}};let h={EventControl:class{constructor(){this.value=!1,this.justPressed=!1,this.justReleased=!1}},LerpControl:class{constructor(){this.value=!1,this.floatValue=0}}};let d={Default:class{constructor(e){this.character=e}update(e){this.character.charState.update(e)}},FollowCharacter:class{constructor(e,t=1.3){this.targetCharacter=e,this.stopDistance=t}update(e){let t=(new r.Vector3).subVectors(this.targetCharacter.position,this.character.position);this.character.setViewVector(t),t.length()>this.stopDistance?this.character.controls.up.value||this.character.setControl("up",!0):(this.character.controls.up.value&&this.character.setControl("up",!1),this.character.setOrientationTarget(t)),this.character.charState.update(e)}},Random:class{constructor(e=100){this.randomFrequency=e}update(e){let t=Math.floor(Math.random()*this.randomFrequency),n=Math.random()>.5;0==t?(this.character.setViewVector(new r.Vector3(Math.random()-.5,Math.random()-.5,Math.random()-.5)),this.character.setControl("up",!0),this.character.charState.update(e),this.character.setControl("up",!1)):1==t?this.character.setControl("up",n):2==t?this.character.setControl("run",n):3==t&&this.character.setControl("jump",n),this.character.charState.update(e)}}};class p{constructor(e){this.character=e,this.character.velocitySimulator.damping=this.character.defaultVelocitySimulatorDamping,this.character.velocitySimulator.mass=this.character.defaultVelocitySimulatorMass,this.character.rotationSimulator.damping=this.character.defaultRotationSimulatorDamping,this.character.rotationSimulator.mass=this.character.defaultRotationSimulatorMass,this.character.setSimulatedVelocityInfluence(0,1,0),this.timer=0}update(e){this.timer+=e}changeState(){}noDirection(){return!(this.character.controls.up.value||this.character.controls.down.value||this.character.controls.left.value||this.character.controls.right.value)}anyDirection(){return this.character.controls.up.value||this.character.controls.down.value||this.character.controls.left.value||this.character.controls.right.value}justPressed(e){return this.character.controls.lastControl==e&&e.justPressed}isPressed(e){return e.value}justReleased(e){return this.character.controls.lastControl==e&&e.justReleased}fallInAir(){this.character.rayHasHit||this.character.setState(L)}animationEnded(e){return void 0==this.character.mixer||(void 0==this.animationLength?(console.error(this.constructor.name+"Error: Set this.animationLength in state constructor!"),!1):this.timer>this.animationLength-e)}setAppropriateDropState(){this.character.lastGroundImpactData.velocity.y<-6?this.character.setState(C):this.anyDirection()?this.character.setState(N):this.character.setState(I)}setAppropriateStartWalkState(){let e=Math.PI,t=u.getAngleBetweenVectors(this.character.orientation,this.character.getCameraRelativeMovementVector());t>.4*e?this.character.setState(b):t>.7*e?this.character.setState(F):t<.4*-e?this.character.setState(w):t<.7*-e?this.character.setState(S):this.character.setState(x)}}class m extends p{constructor(e){super(e),this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.character.setAnimation("idle",.3)}update(e){super.update(e),this.character.update(e),this.fallInAir()}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(E),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(g):this.setAppropriateStartWalkState())}}class _ extends p{constructor(e){super(e),this.character.rotationSimulator.mass=30,this.character.rotationSimulator.damping=.6,this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.animationLength=this.character.setAnimation("rotate_right",.1)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(m),this.character.update(e),this.fallInAir()}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(E),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(g):this.setAppropriateStartWalkState())}}class v extends p{constructor(e){super(e),this.character.rotationSimulator.mass=30,this.character.rotationSimulator.damping=.6,this.character.velocitySimulator.damping=.6,this.character.velocitySimulator.mass=10,this.character.setArcadeVelocityTarget(0),this.animationLength=this.character.setAnimation("rotate_left",.1)}update(e){super.update(e),this.character.update(e),this.animationEnded(e)&&this.character.setState(m),this.fallInAir()}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(E),this.anyDirection()&&(this.character.velocity.length()>.5?this.character.setState(g):this.setAppropriateStartWalkState())}}class g extends p{constructor(e){super(e),this.character.setArcadeVelocityTarget(.8),this.character.setAnimation("run",.1),this.noDirection()&&this.character.setState(T)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.update(e),this.fallInAir(),this.isPressed(this.character.controls.run)&&this.character.setState(y)}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(P),this.noDirection()&&(this.character.velocity.length()>1?this.character.setState(T):this.character.setState(m))}}class y extends p{constructor(e){super(e),this.character.velocitySimulator.mass=10,this.character.rotationSimulator.damping=.8,this.character.rotationSimulator.mass=50,this.character.setArcadeVelocityTarget(1.4),this.character.setAnimation("sprint",.3)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.update(e),this.fallInAir()}changeState(){this.justReleased(this.character.controls.run)&&this.character.setState(g),this.justPressed(this.character.controls.jump)&&this.character.setState(P),this.noDirection()&&this.character.setState(T)}}class A extends p{constructor(e){super(e),this.character.rotationSimulator.mass=20,this.character.rotationSimulator.damping=.7,this.character.setArcadeVelocityTarget(.8)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(g),this.character.setGlobalDirectionGoal(),this.character.update(e),this.fallInAir()}changeState(){if(this.justPressed(this.character.controls.jump)&&this.character.setState(P),this.noDirection())if(this.timer<.1){let e=u.getAngleBetweenVectors(this.character.orientation,this.character.orientationTarget);e>.4*Math.PI?this.character.setState(v):e<.4*-Math.PI?this.character.setState(_):this.character.setState(m)}else this.character.setState(m);this.justPressed(this.character.controls.run)&&this.character.setState(y)}}class x extends A{constructor(e){super(e),this.animationLength=e.setAnimation("start_forward",.1)}}class b extends A{constructor(e){super(e),this.animationLength=e.setAnimation("start_left",.1)}}class w extends A{constructor(e){super(e),this.animationLength=e.setAnimation("start_right",.1)}}class F extends A{constructor(e){super(e),this.animationLength=e.setAnimation("start_back_left",.1)}}class S extends A{constructor(e){super(e),this.animationLength=e.setAnimation("start_back_left",.1)}}class T extends p{constructor(e){super(e),this.character.setArcadeVelocityTarget(0),this.animationLength=e.setAnimation("stop",.1)}update(e){super.update(e),this.animationEnded(e)&&this.character.setState(m),this.character.update(e),this.fallInAir()}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(E),this.anyDirection()&&(this.isPressed(this.character.controls.run)?this.character.setState(y):this.character.velocity.length()>.5?this.character.setState(g):this.setAppropriateStartWalkState())}}class E extends p{constructor(e){super(e),this.character.velocitySimulator.mass=50,this.character.setArcadeVelocityTarget(0),this.animationLength=this.character.setAnimation("jump_idle",.1),this.alreadyJumped=!1}update(e){super.update(e),this.alreadyJumped&&(this.character.setGlobalDirectionGoal(),this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0)),this.character.update(e),this.timer>.2&&!this.alreadyJumped?(this.character.jump(),this.alreadyJumped=!0,this.character.velocitySimulator.mass=100,this.character.rotationSimulator.damping=.3,this.character.setSimulatedVelocityInfluence(.7,1,.7)):this.timer>.3&&this.character.rayHasHit?this.setAppropriateDropState():this.timer>this.animationLength-e&&this.character.setState(L)}}class P extends p{constructor(e){super(e),this.character.velocitySimulator.mass=100,this.animationLength=this.character.setAnimation("jump_running",.1),this.alreadyJumped=!1}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.alreadyJumped&&this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0),this.character.update(e),this.timer>.14&&!this.alreadyJumped?(this.character.jump(4),this.alreadyJumped=!0,this.character.rotationSimulator.damping=.3,this.character.setSimulatedVelocityInfluence(.98,1,.98)):this.timer>.24&&this.character.rayHasHit?this.setAppropriateDropState():this.timer>this.animationLength-e&&this.character.setState(L)}}class L extends p{constructor(e){super(e),this.character.velocitySimulator.mass=100,this.character.rotationSimulator.damping=.3,this.character.setSimulatedVelocityInfluence(.98,1,.98),this.character.setAnimation("falling",.3)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.setArcadeVelocityTarget(this.anyDirection()?.8:0),this.character.update(e),this.character.rayHasHit&&this.setAppropriateDropState()}}class I extends p{constructor(e){super(e),this.character.velocitySimulator.damping=.5,this.character.velocitySimulator.mass=7,this.character.setArcadeVelocityTarget(0),this.animationLength=this.character.setAnimation("drop_idle",.1),this.anyDirection()&&this.character.setState(x)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.update(e),this.animationEnded(e)&&this.character.setState(m),this.fallInAir()}changeState(){this.justPressed(this.character.controls.jump)&&this.character.setState(E),this.anyDirection()&&this.character.setState(x)}}class N extends p{constructor(e){super(e),this.character.setArcadeVelocityTarget(.8),this.animationLength=this.character.setAnimation("drop_running",.1)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.update(e),this.animationEnded(e)&&this.character.setState(g),this.fallInAir()}changeState(){this.noDirection(this.character.controls.jump)&&this.character.setState(T),this.anyDirection()&&this.justPressed(this.character.controls.run)&&this.character.setState(y),this.justPressed(this.character.controls.jump)&&this.character.setState(P)}}class C extends p{constructor(e){super(e),this.character.velocitySimulator.mass=1,this.character.velocitySimulator.damping=.6,this.character.setArcadeVelocityTarget(.8),this.animationLength=this.character.setAnimation("drop_running_roll",.03)}update(e){super.update(e),this.character.setGlobalDirectionGoal(),this.character.update(e),this.animationEnded(e)&&(this.anyDirection()?this.character.setState(g):this.character.setState(T))}}let O={DefaultState:p,Idle:m,Walk:g,Sprint:y,StartWalkForward:x,StartWalkLeft:b,StartWalkBackLeft:F,StartWalkRight:w,StartWalkBackRight:S,EndWalk:T,JumpIdle:E,JumpRunning:P,Falling:L,DropIdle:I,DropRunning:N};class k{constructor(e){this.sketchbook=e,this.camera=e.camera,this.previousGameMode=e.gameMode,this.movementSpeed=.06,this.init(),this.keymap={w:{action:"forward"},s:{action:"back"},a:{action:"left"},d:{action:"right"},e:{action:"up"},q:{action:"down"},shift:{action:"fast"}},this.controls={forward:new h.LerpControl,left:new h.LerpControl,right:new h.LerpControl,up:new h.LerpControl,back:new h.LerpControl,down:new h.LerpControl,fast:new h.LerpControl}}init(){this.sketchbook.cameraController.target.copy(this.sketchbook.camera.position),this.sketchbook.cameraController.setRadius(0),this.sketchbook.dirLight.target=this.camera}handleKey(e,t,n){if(t=t.toLowerCase(),void 0!=this.previousGameMode&&"c"==t&&1==n&&1==e.shiftKey)this.sketchbook.gameMode=this.previousGameMode,this.sketchbook.gameMode.init();else if(t in this.keymap){this.controls[this.keymap[t].action].value=n}}update(){this.sketchbook.dirLight.position.set(this.camera.position.x+5*this.sketchbook.sun.x,this.camera.position.y+5*this.sketchbook.sun.y,this.camera.position.z+5*this.sketchbook.sun.z);for(let e in this.controls){let t=this.controls[e];t.floatValue=r.Math.lerp(t.floatValue,+t.value,.3)}let e=new r.Vector3(0,0,-1).applyQuaternion(this.camera.quaternion),t=new r.Vector3(0,0,1).applyQuaternion(this.camera.quaternion),n=new r.Vector3(-1,0,0).applyQuaternion(this.camera.quaternion),i=new r.Vector3(1,0,0).applyQuaternion(this.camera.quaternion),a=new r.Vector3(0,1,0).applyQuaternion(this.camera.quaternion),o=new r.Vector3(0,-1,0).applyQuaternion(this.camera.quaternion),s=this.movementSpeed*(this.controls.fast.value?5:1);this.sketchbook.cameraController.target.add(e.multiplyScalar(s*this.controls.forward.floatValue)),this.sketchbook.cameraController.target.add(t.multiplyScalar(s*this.controls.back.floatValue)),this.sketchbook.cameraController.target.add(n.multiplyScalar(s*this.controls.left.floatValue)),this.sketchbook.cameraController.target.add(i.multiplyScalar(s*this.controls.right.floatValue)),this.sketchbook.cameraController.target.add(a.multiplyScalar(s*this.controls.up.floatValue)),this.sketchbook.cameraController.target.add(o.multiplyScalar(s*this.controls.down.floatValue))}}let M={FreeCameraControls:k,CharacterControls:class{constructor(e,t){this.sketchbook=e,this.character=t,this.init(),this.keymap={w:{action:"up"},s:{action:"down"},a:{action:"left"},d:{action:"right"},shift:{action:"run"}," ":{action:"jump"},e:{action:"use"},mouse0:{action:"primary"},mouse2:{action:"secondary"},mouse1:{action:"tertiary"}}}init(){this.sketchbook.cameraController.setRadius(1.8),this.sketchbook.dirLight.target=this.character}handleKey(e,t,n){"c"==(t=t.toLowerCase())&&1==n&&1==e.shiftKey&&(this.character.resetControls(),this.sketchbook.gameMode=new k(this.sketchbook,this)),t in this.keymap&&this.character.setControl(this.keymap[t].action,n)}update(){this.character.viewVector=(new r.Vector3).subVectors(this.character.position,this.sketchbook.camera.position),this.sketchbook.dirLight.position.set(this.character.position.x+5*this.sketchbook.sun.x,this.character.position.y+5*this.sketchbook.sun.y,this.character.position.z+5*this.sketchbook.sun.z),this.sketchbook.cameraController.target.copy(new r.Vector3(this.character.position.x,this.character.position.y+this.character.height/1.7,this.character.position.z))}}};class R extends r.Object3D{constructor(e){super(),this.world=e,this.height=1,this.modelOffset=new r.Vector3,this.visuals=new r.Group,this.add(this.visuals),this.modelContainer=new r.Group,this.modelContainer.position.y=-this.height/2,this.visuals.add(this.modelContainer);let t=u.createCapsuleGeometry(this.height/4,this.height/2,8),n=new r.Mesh(t,new r.MeshLambertMaterial({color:16777215}));n.position.set(0,this.height/2,0),n.castShadow=!0,this.characterModel=n,this.modelContainer.add(n),this.mixer,this.acceleration=new r.Vector3,this.velocity=new r.Vector3,this.simulatedVelocityInfluence=new r.Vector3,this.velocityTarget=new r.Vector3,this.defaultVelocitySimulatorDamping=.8,this.defaultVelocitySimulatorMass=50,this.velocitySimulator=new f.VectorSpringSimulator(60,this.defaultVelocitySimulatorMass,this.defaultVelocitySimulatorDamping),this.moveSpeed=8,this.angularVelocity=0,this.orientation=new r.Vector3(0,0,1),this.orientationTarget=new r.Vector3(0,0,1),this.defaultRotationSimulatorDamping=.5,this.defaultRotationSimulatorMass=10,this.rotationSimulator=new f.RelativeSpringSimulator(60,this.defaultRotationSimulatorMass,this.defaultRotationSimulatorDamping),this.setState(O.Idle),this.viewVector=new r.Vector3,this.behaviour=new d.Default(this),this.controls={up:new h.EventControl,down:new h.EventControl,left:new h.EventControl,right:new h.EventControl,run:new h.EventControl,jump:new h.EventControl,use:new h.EventControl,primary:new h.EventControl,secondary:new h.EventControl,tertiary:new h.EventControl,lastControl:new h.EventControl},this.characterCapsule=e.createCapsulePrimitive({mass:1,position:new a.Vec3(0,0,0),height:.5,radius:.25,segments:8,friction:0,visible:!1}),this.characterCapsule.visual.visible=!1,this.characterCapsule.physical.character=this,this.characterCapsule.physical.collisionFilterGroup=2,this.characterCapsule.physical.fixedRotation=!0,this.characterCapsule.physical.updateMassProperties(),this.rayResult=new a.RaycastResult,this.rayHasHit=!1,this.rayCastLength=.63,this.raySafeOffset=.03,this.wantsToJump=!1,this.justJumped=!1,this.initJumpSpeed=-1,this.lastGroundImpactData={velocity:new a.Vec3};const i=new r.BoxGeometry(.1,.1,.1),o=new r.MeshLambertMaterial({color:16711680});this.raycastBox=new r.Mesh(i,o),this.raycastBox.visible=!1,this.characterCapsule.physical.preStep=function(){const e=new a.Vec3(this.position.x,this.position.y,this.position.z),t=new a.Vec3(this.position.x,this.position.y-this.character.rayCastLength,this.position.z);this.character.rayHasHit=this.character.world.physicsWorld.raycastClosest(e,t,{collisionFilterMask:-3,skipBackfaces:!0},this.character.rayResult),this.character.wantsToJump&&this.character.rayHasHit&&(this.character.initJumpSpeed>-1&&(this.velocity.y=0,this.velocity.lengthSquared()<this.character.initJumpSpeed**2&&(this.velocity.normalize(),this.velocity.mult(this.character.initJumpSpeed,this.velocity))),this.velocity.y+=4,this.position.y+=this.character.raySafeOffset,this.character.justJumped=!0),this.character.wantsToJump=!1},this.characterCapsule.physical.postStep=function(){let e=(new r.Vector3).copy(this.velocity),t=(new r.Vector3).copy(this.character.velocity).multiplyScalar(this.character.moveSpeed);t=u.appplyVectorMatrixXZ(this.character.orientation,t);let n=new r.Vector3(r.Math.lerp(t.x,e.x,this.character.simulatedVelocityInfluence.x),r.Math.lerp(t.y,e.y,this.character.simulatedVelocityInfluence.y),r.Math.lerp(t.z,e.z,this.character.simulatedVelocityInfluence.z));this.character.justJumped?this.character.justJumped=!1:this.character.rayHasHit?(this.character.raycastBox.visible&&this.character.raycastBox.position.copy(this.character.rayResult.hitPointWorld),this.position.y=this.character.rayResult.hitPointWorld.y+this.character.rayCastLength-this.character.raySafeOffset,this.velocity.set(n.x,0,n.z)):(this.character.raycastBox.visible&&this.character.raycastBox.position.set(this.position.x,this.position.y-this.character.rayCastLength,this.position.z),this.velocity.copy(n),this.character.lastGroundImpactData.velocity.copy(this.velocity))}}setModel(e){this.modelContainer.remove(this.characterModel),this.characterModel=e,this.modelContainer.add(this.characterModel),this.mixer=new r.AnimationMixer(this.characterModel),this.setState(O.Idle)}setSimulatedVelocityInfluence(e,t=e,n=e){this.simulatedVelocityInfluence.set(e,t,n)}setModelOffset(e){this.modelOffset.copy(e)}setViewVector(e){this.viewVector.copy(e).normalize()}setState(e){this.charState=new e(this)}setPosition(e,t,n){this.characterCapsule.physical.position=new a.Vec3(e,t,n)}setArcadeVelocity(e,t=0){this.velocity.z=e,this.velocity.x=t}setArcadeVelocityTarget(e,t=0){this.velocityTarget.z=e,this.velocityTarget.x=t}setOrientationTarget(e){this.orientationTarget.copy(e).setY(0).normalize()}setBehaviour(e){e.character=this,this.behaviour=e}setControl(e,t){let n=this.controls[e];n.value=t,t?n.justPressed=!0:n.justReleased=!0,this.controls.lastControl=n,this.charState.changeState(),n.justPressed=!1,n.justReleased=!1}Control(){this.world.gameMode=new M.CharacterControls(this.world,this)}resetControls(){this.setControl("up",!1),this.setControl("down",!1),this.setControl("left",!1),this.setControl("right",!1),this.setControl("run",!1),this.setControl("jump",!1),this.setControl("use",!1),this.setControl("primary",!1),this.setControl("secondary",!1),this.setControl("tertiary",!1)}update(e,t){t=u.setDefaults(t,{SpringRotation:!0,RotationMultiplier:1,SpringVelocity:!0,rotateModel:!0,updateAnimation:!0}),this.visuals.position.copy(this.modelOffset),t.SpringVelocity&&this.SpringMovement(e),t.SpringRotation&&this.SpringRotation(e,t.RotationMultiplier),t.rotateModel&&this.rotateModel(),t.updateAnimation&&void 0!=this.mixer&&this.mixer.update(e),this.position.set(this.characterCapsule.physical.interpolatedPosition.x,this.characterCapsule.physical.interpolatedPosition.y-this.height/2,this.characterCapsule.physical.interpolatedPosition.z)}setAnimation(e,t){if(void 0!=this.mixer){let n=this.characterModel.animations,i=r.AnimationClip.findByName(n,e),a=this.mixer.clipAction(i);return this.mixer.stopAllAction(),a.fadeIn(t),a.play(),a._clip.duration}}SpringMovement(e){this.velocitySimulator.target.copy(this.velocityTarget),this.velocitySimulator.simulate(e),this.velocity.copy(this.velocitySimulator.position),this.acceleration.copy(this.velocitySimulator.velocity)}SpringRotation(e,t){let n=u.getAngleBetweenVectors(this.orientation,this.orientationTarget);this.rotationSimulator.target=n*t,this.rotationSimulator.simulate(e);let i=this.rotationSimulator.position;this.orientation.applyAxisAngle(new r.Vector3(0,1,0),i),this.angularVelocity=this.rotationSimulator.velocity}getLocalMovementDirection(){const e=this.controls.right.value?-1:0,t=this.controls.left.value?1:0,n=this.controls.up.value?1:0,i=this.controls.down.value?-1:0;return new r.Vector3(e+t,0,n+i)}getCameraRelativeMovementVector(){const e=this.getLocalMovementDirection(),t=new r.Vector3(this.viewVector.x,0,this.viewVector.z);return u.appplyVectorMatrixXZ(t,e)}setGlobalDirectionGoal(){let e=this.getCameraRelativeMovementVector();0==e.x&&0==e.y&&0==e.z?this.setOrientationTarget(this.orientation):this.setOrientationTarget(e)}rotateModel(){this.visuals.lookAt(this.orientation.x,this.visuals.position.y,this.orientation.z),this.visuals.rotateZ(2.3*-this.angularVelocity*this.velocity.length()),this.visuals.position.setY(this.visuals.position.y+Math.cos(Math.abs(2.3*this.angularVelocity))/2)}jump(e=-1){this.wantsToJump=!0,this.initJumpSpeed=e}}var U=n(5),X=function(e){this.manager=void 0!==e?e:r.DefaultLoadingManager};function D(e){var t,n=e.Content,i=e.RelativeFilename||e.Filename,a=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!=typeof r.TGALoader)return void console.warn("FBXLoader: THREE.TGALoader is required to load TGA textures");null===r.Loader.Handlers.get(".tga")&&r.Loader.Handlers.add(/\.tga$/i,new r.TGALoader),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var o=new Uint8Array(n);return window.URL.createObjectURL(new Blob([o],{type:t}))}function B(e,t,n,i){var a=function(e,t,n,i){var a,o,s=t.path,u=i.get(e.id).children;void 0!==u&&u.length>0&&void 0!==n[u[0].ID]&&(0!==(a=n[u[0].ID]).indexOf("blob:")&&0!==a.indexOf("data:")||t.setPath(void 0));o="tga"===e.FileName.slice(-3).toLowerCase()?r.Loader.Handlers.get(".tga").load(a):t.load(a);return t.setPath(s),o}(e,t,n,i);a.ID=e.id,a.name=e.attrName;var o=e.WrapModeU,s=e.WrapModeV,u=void 0!==o?o.value:0,l=void 0!==s?s.value:0;if(a.wrapS=0===u?r.RepeatWrapping:r.ClampToEdgeWrapping,a.wrapT=0===l?r.RepeatWrapping:r.ClampToEdgeWrapping,"Scaling"in e){var c=e.Scaling.value;a.repeat.x=c[0],a.repeat.y=c[1]}return a}function j(e,t,n,i){var a=t.id,o=t.attrName,s=t.ShadingModel;if("object"==typeof s&&(s=s.value),!i.has(a))return null;var u,l=function(e,t,n,i,a){var o={};t.BumpFactor&&(o.bumpScale=t.BumpFactor.value);t.Diffuse?o.color=(new r.Color).fromArray(t.Diffuse.value):t.DiffuseColor&&"Color"===t.DiffuseColor.type&&(o.color=(new r.Color).fromArray(t.DiffuseColor.value));t.DisplacementFactor&&(o.displacementScale=t.DisplacementFactor.value);t.Emissive?o.emissive=(new r.Color).fromArray(t.Emissive.value):t.EmissiveColor&&"Color"===t.EmissiveColor.type&&(o.emissive=(new r.Color).fromArray(t.EmissiveColor.value));t.EmissiveFactor&&(o.emissiveIntensity=parseFloat(t.EmissiveFactor.value));t.Opacity&&(o.opacity=parseFloat(t.Opacity.value));o.opacity<1&&(o.transparent=!0);t.ReflectionFactor&&(o.reflectivity=t.ReflectionFactor.value);t.Shininess&&(o.shininess=t.Shininess.value);t.Specular?o.specular=(new r.Color).fromArray(t.Specular.value):t.SpecularColor&&"Color"===t.SpecularColor.type&&(o.specular=(new r.Color).fromArray(t.SpecularColor.value));return a.get(i).children.forEach(function(t){var i=t.relationship;switch(i){case"Bump":o.bumpMap=n.get(t.ID);break;case"DiffuseColor":o.map=Y(e,n,t.ID,a);break;case"DisplacementColor":o.displacementMap=Y(e,n,t.ID,a);break;case"EmissiveColor":o.emissiveMap=Y(e,n,t.ID,a);break;case"NormalMap":o.normalMap=Y(e,n,t.ID,a);break;case"ReflectionColor":o.envMap=Y(e,n,t.ID,a),o.envMap.mapping=r.EquirectangularReflectionMapping;break;case"SpecularColor":o.specularMap=Y(e,n,t.ID,a);break;case"TransparentColor":o.alphaMap=Y(e,n,t.ID,a),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",i)}}),o}(e,t,n,a,i);switch(s.toLowerCase()){case"phong":u=new r.MeshPhongMaterial;break;case"lambert":u=new r.MeshLambertMaterial;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),u=new r.MeshPhongMaterial({color:3342591})}return u.setValues(l),u.name=o,u}function Y(e,t,n,r){return"LayeredTexture"in e.Objects&&n in e.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),n=r.get(n).children[0].ID),t.get(n)}function Q(e,t){var n=[];return e.children.forEach(function(e){var i=t[e.ID];if("Cluster"===i.attrType){var a={ID:e.ID,indices:[],weights:[],transform:(new r.Matrix4).fromArray(i.Transform.a),transformLink:(new r.Matrix4).fromArray(i.TransformLink.a),linkMode:i.Mode};"Indexes"in i&&(a.indices=i.Indexes.a,a.weights=i.Weights.a),n.push(a)}}),{rawBones:n,bones:[]}}function V(e,t,n,r){for(var i=[],a=0;a<e.children.length;a++){if(8===a){console.warn("FBXLoader: maximum of 8 morph targets supported. Ignoring additional targets.");break}var o=e.children[a],s=n[o.ID],u={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if("BlendShapeChannel"!==s.attrType)return;r.get(parseInt(o.ID)).children.forEach(function(e){"DeformPercent"===e.relationship?u.weightCurveID=e.ID:u.geoID=e.ID}),i.push(u)}return i}function z(e,t,n,i){switch(n.attrType){case"Mesh":return function(e,t,n,i){var a=i.skeletons,o=i.morphTargets,s=t.parents.map(function(t){return e.Objects.Model[t.ID]});if(0===s.length)return;var u=t.children.reduce(function(e,t){return void 0!==a[t.ID]&&(e=a[t.ID]),e},null),l=t.children.reduce(function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e},null),c=new r.Matrix4,f=s[0];if("GeometricRotation"in f){var h=f.GeometricRotation.value.map(r.Math.degToRad);h[3]="ZYX",c.makeRotationFromEuler((new r.Euler).fromArray(h))}"GeometricTranslation"in f&&c.setPosition((new r.Vector3).fromArray(f.GeometricTranslation.value));"GeometricScaling"in f&&c.scale((new r.Vector3).fromArray(f.GeometricScaling.value));return function(e,t,n,i,a){var o=new r.BufferGeometry;t.attrName&&(o.name=t.attrName);var s=function(e,t){var n={};n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];"IndexToDirect"===n&&(i=e.ColorIndex.a);return{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}(e.LayerElementColor[0]));e.LayerElementMaterial&&(n.material=function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],a=0;a<r.length;++a)i.push(a);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}(e.LayerElementMaterial[0]));e.LayerElementNormal&&(n.normal=function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a));return{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}(e.LayerElementNormal[0]));if(e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)n.uv.push(H(e.LayerElementUV[r])),r++}n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})})}));return n}(t,n),u=G(s),l=new r.Float32BufferAttribute(u.vertex,3);a.applyToBufferAttribute(l),o.addAttribute("position",l),u.colors.length>0&&o.addAttribute("color",new r.Float32BufferAttribute(u.colors,3));n&&(o.addAttribute("skinIndex",new r.Uint16BufferAttribute(u.weightsIndices,4)),o.addAttribute("skinWeight",new r.Float32BufferAttribute(u.vertexWeights,4)),o.FBX_Deformer=n);if(u.normal.length>0){var c=new r.Float32BufferAttribute(u.normal,3),f=(new r.Matrix3).getNormalMatrix(a);f.applyToBufferAttribute(c),o.addAttribute("normal",c)}if(u.uvs.forEach(function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),o.addAttribute(n,new r.Float32BufferAttribute(u.uvs[t],2))}),s.material&&"AllSame"!==s.material.mappingType){var h=u.materialIndex[0],d=0;if(u.materialIndex.forEach(function(e,t){e!==h&&(o.addGroup(d,t-d,h),h=e,d=t)}),o.groups.length>0){var p=o.groups[o.groups.length-1],m=p.start+p.count;m!==u.materialIndex.length&&o.addGroup(m,u.materialIndex.length-m,h)}0===o.groups.length&&o.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return function(e,t,n,i,a){null!==i&&(t.morphAttributes.position=[],t.morphAttributes.normal=[],i.rawTargets.forEach(function(i){var o=e.Objects.Geometry[i.geoID];void 0!==o&&function(e,t,n,i){var a=new r.BufferGeometry;n.attrName&&(a.name=n.attrName);for(var o=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],u=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],c=0;c<l.length;c++){var f=3*l[c];s[f]+=u[3*c],s[f+1]+=u[3*c+1],s[f+2]+=u[3*c+2]}var h=G({vertexIndices:o,vertexPositions:s}),d=new r.Float32BufferAttribute(h.vertex,3);d.name=n.attrName,i.applyToBufferAttribute(d),e.morphAttributes.position.push(d)}(t,n,o,a)}))}(e,o,t,i,a),o}(e,n,u,l,c)}(e,t,n,i);case"NurbsCurve":return function(e){if(void 0===r.NURBSCurve)return console.error("FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new r.BufferGeometry;var t=parseInt(e.Order);if(isNaN(t))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new r.BufferGeometry;for(var n,i,a=t-1,o=e.KnotVector.a,s=[],u=e.Points.a,l=0,c=u.length;l<c;l+=4)s.push((new r.Vector4).fromArray(u,l));if("Closed"===e.Form)s.push(s[0]);else if("Periodic"===e.Form){n=a,i=o.length-1-n;for(var l=0;l<a;++l)s.push(s[l])}var f=new r.NURBSCurve(a,o,s,n,i).getPoints(7*s.length),h=new Float32Array(3*f.length);f.forEach(function(e,t){e.toArray(h,3*t)});var d=new r.BufferGeometry;return d.addAttribute("position",new r.BufferAttribute(h,3)),d}(n)}}function G(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,a=[],o=[],s=[],u=[],l=[],c=[];return e.vertexIndices.forEach(function(f,h){var d=!1;f<0&&(f^=-1,d=!0);var p=[],m=[];if(a.push(3*f,3*f+1,3*f+2),e.color){var _=q(h,n,f,e.color);s.push(_[0],_[1],_[2])}if(e.skeleton){if(void 0!==e.weightTable[f]&&e.weightTable[f].forEach(function(e){m.push(e.weight),p.push(e.id)}),m.length>4){i||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var v=[0,0,0,0],g=[0,0,0,0];m.forEach(function(e,t){var n=e,r=p[t];g.forEach(function(e,t,i){if(n>e){i[t]=n,n=e;var a=v[t];v[t]=r,r=a}})}),p=v,m=g}for(;m.length<4;)m.push(0),p.push(0);for(var y=0;y<4;++y)l.push(m[y]),c.push(p[y])}if(e.normal){_=q(h,n,f,e.normal);o.push(_[0],_[1],_[2])}if(e.material&&"AllSame"!==e.material.mappingType)var A=q(h,n,f,e.material)[0];e.uv&&e.uv.forEach(function(e,t){var r=q(h,n,f,e);void 0===u[t]&&(u[t]=[]),u[t].push(r[0]),u[t].push(r[1])}),r++,d&&(!function(e,t,n,r,i,a,o,s,u,l){for(var c=2;c<l;c++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(c-1)]]),e.vertex.push(t.vertexPositions[n[3*(c-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(c-1)+2]]),e.vertex.push(t.vertexPositions[n[3*c]]),e.vertex.push(t.vertexPositions[n[3*c+1]]),e.vertex.push(t.vertexPositions[n[3*c+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(c-1)]),e.vertexWeights.push(s[4*(c-1)+1]),e.vertexWeights.push(s[4*(c-1)+2]),e.vertexWeights.push(s[4*(c-1)+3]),e.vertexWeights.push(s[4*c]),e.vertexWeights.push(s[4*c+1]),e.vertexWeights.push(s[4*c+2]),e.vertexWeights.push(s[4*c+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[4*(c-1)]),e.weightsIndices.push(u[4*(c-1)+1]),e.weightsIndices.push(u[4*(c-1)+2]),e.weightsIndices.push(u[4*(c-1)+3]),e.weightsIndices.push(u[4*c]),e.weightsIndices.push(u[4*c+1]),e.weightsIndices.push(u[4*c+2]),e.weightsIndices.push(u[4*c+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(c-1)]),e.colors.push(a[3*(c-1)+1]),e.colors.push(a[3*(c-1)+2]),e.colors.push(a[3*c]),e.colors.push(a[3*c+1]),e.colors.push(a[3*c+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(c-1)]),e.normal.push(i[3*(c-1)+1]),e.normal.push(i[3*(c-1)+2]),e.normal.push(i[3*c]),e.normal.push(i[3*c+1]),e.normal.push(i[3*c+2])),t.uv&&t.uv.forEach(function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(c-1)]),e.uvs[n].push(o[n][2*(c-1)+1]),e.uvs[n].push(o[n][2*c]),e.uvs[n].push(o[n][2*c+1])})}(t,e,a,A,o,s,u,l,c,r),n++,r=0,a=[],o=[],s=[],u=[],l=[],c=[])}),t}function H(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}Object.assign(X.prototype,{load:function(e,t,n,i){var a=this,o=r.LoaderUtils.extractUrlBase(e),s=new r.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(n){try{var r=a.parse(n,o);t(r)}catch(t){window.setTimeout(function(){i&&i(t),a.manager.itemError(e)},0)}},n,i)},parse:function(e,t){var n;if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===pe(e,0,t.length)}(e))n=(new ue).parse(e);else{var i=pe(e);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(t){var r=e[t-1];return e=e.slice(n+t),n++,r}for(var i=0;i<t.length;++i){var a=r(1);if(a===t[i])return!1}return!0}(i))throw new Error("FBXLoader: Unknown format.");if(fe(i)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+fe(i));n=(new se).parse(i)}var a=function(e){var t=new Map;if("Connections"in e){var n=e.Connections.connections;n.forEach(function(e){var n=e[0],r=e[1],i=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var a={ID:r,relationship:i};t.get(n).parents.push(a),t.has(r)||t.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};t.get(r).children.push(o)})}return t}(n),o=function(e){var t={},n={};if("Video"in e.Objects){var r=e.Objects.Video;for(var i in r){var a=r[i],o=parseInt(i);if(t[o]=a.RelativeFilename||a.Filename,"Content"in a){var s=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,u="string"==typeof a.Content&&""!==a.Content;if(s||u){var l=D(r[i]);n[a.RelativeFilename||a.Filename]=l}}}}for(var o in t){var c=t[o];void 0!==n[c]?t[o]=n[c]:t[o]=t[o].split("\\").pop()}return t}(n),s=function(e,t,n){var r=new Map;if("Material"in e.Objects){var i=e.Objects.Material;for(var a in i){var o=j(e,i[a],t,n);null!==o&&r.set(parseInt(a),o)}}return r}(n,function(e,t,n,r){var i=new Map;if("Texture"in e.Objects){var a=e.Objects.Texture;for(var o in a){var s=B(a[o],t,n,r);i.set(parseInt(o),s)}}return i}(n,new r.TextureLoader(this.manager).setPath(t),o,a),a),u=function(e,t){var n={},r={};if("Deformer"in e.Objects){var i=e.Objects.Deformer;for(var a in i){var o=i[a],s=t.get(parseInt(a));if("Skin"===o.attrType){var u=Q(s,i);u.ID=a,s.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=s.parents[0].ID,n[a]=u}else if("BlendShape"===o.attrType){var l={id:a};l.rawTargets=V(s,o,i,t),l.id=a,s.parents.length>1&&console.warn("FBXLoader: morph target attached to more than one geometry is not supported."),l.parentGeoID=s.parents[0].ID,r[a]=l}}}return{skeletons:n,morphTargets:r}}(n,a),l=function(e,t,n){var r=new Map;if("Geometry"in e.Objects){var i=e.Objects.Geometry;for(var a in i){var o=t.get(parseInt(a)),s=z(e,o,i[a],n);r.set(parseInt(a),s)}}return r}(n,a,u);return function(e,t,n,i,a){var o=new r.Group,s=function(e,t,n,i,a){var o=new Map,s=e.Objects.Model;for(var u in s){var l=parseInt(u),c=s[u],f=a.get(l),h=K(f,t,l,c.attrName);if(!h){switch(c.attrType){case"Camera":h=J(e,f);break;case"Light":h=Z(e,f);break;case"Mesh":h=$(e,f,n,i);break;case"NurbsCurve":h=ee(f,n);break;case"LimbNode":case"Null":default:h=new r.Group}h.name=r.PropertyBinding.sanitizeNodeName(c.attrName),h.ID=l}te(e,h,c),o.set(l,h)}return o}(e,n,i,a,t),u=e.Objects.Model;return s.forEach(function(n){var i=u[n.ID];!function(e,t,n,i,a){if("LookAtProperty"in n){var o=i.get(t.ID).children;o.forEach(function(n){if("LookAtProperty"===n.relationship){var i=e.Objects.Model[n.ID];if("Lcl_Translation"in i){var o=i.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(o),a.add(t.target)):t.lookAt((new r.Vector3).fromArray(o))}}})}}(e,n,i,t,o),t.get(n.ID).parents.forEach(function(e){var t=s.get(e.ID);void 0!==t&&t.add(n)}),null===n.parent&&o.add(n)}),function(e,t,n,i,a){var o=function(e){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var i in n)if("BindPose"===n[i].attrType){var a=n[i].PoseNode;Array.isArray(a)?a.forEach(function(e){t[e.Node]=(new r.Matrix4).fromArray(e.Matrix.a)}):t[a.Node]=(new r.Matrix4).fromArray(a.Matrix.a)}}return t}(e);for(var s in t){var u=t[s],l=a.get(parseInt(u.ID)).parents;l.forEach(function(e){if(n.has(e.ID)){var t=e.ID,s=a.get(t);s.parents.forEach(function(e){if(i.has(e.ID)){var t=i.get(e.ID);t.bind(new r.Skeleton(u.bones),o[e.ID])}})}})}}(e,n,i,s,t),function(e,t,n){n.animations=[];var i=function(e,t){if(void 0!==e.Objects.AnimationCurve){var n=function(e){var t=e.Objects.AnimationCurveNode,n=new Map;for(var r in t){var i=t[r];if(null!==i.attrName.match(/S|R|T/)){var a={id:i.id,attr:i.attrName,curves:{}};n.set(a.id,a)}}return n}(e);!function(e,t,n){var r=e.Objects.AnimationCurve;for(var i in r){var a={id:r[i].id,times:r[i].KeyTime.a.map(he),values:r[i].KeyValueFloat.a},o=t.get(a.id);if(void 0!==o){var s=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?n.get(s).curves.x=a:u.match(/Y/)?n.get(s).curves.y=a:u.match(/Z/)&&(n.get(s).curves.z=a)}}}(e,t,n);var i=function(e,t,n){var i=e.Objects.AnimationLayer,a=new Map;for(var o in i){var s=[],u=t.get(parseInt(o));if(void 0!==u){var l=u.children;l.forEach(function(i,a){if(n.has(i.ID)){var o=n.get(i.ID);if(void 0!==o.curves.x||void 0!==o.curves.y||void 0!==o.curves.z){if(void 0===s[a]){var u;t.get(i.ID).parents.forEach(function(e){void 0!==e.relationship&&(u=e.ID)});var l=e.Objects.Model[u.toString()],c={modelName:r.PropertyBinding.sanitizeNodeName(l.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in l&&(c.initialPosition=l.Lcl_Translation.value),"Lcl_Rotation"in l&&(c.initialRotation=l.Lcl_Rotation.value),"Lcl_Scaling"in l&&(c.initialScale=l.Lcl_Scaling.value),"PreRotation"in l&&(c.preRotations=l.PreRotation.value),s[a]=c}s[a][o.attr]=o}}}),a.set(parseInt(o),s)}}return a}(e,t,n);return function(e,t,n){var r=e.Objects.AnimationStack,i={};for(var a in r){var o=t.get(parseInt(a)).children;o.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(o[0].ID);i[a]={name:r[a].attrName,layer:s}}return i}(e,t,i)}}(e,t);if(void 0!==i)for(var a in i){var o=i[a],s=ne(o);n.animations.push(s)}}(e,t,o),function(e,t){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var n=e.GlobalSettings.AmbientColor.value,i=n[0],a=n[1],o=n[2];if(0!==i||0!==a||0!==o){var s=new r.Color(i,a,o);t.add(new r.AmbientLight(s,1))}}}(e,o),o}(n,a,u.skeletons,l,s)}});var W=[];function q(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var a=i*r.dataSize,o=a+r.dataSize;return function(e,t,n,r){for(var i=n,a=0;i<r;i++,a++)e[a]=t[i];return e}(W,r.buffer,a,o)}function K(e,t,n,i){var a=null;return e.parents.forEach(function(e){for(var o in t){var s=t[o];s.rawBones.forEach(function(t,o){if(t.ID===e.ID){var u=a;(a=new r.Bone).matrixWorld.copy(t.transformLink),a.name=r.PropertyBinding.sanitizeNodeName(i),a.ID=n,s.bones[o]=a,null!==u&&a.add(u)}})}}),a}function J(e,t){var n,i;if(t.children.forEach(function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)}),void 0===i)n=new r.Object3D;else{var a=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(a=1);var o=1;void 0!==i.NearPlane&&(o=i.NearPlane.value/1e3);var s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);var u=window.innerWidth,l=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(u=i.AspectWidth.value,l=i.AspectHeight.value);var c=u/l,f=45;void 0!==i.FieldOfView&&(f=i.FieldOfView.value);var h=i.FocalLength?i.FocalLength.value:null;switch(a){case 0:n=new r.PerspectiveCamera(f,c,o,s),null!==h&&n.setFocalLength(h);break;case 1:n=new r.OrthographicCamera(-u/2,u/2,l/2,-l/2,o,s);break;default:console.warn("FBXLoader: Unknown camera type "+a+"."),n=new r.Object3D}}return n}function Z(e,t){var n,i;if(t.children.forEach(function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(i=n)}),void 0===i)n=new r.Object3D;else{var a;a=void 0===i.LightType?0:i.LightType.value;var o=16777215;void 0!==i.Color&&(o=(new r.Color).fromArray(i.Color.value));var s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);var u=0;void 0!==i.FarAttenuationEnd&&(u=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);switch(a){case 0:n=new r.PointLight(o,s,u,1);break;case 1:n=new r.DirectionalLight(o,s);break;case 2:var l=Math.PI/3;void 0!==i.InnerAngle&&(l=r.Math.degToRad(i.InnerAngle.value));var c=0;void 0!==i.OuterAngle&&(c=r.Math.degToRad(i.OuterAngle.value),c=Math.max(c,1)),n=new r.SpotLight(o,s,u,l,c,1);break;default:console.warn("FBXLoader: Unknown light type "+i.LightType.value+", defaulting to a THREE.PointLight."),n=new r.PointLight(o,s)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(n.castShadow=!0)}return n}function $(e,t,n,i){var a,o=null,s=null,u=[];return t.children.forEach(function(e){n.has(e.ID)&&(o=n.get(e.ID)),i.has(e.ID)&&u.push(i.get(e.ID))}),u.length>1?s=u:u.length>0?s=u[0]:(s=new r.MeshPhongMaterial({color:13421772}),u.push(s)),"color"in o.attributes&&u.forEach(function(e){e.vertexColors=r.VertexColors}),o.FBX_Deformer?(u.forEach(function(e){e.skinning=!0}),a=new r.SkinnedMesh(o,s)):a=new r.Mesh(o,s),a}function ee(e,t){var n=e.children.reduce(function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e},null),i=new r.LineBasicMaterial({color:3342591,linewidth:1});return new r.Line(n,i)}function te(e,t,n){if("RotationOrder"in n){var i=parseInt(n.RotationOrder.value,10);i>0&&i<6?console.warn("FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][i]):6===i&&console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in n&&t.position.fromArray(n.Lcl_Translation.value),"Lcl_Rotation"in n){var a=n.Lcl_Rotation.value.map(r.Math.degToRad);a.push("ZYX"),t.quaternion.setFromEuler((new r.Euler).fromArray(a))}if("Lcl_Scaling"in n&&t.scale.fromArray(n.Lcl_Scaling.value),"PreRotation"in n){var o=n.PreRotation.value.map(r.Math.degToRad);o[3]="ZYX";var s=(new r.Euler).fromArray(o);s=(new r.Quaternion).setFromEuler(s),t.quaternion.premultiply(s)}}function ne(e){var t=[];return e.layer.forEach(function(e){t=t.concat(function(e){var t=[];if(void 0!==e.T&&Object.keys(e.T.curves).length>0){var n=re(e.modelName,e.T.curves,e.initialPosition,"position");void 0!==n&&t.push(n)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var i=function(e,t,n,i){void 0!==t.x&&(oe(t.x),t.x.values=t.x.values.map(r.Math.degToRad));void 0!==t.y&&(oe(t.y),t.y.values=t.y.values.map(r.Math.degToRad));void 0!==t.z&&(oe(t.z),t.z.values=t.z.values.map(r.Math.degToRad));var a=ae(t),o=ie(a,t,n);void 0!==i&&((i=i.map(r.Math.degToRad)).push("ZYX"),i=(new r.Euler).fromArray(i),i=(new r.Quaternion).setFromEuler(i));for(var s=new r.Quaternion,u=new r.Euler,l=[],c=0;c<o.length;c+=3)u.set(o[c],o[c+1],o[c+2],"ZYX"),s.setFromEuler(u),void 0!==i&&s.premultiply(i),s.toArray(l,c/3*4);return new r.QuaternionKeyframeTrack(e+".quaternion",a,l)}(e.modelName,e.R.curves,e.initialRotation,e.preRotations);void 0!==i&&t.push(i)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var a=re(e.modelName,e.S.curves,e.initialScale,"scale");void 0!==a&&t.push(a)}return t}(e))}),new r.AnimationClip(e.name,-1,t)}function re(e,t,n,i){var a=ae(t),o=ie(a,t,n);return new r.VectorKeyframeTrack(e+"."+i,a,o)}function ie(e,t,n){var r=n,i=[],a=-1,o=-1,s=-1;return e.forEach(function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var n=t.x.values[a];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==o){var u=t.y.values[o];i.push(u),r[1]=u}else i.push(r[1]);if(-1!==s){var l=t.z.values[s];i.push(l),r[2]=l}else i.push(r[2])}),i}function ae(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort(function(e,t){return e-t}).filter(function(e,t,n){return n.indexOf(e)==t})}function oe(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){for(var a=i/180,o=r/a,s=n+o,u=e.times[t-1],l=(e.times[t]-u)/a,c=u+l,f=[],h=[];c<e.times[t];)f.push(c),c+=l,h.push(s),s+=o;e.times=me(e.times,t,f),e.values=me(e.values,t,h)}}}function se(){}function ue(){}function le(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function ce(){}function fe(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function he(e){return e/46186158e3}function de(e){return e.split(",").map(function(e){return parseFloat(e)})}function pe(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),r.LoaderUtils.decodeText(new Uint8Array(e,t,n))}function me(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}Object.assign(se.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new ce,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split("\n");return n.forEach(function(e,r){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,n[++r]):u?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),i={name:n},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==a.id&&(o[n][a.id]=i)):"number"==typeof a.id?(o[n]={},o[n][a.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}},parseNodeProperty:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){var o=i.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),l=i.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i=[s,u],l=l.map(function(e){return e.trim().replace(/^"/,"")})),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=i),r in a&&Array.isArray(a[r])?a[r].push(i):"a"!==r?a[r]=i:a.a=i,this.setCurrentProp(a,r),"a"===r&&","!==i.slice(-1)&&(a.a=de(i))}else this.parseNodeSpecialProperty(e,r,i)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=de(t.a))},parseNodeSpecialProperty:function(e,t,n){var r=n.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=de(u)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),i)}}),Object.assign(ue.prototype,{parse:function(e){var t=new le(e);t.skip(23);for(var n=t.getUint32(),r=new ce;!this.endOfContent(t);){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32(),a=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(a);if(0===r)return null;for(var s=[],u=0;u<i;u++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",f=s.length>2?s[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(o,n,h)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==f&&(n.attrType=f),""!==o&&(n.name=o),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach(function(e,t){0!==t&&i.push(e)}),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name){Object.keys(n).forEach(function(e){t[e]=n[e]})}else if("Properties70"===e&&"P"===n.name){var a,o=n.propertyList[0],s=n.propertyList[1],u=n.propertyList[2],l=n.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[o]={type:s,type2:u,flag:l,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":n=e.getUint32();return e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var r=e.getUint32(),i=e.getUint32(),a=e.getUint32();if(0===i)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}var o=new le(new U.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(a))).decompress().buffer);switch(t){case"b":case"c":return o.getBooleanArray(r);case"d":return o.getFloat64Array(r);case"f":return o.getFloat32Array(r);case"i":return o.getInt32Array(r);case"l":return o.getInt64Array(r)}default:throw new Error("FBXLoader: Unknown property type "+t)}}}),Object.assign(le.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.getUint8();var i=t.indexOf(0);return i>=0&&(t=t.slice(0,i)),r.LoaderUtils.decodeText(t)}}),Object.assign(ce.prototype,{add:function(e,t){this[e]=t}});var _e={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},ve=function(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1};Object.assign(ve.prototype,{setSize:function(e,t){},render:function(e,t,n,r,i){console.error("THREE.Pass: .render() must be implemented in derived pass.")}});var ge=function(e,t){ve.call(this),this.textureID=void 0!==t?t:"tDiffuse",e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.camera=new r.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new r.Scene,this.quad=new r.Mesh(new r.PlaneBufferGeometry(2,2),null),this.quad.frustumCulled=!1,this.scene.add(this.quad)};ge.prototype=Object.assign(Object.create(ve.prototype),{constructor:ge,render:function(e,t,n,r,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}});var ye=function(e,t){ve.call(this),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1};ye.prototype=Object.assign(Object.create(ve.prototype),{constructor:ye,render:function(e,t,n,r,i){var a,o,s=e.context,u=e.state;u.buffers.color.setMask(!1),u.buffers.depth.setMask(!1),u.buffers.color.setLocked(!0),u.buffers.depth.setLocked(!0),this.inverse?(a=0,o=1):(a=1,o=0),u.buffers.stencil.setTest(!0),u.buffers.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),u.buffers.stencil.setFunc(s.ALWAYS,a,4294967295),u.buffers.stencil.setClear(o),e.render(this.scene,this.camera,n,this.clear),e.render(this.scene,this.camera,t,this.clear),u.buffers.color.setLocked(!1),u.buffers.depth.setLocked(!1),u.buffers.stencil.setFunc(s.EQUAL,1,4294967295),u.buffers.stencil.setOp(s.KEEP,s.KEEP,s.KEEP)}});var Ae=function(){ve.call(this),this.needsSwap=!1};Ae.prototype=Object.create(ve.prototype),Object.assign(Ae.prototype,{render:function(e,t,n,r,i){e.state.buffers.stencil.setTest(!1)}});var xe=function(e,t){if(this.renderer=e,void 0===t){var n={minFilter:r.LinearFilter,magFilter:r.LinearFilter,format:r.RGBAFormat,stencilBuffer:!1},i=e.getDrawingBufferSize();(t=new r.WebGLRenderTarget(i.width,i.height,n)).texture.name="EffectComposer.rt1"}this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===_e&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),void 0===ge&&console.error("THREE.EffectComposer relies on THREE.ShaderPass"),this.copyPass=new ge(_e)};Object.assign(xe.prototype,{swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e);var t=this.renderer.getDrawingBufferSize();e.setSize(t.width,t.height)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){var t,n,r=!1,i=this.passes.length;for(n=0;n<i;n++)if(!1!==(t=this.passes[n]).enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),t.needsSwap){if(r){var a=this.renderer.context;a.stencilFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),a.stencilFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==ye&&(t instanceof ye?r=!0:t instanceof Ae&&(r=!1))}},reset:function(e){if(void 0===e){var t=this.renderer.getDrawingBufferSize();(e=this.renderTarget1.clone()).setSize(t.width,t.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){this.renderTarget1.setSize(e,t),this.renderTarget2.setSize(e,t);for(var n=0;n<this.passes.length;n++)this.passes[n].setSize(e,t)}});var be={uniforms:{tDiffuse:{value:null},resolution:{value:new r.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["precision highp float;","","uniform sampler2D tDiffuse;","","uniform vec2 resolution;","","varying vec2 vUv;","","// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)","","//----------------------------------------------------------------------------------","// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag","// SDK Version: v3.00","// Email:       gameworks@nvidia.com","// Site:        http://developer.nvidia.com/","//","// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.","//","// Redistribution and use in source and binary forms, with or without","// modification, are permitted provided that the following conditions","// are met:","//  * Redistributions of source code must retain the above copyright","//    notice, this list of conditions and the following disclaimer.","//  * Redistributions in binary form must reproduce the above copyright","//    notice, this list of conditions and the following disclaimer in the","//    documentation and/or other materials provided with the distribution.","//  * Neither the name of NVIDIA CORPORATION nor the names of its","//    contributors may be used to endorse or promote products derived","//    from this software without specific prior written permission.","//","// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY","// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE","// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR","// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR","// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,","// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,","// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR","// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY","// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT","// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE","// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.","//","//----------------------------------------------------------------------------------","","#define FXAA_PC 1","#define FXAA_GLSL_100 1","#define FXAA_QUALITY_PRESET 12","","#define FXAA_GREEN_AS_LUMA 1","","/*--------------------------------------------------------------------------*/","#ifndef FXAA_PC_CONSOLE","    //","    // The console algorithm for PC is included","    // for developers targeting really low spec machines.","    // Likely better to just run FXAA_PC, and use a really low preset.","    //","    #define FXAA_PC_CONSOLE 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_120","    #define FXAA_GLSL_120 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GLSL_130","    #define FXAA_GLSL_130 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_3","    #define FXAA_HLSL_3 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_4","    #define FXAA_HLSL_4 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_HLSL_5","    #define FXAA_HLSL_5 0","#endif","/*==========================================================================*/","#ifndef FXAA_GREEN_AS_LUMA","    //","    // For those using non-linear color,","    // and either not able to get luma in alpha, or not wanting to,","    // this enables FXAA to run using green as a proxy for luma.","    // So with this enabled, no need to pack luma in alpha.","    //","    // This will turn off AA on anything which lacks some amount of green.","    // Pure red and blue or combination of only R and B, will get no AA.","    //","    // Might want to lower the settings for both,","    //    fxaaConsoleEdgeThresholdMin","    //    fxaaQualityEdgeThresholdMin","    // In order to insure AA does not get turned off on colors","    // which contain a minor amount of green.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_GREEN_AS_LUMA 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_EARLY_EXIT","    //","    // Controls algorithm's early exit path.","    // On PS3 turning this ON adds 2 cycles to the shader.","    // On 360 turning this OFF adds 10ths of a millisecond to the shader.","    // Turning this off on console will result in a more blurry image.","    // So this defaults to on.","    //","    // 1 = On.","    // 0 = Off.","    //","    #define FXAA_EARLY_EXIT 1","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_DISCARD","    //","    // Only valid for PC OpenGL currently.","    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.","    //","    // 1 = Use discard on pixels which don't need AA.","    //     For APIs which enable concurrent TEX+ROP from same surface.","    // 0 = Return unchanged color on pixels which don't need AA.","    //","    #define FXAA_DISCARD 0","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_FAST_PIXEL_OFFSET","    //","    // Used for GLSL 120 only.","    //","    // 1 = GL API supports fast pixel offsets","    // 0 = do not use fast pixel offsets","    //","    #ifdef GL_EXT_gpu_shader4","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_FAST_PIXEL_OFFSET 1","    #endif","    #ifndef FXAA_FAST_PIXEL_OFFSET","        #define FXAA_FAST_PIXEL_OFFSET 0","    #endif","#endif","/*--------------------------------------------------------------------------*/","#ifndef FXAA_GATHER4_ALPHA","    //","    // 1 = API supports gather4 on alpha channel.","    // 0 = API does not support gather4 on alpha channel.","    //","    #if (FXAA_HLSL_5 == 1)","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_ARB_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifdef GL_NV_gpu_shader5","        #define FXAA_GATHER4_ALPHA 1","    #endif","    #ifndef FXAA_GATHER4_ALPHA","        #define FXAA_GATHER4_ALPHA 0","    #endif","#endif","","","/*============================================================================","                        FXAA QUALITY - TUNING KNOBS","------------------------------------------------------------------------------","NOTE the other tuning knobs are now in the shader function inputs!","============================================================================*/","#ifndef FXAA_QUALITY_PRESET","    //","    // Choose the quality preset.","    // This needs to be compiled into the shader as it effects code.","    // Best option to include multiple presets is to","    // in each shader define the preset, then include this file.","    //","    // OPTIONS","    // -----------------------------------------------------------------------","    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)","    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)","    // 39       - no dither, very expensive","    //","    // NOTES","    // -----------------------------------------------------------------------","    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)","    // 13 = about same speed as FXAA 3.9 and better than 12","    // 23 = closest to FXAA 3.9 visually and performance wise","    //  _ = the lowest digit is directly related to performance","    // _  = the highest digit is directly related to style","    //","    #define FXAA_QUALITY_PRESET 12","#endif","","","/*============================================================================","","                           FXAA QUALITY - PRESETS","","============================================================================*/","","/*============================================================================","                     FXAA QUALITY - MEDIUM DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 10)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 3.0","    #define FXAA_QUALITY_P2 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 11)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 3.0","    #define FXAA_QUALITY_P3 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 12)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 4.0","    #define FXAA_QUALITY_P4 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 13)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 4.0","    #define FXAA_QUALITY_P5 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 14)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 4.0","    #define FXAA_QUALITY_P6 12.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 15)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 12.0","#endif","","/*============================================================================","                     FXAA QUALITY - LOW DITHER PRESETS","============================================================================*/","#if (FXAA_QUALITY_PRESET == 20)","    #define FXAA_QUALITY_PS 3","    #define FXAA_QUALITY_P0 1.5","    #define FXAA_QUALITY_P1 2.0","    #define FXAA_QUALITY_P2 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 21)","    #define FXAA_QUALITY_PS 4","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 22)","    #define FXAA_QUALITY_PS 5","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 23)","    #define FXAA_QUALITY_PS 6","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 24)","    #define FXAA_QUALITY_PS 7","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 3.0","    #define FXAA_QUALITY_P6 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 25)","    #define FXAA_QUALITY_PS 8","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 4.0","    #define FXAA_QUALITY_P7 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 26)","    #define FXAA_QUALITY_PS 9","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 4.0","    #define FXAA_QUALITY_P8 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 27)","    #define FXAA_QUALITY_PS 10","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 4.0","    #define FXAA_QUALITY_P9 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 28)","    #define FXAA_QUALITY_PS 11","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 4.0","    #define FXAA_QUALITY_P10 8.0","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_QUALITY_PRESET == 29)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.5","    #define FXAA_QUALITY_P2 2.0","    #define FXAA_QUALITY_P3 2.0","    #define FXAA_QUALITY_P4 2.0","    #define FXAA_QUALITY_P5 2.0","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","/*============================================================================","                     FXAA QUALITY - EXTREME QUALITY","============================================================================*/","#if (FXAA_QUALITY_PRESET == 39)","    #define FXAA_QUALITY_PS 12","    #define FXAA_QUALITY_P0 1.0","    #define FXAA_QUALITY_P1 1.0","    #define FXAA_QUALITY_P2 1.0","    #define FXAA_QUALITY_P3 1.0","    #define FXAA_QUALITY_P4 1.0","    #define FXAA_QUALITY_P5 1.5","    #define FXAA_QUALITY_P6 2.0","    #define FXAA_QUALITY_P7 2.0","    #define FXAA_QUALITY_P8 2.0","    #define FXAA_QUALITY_P9 2.0","    #define FXAA_QUALITY_P10 4.0","    #define FXAA_QUALITY_P11 8.0","#endif","","","","/*============================================================================","","                                API PORTING","","============================================================================*/","#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)","    #define FxaaBool bool","    #define FxaaDiscard discard","    #define FxaaFloat float","    #define FxaaFloat2 vec2","    #define FxaaFloat3 vec3","    #define FxaaFloat4 vec4","    #define FxaaHalf float","    #define FxaaHalf2 vec2","    #define FxaaHalf3 vec3","    #define FxaaHalf4 vec4","    #define FxaaInt2 ivec2","    #define FxaaSat(x) clamp(x, 0.0, 1.0)","    #define FxaaTex sampler2D","#else","    #define FxaaBool bool","    #define FxaaDiscard clip(-1)","    #define FxaaFloat float","    #define FxaaFloat2 float2","    #define FxaaFloat3 float3","    #define FxaaFloat4 float4","    #define FxaaHalf half","    #define FxaaHalf2 half2","    #define FxaaHalf3 half3","    #define FxaaHalf4 half4","    #define FxaaSat(x) saturate(x)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_100 == 1)","  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)","  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_120 == 1)","    // Requires,","    //  #version 120","    // And at least,","    //  #extension GL_EXT_gpu_shader4 : enable","    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)","    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)","    #if (FXAA_FAST_PIXEL_OFFSET == 1)","        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)","    #else","        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)","    #endif","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_GLSL_130 == 1)",'    // Requires "#version 130" or better',"    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)","    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)","    #if (FXAA_GATHER4_ALPHA == 1)","        // use #extension GL_ARB_gpu_shader5 : enable","        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)","        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)","        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)","        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)","    #endif","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_3 == 1)","    #define FxaaInt2 float2","    #define FxaaTex sampler2D","    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))","    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_4 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","#endif","/*--------------------------------------------------------------------------*/","#if (FXAA_HLSL_5 == 1)","    #define FxaaInt2 int2","    struct FxaaTex { SamplerState smpl; Texture2D tex; };","    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)","    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)","    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)","    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)","    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)","    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)","#endif","","","/*============================================================================","                   GREEN AS LUMA OPTION SUPPORT FUNCTION","============================================================================*/","#if (FXAA_GREEN_AS_LUMA == 0)","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }","#else","    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }","#endif","","","","","/*============================================================================","","                             FXAA3 QUALITY - PC","","============================================================================*/","#if (FXAA_PC == 1)","/*--------------------------------------------------------------------------*/","FxaaFloat4 FxaaPixelShader(","    //","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy} = center of pixel","    FxaaFloat2 pos,","    //","    // Used only for FXAA Console, and not used on the 360 version.","    // Use noperspective interpolation here (turn off perspective interpolation).","    // {xy_} = upper left of pixel","    // {_zw} = lower right of pixel","    FxaaFloat4 fxaaConsolePosPos,","    //","    // Input color texture.","    // {rgb_} = color in linear or perceptual color space","    // if (FXAA_GREEN_AS_LUMA == 0)","    //     {__a} = luma in perceptual color space (not linear)","    FxaaTex tex,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 2nd sampler.","    // This sampler needs to have an exponent bias of -1.","    FxaaTex fxaaConsole360TexExpBiasNegOne,","    //","    // Only used on the optimized 360 version of FXAA Console.",'    // For everything but 360, just use the same input here as for "tex".',"    // For 360, same texture, just alias with a 3nd sampler.","    // This sampler needs to have an exponent bias of -2.","    FxaaTex fxaaConsole360TexExpBiasNegTwo,","    //","    // Only used on FXAA Quality.","    // This must be from a constant/uniform.","    // {x_} = 1.0/screenWidthInPixels","    // {_y} = 1.0/screenHeightInPixels","    FxaaFloat2 fxaaQualityRcpFrame,","    //","    // Only used on FXAA Console.","    // This must be from a constant/uniform.","    // This effects sub-pixel AA quality and inversely sharpness.","    //   Where N ranges between,","    //     N = 0.50 (default)","    //     N = 0.33 (sharper)","    // {x__} = -N/screenWidthInPixels","    // {_y_} = -N/screenHeightInPixels","    // {_z_} =  N/screenWidthInPixels","    // {__w} =  N/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt,","    //","    // Only used on FXAA Console.","    // Not used on 360, but used on PS3 and PC.","    // This must be from a constant/uniform.","    // {x__} = -2.0/screenWidthInPixels","    // {_y_} = -2.0/screenHeightInPixels","    // {_z_} =  2.0/screenWidthInPixels","    // {__w} =  2.0/screenHeightInPixels","    FxaaFloat4 fxaaConsoleRcpFrameOpt2,","    //","    // Only used on FXAA Console.","    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.","    // This must be from a constant/uniform.","    // {x__} =  8.0/screenWidthInPixels","    // {_y_} =  8.0/screenHeightInPixels","    // {_z_} = -4.0/screenWidthInPixels","    // {__w} = -4.0/screenHeightInPixels","    FxaaFloat4 fxaaConsole360RcpFrameOpt2,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_SUBPIX define.","    // It is here now to allow easier tuning.","    // Choose the amount of sub-pixel aliasing removal.","    // This can effect sharpness.","    //   1.00 - upper limit (softer)","    //   0.75 - default amount of filtering","    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)","    //   0.25 - almost off","    //   0.00 - completely off","    FxaaFloat fxaaQualitySubpix,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // The minimum amount of local contrast required to apply algorithm.","    //   0.333 - too little (faster)","    //   0.250 - low quality","    //   0.166 - default","    //   0.125 - high quality","    //   0.063 - overkill (slower)","    FxaaFloat fxaaQualityEdgeThreshold,","    //","    // Only used on FXAA Quality.","    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    //   0.0833 - upper limit (default, the start of visible unfiltered edges)","    //   0.0625 - high quality (faster)","    //   0.0312 - visible limit (slower)","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaQualityEdgeThresholdMin,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only three safe values here: 2 and 4 and 8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // For all other platforms can be a non-power of two.","    //   8.0 is sharper (default!!!)","    //   4.0 is softer","    //   2.0 is really soft (good only for vector graphics inputs)","    FxaaFloat fxaaConsoleEdgeSharpness,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.","    // It is here now to allow easier tuning.","    // This does not effect PS3, as this needs to be compiled in.","    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.","    //   Due to the PS3 being ALU bound,","    //   there are only two safe values here: 1/4 and 1/8.","    //   These options use the shaders ability to a free *|/ by 2|4|8.","    // The console setting has a different mapping than the quality setting.","    // Other platforms can use other values.","    //   0.125 leaves less aliasing, but is softer (default!!!)","    //   0.25 leaves more aliasing, and is sharper","    FxaaFloat fxaaConsoleEdgeThreshold,","    //","    // Only used on FXAA Console.","    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.","    // It is here now to allow easier tuning.","    // Trims the algorithm from processing darks.","    // The console setting has a different mapping than the quality setting.","    // This only applies when FXAA_EARLY_EXIT is 1.","    // This does not apply to PS3,","    // PS3 was simplified to avoid more shader instructions.","    //   0.06 - faster but more aliasing in darks","    //   0.05 - default","    //   0.04 - slower and less aliasing in darks","    // Special notes when using FXAA_GREEN_AS_LUMA,","    //   Likely want to set this to zero.","    //   As colors that are mostly not-green","    //   will appear very dark in the green channel!","    //   Tune by looking at mostly non-green content,","    //   then start at zero and increase until aliasing is a problem.","    FxaaFloat fxaaConsoleEdgeThresholdMin,","    //","    // Extra constants for 360 FXAA Console only.","    // Use zeros or anything else for other platforms.","    // These must be in physical constant registers and NOT immedates.","    // Immedates will result in compiler un-optimizing.","    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)","    FxaaFloat4 fxaaConsole360ConstDir",") {","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posM;","    posM.x = pos.x;","    posM.y = pos.y;","    #if (FXAA_GATHER4_ALPHA == 1)","        #if (FXAA_DISCARD == 0)","            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","            #if (FXAA_GREEN_AS_LUMA == 0)","                #define lumaM rgbyM.w","            #else","                #define lumaM rgbyM.y","            #endif","        #endif","        #if (FXAA_GREEN_AS_LUMA == 0)","            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));","        #else","            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);","            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));","        #endif","        #if (FXAA_DISCARD == 1)","            #define lumaM luma4A.w","        #endif","        #define lumaE luma4A.z","        #define lumaS luma4A.x","        #define lumaSE luma4A.y","        #define lumaNW luma4B.w","        #define lumaN luma4B.z","        #define lumaW luma4B.x","    #else","        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);","        #if (FXAA_GREEN_AS_LUMA == 0)","            #define lumaM rgbyM.w","        #else","            #define lumaM rgbyM.y","        #endif","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));","        #endif","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat maxSM = max(lumaS, lumaM);","    FxaaFloat minSM = min(lumaS, lumaM);","    FxaaFloat maxESM = max(lumaE, maxSM);","    FxaaFloat minESM = min(lumaE, minSM);","    FxaaFloat maxWN = max(lumaN, lumaW);","    FxaaFloat minWN = min(lumaN, lumaW);","    FxaaFloat rangeMax = max(maxWN, maxESM);","    FxaaFloat rangeMin = min(minWN, minESM);","    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;","    FxaaFloat range = rangeMax - rangeMin;","    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);","    FxaaBool earlyExit = range < rangeMaxClamped;","/*--------------------------------------------------------------------------*/","    if(earlyExit)","        #if (FXAA_DISCARD == 1)","            FxaaDiscard;","        #else","            return rgbyM;","        #endif","/*--------------------------------------------------------------------------*/","    #if (FXAA_GATHER4_ALPHA == 0)","        #if (FXAA_GLSL_100 == 1)","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));","        #else","          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));","          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","        #endif","    #else","        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));","        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));","    #endif","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNS = lumaN + lumaS;","    FxaaFloat lumaWE = lumaW + lumaE;","    FxaaFloat subpixRcpRange = 1.0/range;","    FxaaFloat subpixNSWE = lumaNS + lumaWE;","    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;","    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNESE = lumaNE + lumaSE;","    FxaaFloat lumaNWNE = lumaNW + lumaNE;","    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;","    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;","/*--------------------------------------------------------------------------*/","    FxaaFloat lumaNWSW = lumaNW + lumaSW;","    FxaaFloat lumaSWSE = lumaSW + lumaSE;","    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);","    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);","    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;","    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;","    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;","    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;","/*--------------------------------------------------------------------------*/","    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;","    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;","    FxaaBool horzSpan = edgeHorz >= edgeVert;","    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;","/*--------------------------------------------------------------------------*/","    if(!horzSpan) lumaN = lumaW;","    if(!horzSpan) lumaS = lumaE;","    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;","    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;","/*--------------------------------------------------------------------------*/","    FxaaFloat gradientN = lumaN - lumaM;","    FxaaFloat gradientS = lumaS - lumaM;","    FxaaFloat lumaNN = lumaN + lumaM;","    FxaaFloat lumaSS = lumaS + lumaM;","    FxaaBool pairN = abs(gradientN) >= abs(gradientS);","    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));","    if(pairN) lengthSign = -lengthSign;","    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posB;","    posB.x = posM.x;","    posB.y = posM.y;","    FxaaFloat2 offNP;","    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;","    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;","    if(!horzSpan) posB.x += lengthSign * 0.5;","    if( horzSpan) posB.y += lengthSign * 0.5;","/*--------------------------------------------------------------------------*/","    FxaaFloat2 posN;","    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;","    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;","    FxaaFloat2 posP;","    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;","    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;","    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;","    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));","    FxaaFloat subpixE = subpixC * subpixC;","    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));","/*--------------------------------------------------------------------------*/","    if(!pairN) lumaNN = lumaSS;","    FxaaFloat gradientScaled = gradient * 1.0/4.0;","    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;","    FxaaFloat subpixF = subpixD * subpixE;","    FxaaBool lumaMLTZero = lumaMM < 0.0;","/*--------------------------------------------------------------------------*/","    lumaEndN -= lumaNN * 0.5;","    lumaEndP -= lumaNN * 0.5;","    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;","    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;","    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;","    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;","    FxaaBool doneNP = (!doneN) || (!doneP);","    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;","    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;","/*--------------------------------------------------------------------------*/","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 3)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 4)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 5)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 6)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;","/*--------------------------------------------------------------------------*/","                        #if (FXAA_QUALITY_PS > 7)","                        if(doneNP) {","                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                            doneN = abs(lumaEndN) >= gradientScaled;","                            doneP = abs(lumaEndP) >= gradientScaled;","                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;","                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;","                            doneNP = (!doneN) || (!doneP);","                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;","                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;","/*--------------------------------------------------------------------------*/","    #if (FXAA_QUALITY_PS > 8)","    if(doneNP) {","        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","        doneN = abs(lumaEndN) >= gradientScaled;","        doneP = abs(lumaEndP) >= gradientScaled;","        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;","        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;","        doneNP = (!doneN) || (!doneP);","        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;","        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;","/*--------------------------------------------------------------------------*/","        #if (FXAA_QUALITY_PS > 9)","        if(doneNP) {","            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","            doneN = abs(lumaEndN) >= gradientScaled;","            doneP = abs(lumaEndP) >= gradientScaled;","            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;","            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;","            doneNP = (!doneN) || (!doneP);","            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;","            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;","/*--------------------------------------------------------------------------*/","            #if (FXAA_QUALITY_PS > 10)","            if(doneNP) {","                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                doneN = abs(lumaEndN) >= gradientScaled;","                doneP = abs(lumaEndP) >= gradientScaled;","                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;","                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;","                doneNP = (!doneN) || (!doneP);","                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;","                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;","/*--------------------------------------------------------------------------*/","                #if (FXAA_QUALITY_PS > 11)","                if(doneNP) {","                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                    doneN = abs(lumaEndN) >= gradientScaled;","                    doneP = abs(lumaEndP) >= gradientScaled;","                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;","                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;","                    doneNP = (!doneN) || (!doneP);","                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;","                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;","/*--------------------------------------------------------------------------*/","                    #if (FXAA_QUALITY_PS > 12)","                    if(doneNP) {","                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));","                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));","                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;","                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;","                        doneN = abs(lumaEndN) >= gradientScaled;","                        doneP = abs(lumaEndP) >= gradientScaled;","                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;","                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;","                        doneNP = (!doneN) || (!doneP);","                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;","                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","    #endif","/*--------------------------------------------------------------------------*/","                        }","                        #endif","/*--------------------------------------------------------------------------*/","                    }","                    #endif","/*--------------------------------------------------------------------------*/","                }","                #endif","/*--------------------------------------------------------------------------*/","            }","            #endif","/*--------------------------------------------------------------------------*/","        }","        #endif","/*--------------------------------------------------------------------------*/","    }","/*--------------------------------------------------------------------------*/","    FxaaFloat dstN = posM.x - posN.x;","    FxaaFloat dstP = posP.x - posM.x;","    if(!horzSpan) dstN = posM.y - posN.y;","    if(!horzSpan) dstP = posP.y - posM.y;","/*--------------------------------------------------------------------------*/","    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;","    FxaaFloat spanLength = (dstP + dstN);","    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;","    FxaaFloat spanLengthRcp = 1.0/spanLength;","/*--------------------------------------------------------------------------*/","    FxaaBool directionN = dstN < dstP;","    FxaaFloat dst = min(dstN, dstP);","    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;","    FxaaFloat subpixG = subpixF * subpixF;","    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;","    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;","/*--------------------------------------------------------------------------*/","    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;","    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);","    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;","    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;","    #if (FXAA_DISCARD == 1)","        return FxaaTexTop(tex, posM);","    #else","        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);","    #endif","}","/*==========================================================================*/","#endif","","void main() {","  gl_FragColor = FxaaPixelShader(","    vUv,","    vec4(0.0),","    tDiffuse,","    tDiffuse,","    tDiffuse,","    resolution,","    vec4(0.0),","    vec4(0.0),","    vec4(0.0),","    0.75,","    0.166,","    0.0833,","    0.0,","    0.0,","    0.0,","    vec4(0.0)","  );","","  // TODO avoid querying texture twice for same texel","  gl_FragColor.a = texture2D(tDiffuse, vUv).a;","}"].join("\n")},we=function(e,t,n,r,i){ve.call(this),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=void 0!==i?i:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1};we.prototype=Object.assign(Object.create(ve.prototype),{constructor:we,render:function(e,t,n,r,i){var a,o,s=e.autoClear;e.autoClear=!1,this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(a=e.getClearColor().getHex(),o=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.render(this.scene,this.camera,this.renderToScreen?null:n,this.clear),this.clearColor&&e.setClearColor(a,o),this.scene.overrideMaterial=null,e.autoClear=s}});var Fe=function(){var e=Fe.SkyShader,t=new r.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:r.UniformsUtils.clone(e.uniforms),side:r.BackSide});r.Mesh.call(this,new r.SphereBufferGeometry(1,12,8),t)};Fe.prototype=Object.create(r.Mesh.prototype),Fe.SkyShader={uniforms:{luminance:{value:1},turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.003},mieDirectionalG:{value:.95},sunPosition:{value:new r.Vector3}},vertexShader:["uniform vec3 sunPosition;","uniform float rayleigh;","uniform float turbidity;","uniform float mieCoefficient;","varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );","const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );","const float v = 4.0;","const vec3 K = vec3( 0.686, 0.678, 0.666 );","const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );","const float cutoffAngle = 1.6110731556870734;","const float steepness = 1.5;","const float EE = 1000.0;","float sunIntensity( float zenithAngleCos ) {","\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );","\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );","}","vec3 totalMie( float T ) {","\tfloat c = ( 0.2 * T ) * 10E-18;","\treturn 0.434 * c * MieConst;","}","void main() {","\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );","\tvWorldPosition = worldPosition.xyz;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","\tvSunDirection = normalize( sunPosition );","\tvSunE = sunIntensity( dot( vSunDirection, up ) );","\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );","\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );","\tvBetaR = totalRayleigh * rayleighCoefficient;","\tvBetaM = totalMie( turbidity ) * mieCoefficient;","}"].join("\n"),fragmentShader:["varying vec3 vWorldPosition;","varying vec3 vSunDirection;","varying float vSunfade;","varying vec3 vBetaR;","varying vec3 vBetaM;","varying float vSunE;","uniform float luminance;","uniform float mieDirectionalG;","const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3( 0.0, 1.0, 0.0 );","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float THREE_OVER_SIXTEENPI = 0.05968310365946075;","const float ONE_OVER_FOURPI = 0.07957747154594767;","float rayleighPhase( float cosTheta ) {","\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );","}","float hgPhase( float cosTheta, float g ) {","\tfloat g2 = pow( g, 2.0 );","\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );","\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );","}","const float A = 0.15;","const float B = 0.50;","const float C = 0.10;","const float D = 0.20;","const float E = 0.02;","const float F = 0.30;","const float whiteScale = 1.0748724675633854;","vec3 Uncharted2Tonemap( vec3 x ) {","\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;","}","void main() {","\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );","\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );","\tfloat sR = rayleighZenithLength * inverse;","\tfloat sM = mieZenithLength * inverse;","\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );","\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );","\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );","\tvec3 betaRTheta = vBetaR * rPhase;","\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );","\tvec3 betaMTheta = vBetaM * mPhase;","\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );","\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );","\tvec3 direction = normalize( vWorldPosition - cameraPos );","\tfloat theta = acos( direction.y ); // elevation --\x3e y-axis, [-pi/2, pi/2]","\tfloat phi = atan( direction.z, direction.x ); // azimuth --\x3e x-axis [-pi/2, pi/2]","\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );","\tvec3 L0 = vec3( 0.1 ) * Fex;","\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );","\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;","\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );","\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( luminance, 4.0 ) ) ) * texColor );","\tvec3 color = curr * whiteScale;","\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );","\tgl_FragColor = vec4( retColor, 1.0 );","}"].join("\n")};let Se={CopyShader:_e,EffectComposer:xe,Pass:ve,FXAAShader:be,ClearMaskPass:Ae,MaskPass:ye,RenderPass:we,ShaderPass:ge,Sky:Fe};var Te={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,r;t=void 0!==(e=e||{}).parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",(r=Te.getWebGLErrorMessage()).id=n,t.appendChild(r)}},Ee=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.classList.add("statsBox"),t.addEventListener("click",function(n){n.preventDefault(),r(++e%t.children.length)},!1);var i=(performance||Date).now(),a=i,o=0,s=n(new Ee.Panel("FPS","#0ff","#002")),u=n(new Ee.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=n(new Ee.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(u.update(e-i,200),e>a+1e3&&(s.update(1e3*o/(e-a),100),a=e,o=0,l)){var t=performance.memory;l.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};Ee.Panel=function(e,t,n){var r=1/0,i=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,u=48*o,l=3*o,c=2*o,f=3*o,h=15*o,d=74*o,p=30*o,m=document.createElement("canvas");m.width=s,m.height=u,m.style.cssText="width:80px;height:48px";var _=m.getContext("2d");return _.font="bold "+9*o+"px Helvetica,Arial,sans-serif",_.textBaseline="top",_.fillStyle=n,_.fillRect(0,0,s,u),_.fillStyle=t,_.fillText(e,l,c),_.fillRect(f,h,d,p),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(f,h,d,p),{dom:m,update:function(u,v){r=Math.min(r,u),i=Math.max(i,u),_.fillStyle=n,_.globalAlpha=1,_.fillRect(0,0,s,h),_.fillStyle=t,_.fillText(a(u)+" "+e+" ("+a(r)+"-"+a(i)+")",l,c),_.drawImage(m,f+o,h,d-o,p,f,h,d-o,p),_.fillRect(f+d-o,h,o,p),_.fillStyle=n,_.globalAlpha=.9,_.fillRect(f+d-o,h,o,a((1-u/v)*p))}}};var Pe=n(6);n(9),n(12);class Le{constructor(){this.characters=[],this.vehicles=[];const e=this;Te.webgl||Te.addGetWebGLMessage(),this.renderer=new r.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=r.PCFSoftShadowMap,document.body.appendChild(this.renderer.domElement),window.addEventListener("resize",function(){e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(window.innerWidth,window.innerHeight),o.uniforms.resolution.value.set(1/(window.innerWidth*n),1/(window.innerHeight*n)),e.composer.setSize(window.innerWidth*n,window.innerHeight*n)},!1),this.stats=new Ee,document.body.appendChild(this.stats.dom),this.graphicsWorld=new r.Scene,this.camera=new r.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.1,120);let t=new Se.RenderPass(this.graphicsWorld,this.camera),n=1;void 0!==window.devicePixelRatio&&(n=window.devicePixelRatio);let o=new Se.ShaderPass(Se.FXAAShader);o.uniforms.resolution.value.set(1/(window.innerWidth*n),1/(window.innerHeight*n)),o.renderToScreen=!0,this.composer=new Se.EffectComposer(this.renderer),this.composer.setSize(window.innerWidth*n,window.innerHeight*n),this.composer.addPass(t),this.composer.addPass(o);let s=new Se.Sky;s.scale.setScalar(100),this.graphicsWorld.add(s),this.sun=new r.Vector3;let u=-.3*Math.PI,l=2*Math.PI*-.25;this.sun.x=Math.cos(l),this.sun.y=Math.sin(l)*Math.sin(u),this.sun.z=Math.sin(l)*Math.cos(u),s.material.uniforms.sunPosition.value.copy(this.sun);let c=new r.AmbientLight(8947848);this.graphicsWorld.add(c),this.dirLight=new r.DirectionalLight(16777215,.6),this.dirLight.castShadow=!0,this.dirLight.shadow.mapSize.width=1024,this.dirLight.shadow.mapSize.height=1024,this.dirLight.shadow.camera.near=.5,this.dirLight.shadow.camera.far=8,this.dirLight.shadow.camera.top=5,this.dirLight.shadow.camera.right=5,this.dirLight.shadow.camera.bottom=-5,this.dirLight.shadow.camera.left=-5,this.dirLight.shadow.camera,this.graphicsWorld.add(this.dirLight);let f=new r.GridHelper(10,10,0,0);f.position.set(0,.01,0),f.material.opacity=.2,f.material.transparent=!0,this.graphicsWorld.add(f),f=new r.AxesHelper(2),f=new r.DirectionalLightHelper(this.dirLight,3),f=new r.CameraHelper(this.dirLight.shadow.camera),this.physicsWorld=new a.World,this.physicsWorld.gravity.set(0,-9.81,0),this.physicsWorld.broadphase=new a.NaiveBroadphase,this.physicsWorld.solver.iterations=10,this.parallelPairs=[],this.physicsFramerate=1/60,this.physicsMaxPrediction=10,this.clock=new r.Clock,this.delta=0,this.sinceLastFrame=0,this.justRendered=!1,document.addEventListener("keydown",function(t){void 0!==e.gameMode&&e.gameMode.handleKey(t,t.key,!0)},!1),document.addEventListener("keyup",function(t){void 0!==e.gameMode&&e.gameMode.handleKey(t,t.key,!1)},!1),document.addEventListener("mousedown",function(t){void 0!==e.gameMode&&e.gameMode.handleKey(t,"mouse"+t.button,!0)},!1),document.addEventListener("mouseup",function(t){void 0!==e.gameMode&&e.gameMode.handleKey(t,"mouse"+t.button,!1)},!1),document.addEventListener("wheel",function(t){t.deltaY>0?(e.timeScaleTarget/=e.timeScaleChangeSpeed,e.timeScaleTarget<e.timeScaleBottomLimit&&(e.timeScaleTarget=0)):(e.timeScaleTarget*=e.timeScaleChangeSpeed,e.timeScaleTarget<e.timeScaleBottomLimit&&(e.timeScaleTarget=e.timeScaleBottomLimit),e.timeScaleTarget=Math.min(e.timeScaleTarget,1),e.params.Time_Scale>.9&&(e.params.Time_Scale*=e.timeScaleChangeSpeed))},!1),this.timeScaleBottomLimit=.003,this.timeScaleChangeSpeed=1.3,this.timeScaleTarget=1;let h={FPS_Limit:60,Time_Scale:1,Shadows:!0,FXAA:!1,Draw_Capsules:!1,RayCast_Debug:!1};this.params=h;let d=new Pe.GUI,p=d.addFolder("Rendering");p.add(h,"FPS_Limit",0,60);let m=p.add(h,"Time_Scale",0,1).listen(),_=p.add(h,"Shadows");p.add(h,"FXAA");let v=d.addFolder("Debug"),g=v.add(h,"Draw_Capsules"),y=v.add(h,"RayCast_Debug");d.open(),m.onChange(function(e){this.timeScaleTarget=e}),g.onChange(function(t){e.characters.forEach(e=>{e.characterCapsule.visual.visible=!!t})}),y.onChange(function(t){e.characters.forEach(e=>{e.raycastBox.visible=!!t})}),_.onChange(function(t){e.dirLight.castShadow=!!t}),this.cameraController=new i(this.camera),this.gameMode=new M.FreeCameraControls(this),this.Render(this)}Update(e){this.updatePhysics(e),this.characters.forEach(t=>{t.behaviour.update(e),t.updateMatrixWorld()}),this.gameMode.update(e),this.cameraController.update(),this.params.Time_Scale=r.Math.lerp(this.params.Time_Scale,this.timeScaleTarget,.2)}Render(e){this.justRendered&&(this.justRendered=!1,this.stats.begin()),requestAnimationFrame(function(){e.Render(e)}),this.delta=this.clock.getDelta();let t=this.delta*this.params.Time_Scale;e.Update(t),this.sinceLastFrame+=this.delta+this.clock.getDelta();let n=1/this.params.FPS_Limit;this.sinceLastFrame>n&&(this.sinceLastFrame%=n,this.params.FXAA?this.composer.render():this.renderer.render(this.graphicsWorld,this.camera),this.stats.end(),this.justRendered=!0)}SpawnCharacter(e=[]){let t={position:new r.Vector3};e=u.setDefaults(e,t);let n=new R(this);return n.setPosition(e.position.x,e.position.y,e.position.z),this.characters.push(n),this.physicsWorld.addBody(n.characterCapsule.physical),this.graphicsWorld.add(n.characterCapsule.visual),this.graphicsWorld.add(n.raycastBox),this.parallelPairs.push(n.characterCapsule),this.graphicsWorld.add(n),n}updatePhysics(e){this.physicsWorld.step(this.physicsFramerate,e,this.physicsMaxPrediction),this.parallelPairs.forEach(e=>{e.physical.position.y<-1&&(e.physical.position.y=10),e.physical.position.y>10&&(e.physical.position.y=-1),e.physical.position.x>5&&(e.physical.position.x=-5),e.physical.position.x<-5&&(e.physical.position.x=5),e.physical.position.z>5&&(e.physical.position.z=-5),e.physical.position.z<-5&&(e.physical.position.z=5),e.visual.position.copy(e.physical.interpolatedPosition),e.visual.quaternion.copy(e.physical.interpolatedQuaternion)})}createBoxPrimitive(e=[]){let t={mass:1,position:new a.Vec3,size:new a.Vec3(.3,.3,.3),friction:.3,visible:!0};e=u.setDefaults(e,t);let n=new a.Material;n.friction=e.friction;let i=new a.Box(e.size);i.material=n;let o=new a.Body({mass:e.mass,position:e.position,shape:i});o.material=n,this.physicsWorld.addBody(o);let s=new r.BoxGeometry(2*e.size.x,2*e.size.y,2*e.size.z),l=new r.MeshLambertMaterial({color:13421772}),c=new r.Mesh(s,l);c.castShadow=!0,c.receiveShadow=!0,c.visible=e.visible,this.graphicsWorld.add(c);let f={physical:o,visual:c};return this.parallelPairs.push(f),f}createSpherePrimitive(e=[]){let t={mass:1,position:new a.Vec3,radius:.3,friction:.3,visible:!0};e=u.setDefaults(e,t);let n=new a.Material;n.friction=e.friction;let i=new a.Sphere(e.radius);i.material=n;let o=new a.Body({mass:e.mass,position:e.position,shape:i});o.material=n,this.physicsWorld.addBody(o);let s=new r.SphereGeometry(e.radius),l=new r.MeshLambertMaterial({color:13421772}),c=new r.Mesh(s,l);c.castShadow=!0,c.receiveShadow=!0,c.visible=e.visible,this.graphicsWorld.add(c);let f={physical:o,visual:c};return this.parallelPairs.push(f),f}createCapsulePrimitive(e=[]){let t={mass:1,position:new a.Vec3,height:.5,radius:.3,segments:8,friction:.3,visible:!0};e=u.setDefaults(e,t);let n=new a.Material;n.friction=e.friction;let i=new a.Body({mass:e.mass,position:e.position}),o=new a.Sphere(e.radius),s=new a.Cylinder(e.radius,e.radius,e.height/2,e.segments);s.transformAllPoints(new a.Vec3,new a.Quaternion(.707,0,0,.707)),i.material=n,o.material=n,s.material=n,i.addShape(o,new a.Vec3(0,e.height/2,0)),i.addShape(o,new a.Vec3(0,-e.height/2,0)),i.addShape(s,new a.Vec3(0,0,0));let l=new r.Mesh(u.createCapsuleGeometry(e.radius,e.height,e.segments),new r.MeshLambertMaterial({color:13421772,wireframe:!0}));return l.visible=e.visible,{physical:i,visual:l}}}n.d(t,"CameraController",function(){return i}),n.d(t,"Character",function(){return R}),n.d(t,"CharacterAI",function(){return d}),n.d(t,"CharacterStates",function(){return O}),n.d(t,"Controls",function(){return h}),n.d(t,"FBXLoader",function(){return X}),n.d(t,"GameModes",function(){return M}),n.d(t,"Shaders",function(){return Se}),n.d(t,"Springs",function(){return f}),n.d(t,"Utilities",function(){return u}),n.d(t,"World",function(){return Le})}])});